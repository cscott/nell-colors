/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

// Inspired by canvas.h of Colors! XO activity, GPL license.

/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/

/*!
 * iScroll v4.2.2 ~ Copyright (c) 2012 Matteo Spinelli, http://cubiq.org
 * Released under MIT license, http://cubiq.org/license
 */

/*
        Unobtrusive Slider Control by frequency decoder v2.6 (http://www.frequency-decoder.com/)
        HACKED BY C. Scott Ananian.

        Released under a creative commons Attribution-Share Alike 3.0 Unported license (http://creativecommons.org/licenses/by-sa/3.0/)

        You are free:

        * to copy, distribute, display, and perform the work
        * to make derivative works
        * to make commercial use of the work

        Under the following conditions:

                by Attribution.
                --------------
                You must attribute the work in the manner specified by the author or licensor.

                sa
                --
                Share Alike. If you alter, transform, or build upon this work, you may distribute the resulting work only under a license identical to this one.

        * For any reuse or distribution, you must make clear to others the license terms of this work.
        * Any of these conditions can be waived if you get permission from the copyright holder.
*/

/** @license
 * RequireJS plugin for loading JSON files
 * - depends on Text plugin and it was HEAVILY "inspired" by it as well.
 * Author: Miller Medeiros
 * Version: 0.2.1 (2012/04/17)
 * Released under the MIT license
 */

// Cross-platform sound pool.  Heavily hacked from the MIT licensed code in
// https://github.com/gladiusjs/gladius-core/blob/develop/src/sound/default.js

/*! @source http://purl.eligrey.com/github/BlobBuilder.js/blob/master/BlobBuilder.js */

/*! @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

/**
 * Basic parser for URL properties
 * @author Miller Medeiros
 * @version 0.1.0 (2011/12/06)
 * MIT license
 */

/*
 * Copyright 2012 Small Batch, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */

/** @license
 * RequireJS plugin for loading web fonts using the WebFont Loader
 * Author: Miller Medeiros
 * Version: 0.2.0 (2011/12/06)
 * Released under the MIT license
 */

define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),define("img",[],function(){return{load:function(e,t,n,r){if(r.isBuild||typeof document=="undefined")n(null);else{var i=document.createElement("img");i.addEventListener("load",function(){n(i)}),i.src=t.toUrl(e)}}}}),define("src/color-x11",[],function(){var e=function(e){return{snow:new e(255,250,250,255),"ghost white":new e(248,248,255,255),GhostWhite:new e(248,248,255,255),"white smoke":new e(245,245,245,255),WhiteSmoke:new e(245,245,245,255),gainsboro:new e(220,220,220,255),"floral white":new e(255,250,240,255),FloralWhite:new e(255,250,240,255),"old lace":new e(253,245,230,255),OldLace:new e(253,245,230,255),linen:new e(250,240,230,255),"antique white":new e(250,235,215,255),AntiqueWhite:new e(250,235,215,255),"papaya whip":new e(255,239,213,255),PapayaWhip:new e(255,239,213,255),"blanched almond":new e(255,235,205,255),BlanchedAlmond:new e(255,235,205,255),bisque:new e(255,228,196,255),"peach puff":new e(255,218,185,255),PeachPuff:new e(255,218,185,255),"navajo white":new e(255,222,173,255),NavajoWhite:new e(255,222,173,255),moccasin:new e(255,228,181,255),cornsilk:new e(255,248,220,255),ivory:new e(255,255,240,255),"lemon chiffon":new e(255,250,205,255),LemonChiffon:new e(255,250,205,255),seashell:new e(255,245,238,255),honeydew:new e(240,255,240,255),"mint cream":new e(245,255,250,255),MintCream:new e(245,255,250,255),azure:new e(240,255,255,255),"alice blue":new e(240,248,255,255),AliceBlue:new e(240,248,255,255),lavender:new e(230,230,250,255),"lavender blush":new e(255,240,245,255),LavenderBlush:new e(255,240,245,255),"misty rose":new e(255,228,225,255),MistyRose:new e(255,228,225,255),white:new e(255,255,255,255),black:new e(0,0,0,255),"dark slate gray":new e(47,79,79,255),DarkSlateGray:new e(47,79,79,255),"dark slate grey":new e(47,79,79,255),DarkSlateGrey:new e(47,79,79,255),"dim gray":new e(105,105,105,255),DimGray:new e(105,105,105,255),"dim grey":new e(105,105,105,255),DimGrey:new e(105,105,105,255),"slate gray":new e(112,128,144,255),SlateGray:new e(112,128,144,255),"slate grey":new e(112,128,144,255),SlateGrey:new e(112,128,144,255),"light slate gray":new e(119,136,153,255),LightSlateGray:new e(119,136,153,255),"light slate grey":new e(119,136,153,255),LightSlateGrey:new e(119,136,153,255),gray:new e(190,190,190,255),grey:new e(190,190,190,255),"light grey":new e(211,211,211,255),LightGrey:new e(211,211,211,255),"light gray":new e(211,211,211,255),LightGray:new e(211,211,211,255),"midnight blue":new e(25,25,112,255),MidnightBlue:new e(25,25,112,255),navy:new e(0,0,128,255),"navy blue":new e(0,0,128,255),NavyBlue:new e(0,0,128,255),"cornflower blue":new e(100,149,237,255),CornflowerBlue:new e(100,149,237,255),"dark slate blue":new e(72,61,139,255),DarkSlateBlue:new e(72,61,139,255),"slate blue":new e(106,90,205,255),SlateBlue:new e(106,90,205,255),"medium slate blue":new e(123,104,238,255),MediumSlateBlue:new e(123,104,238,255),"light slate blue":new e(132,112,255,255),LightSlateBlue:new e(132,112,255,255),"medium blue":new e(0,0,205,255),MediumBlue:new e(0,0,205,255),"royal blue":new e(65,105,225,255),RoyalBlue:new e(65,105,225,255),blue:new e(0,0,255,255),"dodger blue":new e(30,144,255,255),DodgerBlue:new e(30,144,255,255),"deep sky blue":new e(0,191,255,255),DeepSkyBlue:new e(0,191,255,255),"sky blue":new e(135,206,235,255),SkyBlue:new e(135,206,235,255),"light sky blue":new e(135,206,250,255),LightSkyBlue:new e(135,206,250,255),"steel blue":new e(70,130,180,255),SteelBlue:new e(70,130,180,255),"light steel blue":new e(176,196,222,255),LightSteelBlue:new e(176,196,222,255),"light blue":new e(173,216,230,255),LightBlue:new e(173,216,230,255),"powder blue":new e(176,224,230,255),PowderBlue:new e(176,224,230,255),"pale turquoise":new e(175,238,238,255),PaleTurquoise:new e(175,238,238,255),"dark turquoise":new e(0,206,209,255),DarkTurquoise:new e(0,206,209,255),"medium turquoise":new e(72,209,204,255),MediumTurquoise:new e(72,209,204,255),turquoise:new e(64,224,208,255),cyan:new e(0,255,255,255),"light cyan":new e(224,255,255,255),LightCyan:new e(224,255,255,255),"cadet blue":new e(95,158,160,255),CadetBlue:new e(95,158,160,255),"medium aquamarine":new e(102,205,170,255),MediumAquamarine:new e(102,205,170,255),aquamarine:new e(127,255,212,255),"dark green":new e(0,100,0,255),DarkGreen:new e(0,100,0,255),"dark olive green":new e(85,107,47,255),DarkOliveGreen:new e(85,107,47,255),"dark sea green":new e(143,188,143,255),DarkSeaGreen:new e(143,188,143,255),"sea green":new e(46,139,87,255),SeaGreen:new e(46,139,87,255),"medium sea green":new e(60,179,113,255),MediumSeaGreen:new e(60,179,113,255),"light sea green":new e(32,178,170,255),LightSeaGreen:new e(32,178,170,255),"pale green":new e(152,251,152,255),PaleGreen:new e(152,251,152,255),"spring green":new e(0,255,127,255),SpringGreen:new e(0,255,127,255),"lawn green":new e(124,252,0,255),LawnGreen:new e(124,252,0,255),green:new e(0,255,0,255),chartreuse:new e(127,255,0,255),"medium spring green":new e(0,250,154,255),MediumSpringGreen:new e(0,250,154,255),"green yellow":new e(173,255,47,255),GreenYellow:new e(173,255,47,255),"lime green":new e(50,205,50,255),LimeGreen:new e(50,205,50,255),"yellow green":new e(154,205,50,255),YellowGreen:new e(154,205,50,255),"forest green":new e(34,139,34,255),ForestGreen:new e(34,139,34,255),"olive drab":new e(107,142,35,255),OliveDrab:new e(107,142,35,255),"dark khaki":new e(189,183,107,255),DarkKhaki:new e(189,183,107,255),khaki:new e(240,230,140,255),"pale goldenrod":new e(238,232,170,255),PaleGoldenrod:new e(238,232,170,255),"light goldenrod yellow":new e(250,250,210,255),LightGoldenrodYellow:new e(250,250,210,255),"light yellow":new e(255,255,224,255),LightYellow:new e(255,255,224,255),yellow:new e(255,255,0,255),gold:new e(255,215,0,255),"light goldenrod":new e(238,221,130,255),LightGoldenrod:new e(238,221,130,255),goldenrod:new e(218,165,32,255),"dark goldenrod":new e(184,134,11,255),DarkGoldenrod:new e(184,134,11,255),"rosy brown":new e(188,143,143,255),RosyBrown:new e(188,143,143,255),"indian red":new e(205,92,92,255),IndianRed:new e(205,92,92,255),"saddle brown":new e(139,69,19,255),SaddleBrown:new e(139,69,19,255),sienna:new e(160,82,45,255),peru:new e(205,133,63,255),burlywood:new e(222,184,135,255),beige:new e(245,245,220,255),wheat:new e(245,222,179,255),"sandy brown":new e(244,164,96,255),SandyBrown:new e(244,164,96,255),tan:new e(210,180,140,255),chocolate:new e(210,105,30,255),firebrick:new e(178,34,34,255),brown:new e(165,42,42,255),"dark salmon":new e(233,150,122,255),DarkSalmon:new e(233,150,122,255),salmon:new e(250,128,114,255),"light salmon":new e(255,160,122,255),LightSalmon:new e(255,160,122,255),orange:new e(255,165,0,255),"dark orange":new e(255,140,0,255),DarkOrange:new e(255,140,0,255),coral:new e(255,127,80,255),"light coral":new e(240,128,128,255),LightCoral:new e(240,128,128,255),tomato:new e(255,99,71,255),"orange red":new e(255,69,0,255),OrangeRed:new e(255,69,0,255),red:new e(255,0,0,255),"hot pink":new e(255,105,180,255),HotPink:new e(255,105,180,255),"deep pink":new e(255,20,147,255),DeepPink:new e(255,20,147,255),pink:new e(255,192,203,255),"light pink":new e(255,182,193,255),LightPink:new e(255,182,193,255),"pale violet red":new e(219,112,147,255),PaleVioletRed:new e(219,112,147,255),maroon:new e(176,48,96,255),"medium violet red":new e(199,21,133,255),MediumVioletRed:new e(199,21,133,255),"violet red":new e(208,32,144,255),VioletRed:new e(208,32,144,255),magenta:new e(255,0,255,255),violet:new e(238,130,238,255),plum:new e(221,160,221,255),orchid:new e(218,112,214,255),"medium orchid":new e(186,85,211,255),MediumOrchid:new e(186,85,211,255),"dark orchid":new e(153,50,204,255),DarkOrchid:new e(153,50,204,255),"dark violet":new e(148,0,211,255),DarkViolet:new e(148,0,211,255),"blue violet":new e(138,43,226,255),BlueViolet:new e(138,43,226,255),purple:new e(160,32,240,255),"medium purple":new e(147,112,219,255),MediumPurple:new e(147,112,219,255),thistle:new e(216,191,216,255),snow1:new e(255,250,250,255),snow2:new e(238,233,233,255),snow3:new e(205,201,201,255),snow4:new e(139,137,137,255),seashell1:new e(255,245,238,255),seashell2:new e(238,229,222,255),seashell3:new e(205,197,191,255),seashell4:new e(139,134,130,255),AntiqueWhite1:new e(255,239,219,255),AntiqueWhite2:new e(238,223,204,255),AntiqueWhite3:new e(205,192,176,255),AntiqueWhite4:new e(139,131,120,255),bisque1:new e(255,228,196,255),bisque2:new e(238,213,183,255),bisque3:new e(205,183,158,255),bisque4:new e(139,125,107,255),PeachPuff1:new e(255,218,185,255),PeachPuff2:new e(238,203,173,255),PeachPuff3:new e(205,175,149,255),PeachPuff4:new e(139,119,101,255),NavajoWhite1:new e(255,222,173,255),NavajoWhite2:new e(238,207,161,255),NavajoWhite3:new e(205,179,139,255),NavajoWhite4:new e(139,121,94,255),LemonChiffon1:new e(255,250,205,255),LemonChiffon2:new e(238,233,191,255),LemonChiffon3:new e(205,201,165,255),LemonChiffon4:new e(139,137,112,255),cornsilk1:new e(255,248,220,255),cornsilk2:new e(238,232,205,255),cornsilk3:new e(205,200,177,255),cornsilk4:new e(139,136,120,255),ivory1:new e(255,255,240,255),ivory2:new e(238,238,224,255),ivory3:new e(205,205,193,255),ivory4:new e(139,139,131,255),honeydew1:new e(240,255,240,255),honeydew2:new e(224,238,224,255),honeydew3:new e(193,205,193,255),honeydew4:new e(131,139,131,255),LavenderBlush1:new e(255,240,245,255),LavenderBlush2:new e(238,224,229,255),LavenderBlush3:new e(205,193,197,255),LavenderBlush4:new e(139,131,134,255),MistyRose1:new e(255,228,225,255),MistyRose2:new e(238,213,210,255),MistyRose3:new e(205,183,181,255),MistyRose4:new e(139,125,123,255),azure1:new e(240,255,255,255),azure2:new e(224,238,238,255),azure3:new e(193,205,205,255),azure4:new e(131,139,139,255),SlateBlue1:new e(131,111,255,255),SlateBlue2:new e(122,103,238,255),SlateBlue3:new e(105,89,205,255),SlateBlue4:new e(71,60,139,255),RoyalBlue1:new e(72,118,255,255),RoyalBlue2:new e(67,110,238,255),RoyalBlue3:new e(58,95,205,255),RoyalBlue4:new e(39,64,139,255),blue1:new e(0,0,255,255),blue2:new e(0,0,238,255),blue3:new e(0,0,205,255),blue4:new e(0,0,139,255),DodgerBlue1:new e(30,144,255,255),DodgerBlue2:new e(28,134,238,255),DodgerBlue3:new e(24,116,205,255),DodgerBlue4:new e(16,78,139,255),SteelBlue1:new e(99,184,255,255),SteelBlue2:new e(92,172,238,255),SteelBlue3:new e(79,148,205,255),SteelBlue4:new e(54,100,139,255),DeepSkyBlue1:new e(0,191,255,255),DeepSkyBlue2:new e(0,178,238,255),DeepSkyBlue3:new e(0,154,205,255),DeepSkyBlue4:new e(0,104,139,255),SkyBlue1:new e(135,206,255,255),SkyBlue2:new e(126,192,238,255),SkyBlue3:new e(108,166,205,255),SkyBlue4:new e(74,112,139,255),LightSkyBlue1:new e(176,226,255,255),LightSkyBlue2:new e(164,211,238,255),LightSkyBlue3:new e(141,182,205,255),LightSkyBlue4:new e(96,123,139,255),SlateGray1:new e(198,226,255,255),SlateGray2:new e(185,211,238,255),SlateGray3:new e(159,182,205,255),SlateGray4:new e(108,123,139,255),LightSteelBlue1:new e(202,225,255,255),LightSteelBlue2:new e(188,210,238,255),LightSteelBlue3:new e(162,181,205,255),LightSteelBlue4:new e(110,123,139,255),LightBlue1:new e(191,239,255,255),LightBlue2:new e(178,223,238,255),LightBlue3:new e(154,192,205,255),LightBlue4:new e(104,131,139,255),LightCyan1:new e(224,255,255,255),LightCyan2:new e(209,238,238,255),LightCyan3:new e(180,205,205,255),LightCyan4:new e(122,139,139,255),PaleTurquoise1:new e(187,255,255,255),PaleTurquoise2:new e(174,238,238,255),PaleTurquoise3:new e(150,205,205,255),PaleTurquoise4:new e(102,139,139,255),CadetBlue1:new e(152,245,255,255),CadetBlue2:new e(142,229,238,255),CadetBlue3:new e(122,197,205,255),CadetBlue4:new e(83,134,139,255),turquoise1:new e(0,245,255,255),turquoise2:new e(0,229,238,255),turquoise3:new e(0,197,205,255),turquoise4:new e(0,134,139,255),cyan1:new e(0,255,255,255),cyan2:new e(0,238,238,255),cyan3:new e(0,205,205,255),cyan4:new e(0,139,139,255),DarkSlateGray1:new e(151,255,255,255),DarkSlateGray2:new e(141,238,238,255),DarkSlateGray3:new e(121,205,205,255),DarkSlateGray4:new e(82,139,139,255),aquamarine1:new e(127,255,212,255),aquamarine2:new e(118,238,198,255),aquamarine3:new e(102,205,170,255),aquamarine4:new e(69,139,116,255),DarkSeaGreen1:new e(193,255,193,255),DarkSeaGreen2:new e(180,238,180,255),DarkSeaGreen3:new e(155,205,155,255),DarkSeaGreen4:new e(105,139,105,255),SeaGreen1:new e(84,255,159,255),SeaGreen2:new e(78,238,148,255),SeaGreen3:new e(67,205,128,255),SeaGreen4:new e(46,139,87,255),PaleGreen1:new e(154,255,154,255),PaleGreen2:new e(144,238,144,255),PaleGreen3:new e(124,205,124,255),PaleGreen4:new e(84,139,84,255),SpringGreen1:new e(0,255,127,255),SpringGreen2:new e(0,238,118,255),SpringGreen3:new e(0,205,102,255),SpringGreen4:new e(0,139,69,255),green1:new e(0,255,0,255),green2:new e(0,238,0,255),green3:new e(0,205,0,255),green4:new e(0,139,0,255),chartreuse1:new e(127,255,0,255),chartreuse2:new e(118,238,0,255),chartreuse3:new e(102,205,0,255),chartreuse4:new e(69,139,0,255),OliveDrab1:new e(192,255,62,255),OliveDrab2:new e(179,238,58,255),OliveDrab3:new e(154,205,50,255),OliveDrab4:new e(105,139,34,255),DarkOliveGreen1:new e(202,255,112,255),DarkOliveGreen2:new e(188,238,104,255),DarkOliveGreen3:new e(162,205,90,255),DarkOliveGreen4:new e(110,139,61,255),khaki1:new e(255,246,143,255),khaki2:new e(238,230,133,255),khaki3:new e(205,198,115,255),khaki4:new e(139,134,78,255),LightGoldenrod1:new e(255,236,139,255),LightGoldenrod2:new e(238,220,130,255),LightGoldenrod3:new e(205,190,112,255),LightGoldenrod4:new e(139,129,76,255),LightYellow1:new e(255,255,224,255),LightYellow2:new e(238,238,209,255),LightYellow3:new e(205,205,180,255),LightYellow4:new e(139,139,122,255),yellow1:new e(255,255,0,255),yellow2:new e(238,238,0,255),yellow3:new e(205,205,0,255),yellow4:new e(139,139,0,255),gold1:new e(255,215,0,255),gold2:new e(238,201,0,255),gold3:new e(205,173,0,255),gold4:new e(139,117,0,255),goldenrod1:new e(255,193,37,255),goldenrod2:new e(238,180,34,255),goldenrod3:new e(205,155,29,255),goldenrod4:new e(139,105,20,255),DarkGoldenrod1:new e(255,185,15,255),DarkGoldenrod2:new e(238,173,14,255),DarkGoldenrod3:new e(205,149,12,255),DarkGoldenrod4:new e(139,101,8,255),RosyBrown1:new e(255,193,193,255),RosyBrown2:new e(238,180,180,255),RosyBrown3:new e(205,155,155,255),RosyBrown4:new e(139,105,105,255),IndianRed1:new e(255,106,106,255),IndianRed2:new e(238,99,99,255),IndianRed3:new e(205,85,85,255),IndianRed4:new e(139,58,58,255),sienna1:new e(255,130,71,255),sienna2:new e(238,121,66,255),sienna3:new e(205,104,57,255),sienna4:new e(139,71,38,255),burlywood1:new e(255,211,155,255),burlywood2:new e(238,197,145,255),burlywood3:new e(205,170,125,255),burlywood4:new e(139,115,85,255),wheat1:new e(255,231,186,255),wheat2:new e(238,216,174,255),wheat3:new e(205,186,150,255),wheat4:new e(139,126,102,255),tan1:new e(255,165,79,255),tan2:new e(238,154,73,255),tan3:new e(205,133,63,255),tan4:new e(139,90,43,255),chocolate1:new e(255,127,36,255),chocolate2:new e(238,118,33,255),chocolate3:new e(205,102,29,255),chocolate4:new e(139,69,19,255),firebrick1:new e(255,48,48,255),firebrick2:new e(238,44,44,255),firebrick3:new e(205,38,38,255),firebrick4:new e(139,26,26,255),brown1:new e(255,64,64,255),brown2:new e(238,59,59,255),brown3:new e(205,51,51,255),brown4:new e(139,35,35,255),salmon1:new e(255,140,105,255),salmon2:new e(238,130,98,255),salmon3:new e(205,112,84,255),salmon4:new e(139,76,57,255),LightSalmon1:new e(255,160,122,255),LightSalmon2:new e(238,149,114,255),LightSalmon3:new e(205,129,98,255),LightSalmon4:new e(139,87,66,255),orange1:new e(255,165,0,255),orange2:new e(238,154,0,255),orange3:new e(205,133,0,255),orange4:new e(139,90,0,255),DarkOrange1:new e(255,127,0,255),DarkOrange2:new e(238,118,0,255),DarkOrange3:new e(205,102,0,255),DarkOrange4:new e(139,69,0,255),coral1:new e(255,114,86,255),coral2:new e(238,106,80,255),coral3:new e(205,91,69,255),coral4:new e(139,62,47,255),tomato1:new e(255,99,71,255),tomato2:new e(238,92,66,255),tomato3:new e(205,79,57,255),tomato4:new e(139,54,38,255),OrangeRed1:new e(255,69,0,255),OrangeRed2:new e(238,64,0,255),OrangeRed3:new e(205,55,0,255),OrangeRed4:new e(139,37,0,255),red1:new e(255,0,0,255),red2:new e(238,0,0,255),red3:new e(205,0,0,255),red4:new e(139,0,0,255),DebianRed:new e(215,7,81,255),DeepPink1:new e(255,20,147,255),DeepPink2:new e(238,18,137,255),DeepPink3:new e(205,16,118,255),DeepPink4:new e(139,10,80,255),HotPink1:new e(255,110,180,255),HotPink2:new e(238,106,167,255),HotPink3:new e(205,96,144,255),HotPink4:new e(139,58,98,255),pink1:new e(255,181,197,255),pink2:new e(238,169,184,255),pink3:new e(205,145,158,255),pink4:new e(139,99,108,255),LightPink1:new e(255,174,185,255),LightPink2:new e(238,162,173,255),LightPink3:new e(205,140,149,255),LightPink4:new e(139,95,101,255),PaleVioletRed1:new e(255,130,171,255),PaleVioletRed2:new e(238,121,159,255),PaleVioletRed3:new e(205,104,137,255),PaleVioletRed4:new e(139,71,93,255),maroon1:new e(255,52,179,255),maroon2:new e(238,48,167,255),maroon3:new e(205,41,144,255),maroon4:new e(139,28,98,255),VioletRed1:new e(255,62,150,255),VioletRed2:new e(238,58,140,255),VioletRed3:new e(205,50,120,255),VioletRed4:new e(139,34,82,255),magenta1:new e(255,0,255,255),magenta2:new e(238,0,238,255),magenta3:new e(205,0,205,255),magenta4:new e(139,0,139,255),orchid1:new e(255,131,250,255),orchid2:new e(238,122,233,255),orchid3:new e(205,105,201,255),orchid4:new e(139,71,137,255),plum1:new e(255,187,255,255),plum2:new e(238,174,238,255),plum3:new e(205,150,205,255),plum4:new e(139,102,139,255),MediumOrchid1:new e(224,102,255,255),MediumOrchid2:new e(209,95,238,255),MediumOrchid3:new e(180,82,205,255),MediumOrchid4:new e(122,55,139,255),DarkOrchid1:new e(191,62,255,255),DarkOrchid2:new e(178,58,238,255),DarkOrchid3:new e(154,50,205,255),DarkOrchid4:new e(104,34,139,255),purple1:new e(155,48,255,255),purple2:new e(145,44,238,255),purple3:new e(125,38,205,255),purple4:new e(85,26,139,255),MediumPurple1:new e(171,130,255,255),MediumPurple2:new e(159,121,238,255),MediumPurple3:new e(137,104,205,255),MediumPurple4:new e(93,71,139,255),thistle1:new e(255,225,255,255),thistle2:new e(238,210,238,255),thistle3:new e(205,181,205,255),thistle4:new e(139,123,139,255),gray0:new e(0,0,0,255),grey0:new e(0,0,0,255),gray1:new e(3,3,3,255),grey1:new e(3,3,3,255),gray2:new e(5,5,5,255),grey2:new e(5,5,5,255),gray3:new e(8,8,8,255),grey3:new e(8,8,8,255),gray4:new e(10,10,10,255),grey4:new e(10,10,10,255),gray5:new e(13,13,13,255),grey5:new e(13,13,13,255),gray6:new e(15,15,15,255),grey6:new e(15,15,15,255),gray7:new e(18,18,18,255),grey7:new e(18,18,18,255),gray8:new e(20,20,20,255),grey8:new e(20,20,20,255),gray9:new e(23,23,23,255),grey9:new e(23,23,23,255),gray10:new e(26,26,26,255),grey10:new e(26,26,26,255),gray11:new e(28,28,28,255),grey11:new e(28,28,28,255),gray12:new e(31,31,31,255),grey12:new e(31,31,31,255),gray13:new e(33,33,33,255),grey13:new e(33,33,33,255),gray14:new e(36,36,36,255),grey14:new e(36,36,36,255),gray15:new e(38,38,38,255),grey15:new e(38,38,38,255),gray16:new e(41,41,41,255),grey16:new e(41,41,41,255),gray17:new e(43,43,43,255),grey17:new e(43,43,43,255),gray18:new e(46,46,46,255),grey18:new e(46,46,46,255),gray19:new e(48,48,48,255),grey19:new e(48,48,48,255),gray20:new e(51,51,51,255),grey20:new e(51,51,51,255),gray21:new e(54,54,54,255),grey21:new e(54,54,54,255),gray22:new e(56,56,56,255),grey22:new e(56,56,56,255),gray23:new e(59,59,59,255),grey23:new e(59,59,59,255),gray24:new e(61,61,61,255),grey24:new e(61,61,61,255),gray25:new e(64,64,64,255),grey25:new e(64,64,64,255),gray26:new e(66,66,66,255),grey26:new e(66,66,66,255),gray27:new e(69,69,69,255),grey27:new e(69,69,69,255),gray28:new e(71,71,71,255),grey28:new e(71,71,71,255),gray29:new e(74,74,74,255),grey29:new e(74,74,74,255),gray30:new e(77,77,77,255),grey30:new e(77,77,77,255),gray31:new e(79,79,79,255),grey31:new e(79,79,79,255),gray32:new e(82,82,82,255),grey32:new e(82,82,82,255),gray33:new e(84,84,84,255),grey33:new e(84,84,84,255),gray34:new e(87,87,87,255),grey34:new e(87,87,87,255),gray35:new e(89,89,89,255),grey35:new e(89,89,89,255),gray36:new e(92,92,92,255),grey36:new e(92,92,92,255),gray37:new e(94,94,94,255),grey37:new e(94,94,94,255),gray38:new e(97,97,97,255),grey38:new e(97,97,97,255),gray39:new e(99,99,99,255),grey39:new e(99,99,99,255),gray40:new e(102,102,102,255),grey40:new e(102,102,102,255),gray41:new e(105,105,105,255),grey41:new e(105,105,105,255),gray42:new e(107,107,107,255),grey42:new e(107,107,107,255),gray43:new e(110,110,110,255),grey43:new e(110,110,110,255),gray44:new e(112,112,112,255),grey44:new e(112,112,112,255),gray45:new e(115,115,115,255),grey45:new e(115,115,115,255),gray46:new e(117,117,117,255),grey46:new e(117,117,117,255),gray47:new e(120,120,120,255),grey47:new e(120,120,120,255),gray48:new e(122,122,122,255),grey48:new e(122,122,122,255),gray49:new e(125,125,125,255),grey49:new e(125,125,125,255),gray50:new e(127,127,127,255),grey50:new e(127,127,127,255),gray51:new e(130,130,130,255),grey51:new e(130,130,130,255),gray52:new e(133,133,133,255),grey52:new e(133,133,133,255),gray53:new e(135,135,135,255),grey53:new e(135,135,135,255),gray54:new e(138,138,138,255),grey54:new e(138,138,138,255),gray55:new e(140,140,140,255),grey55:new e(140,140,140,255),gray56:new e(143,143,143,255),grey56:new e(143,143,143,255),gray57:new e(145,145,145,255),grey57:new e(145,145,145,255),gray58:new e(148,148,148,255),grey58:new e(148,148,148,255),gray59:new e(150,150,150,255),grey59:new e(150,150,150,255),gray60:new e(153,153,153,255),grey60:new e(153,153,153,255),gray61:new e(156,156,156,255),grey61:new e(156,156,156,255),gray62:new e(158,158,158,255),grey62:new e(158,158,158,255),gray63:new e(161,161,161,255),grey63:new e(161,161,161,255),gray64:new e(163,163,163,255),grey64:new e(163,163,163,255),gray65:new e(166,166,166,255),grey65:new e(166,166,166,255),gray66:new e(168,168,168,255),grey66:new e(168,168,168,255),gray67:new e(171,171,171,255),grey67:new e(171,171,171,255),gray68:new e(173,173,173,255),grey68:new e(173,173,173,255),gray69:new e(176,176,176,255),grey69:new e(176,176,176,255),gray70:new e(179,179,179,255),grey70:new e(179,179,179,255),gray71:new e(181,181,181,255),grey71:new e(181,181,181,255),gray72:new e(184,184,184,255),grey72:new e(184,184,184,255),gray73:new e(186,186,186,255),grey73:new e(186,186,186,255),gray74:new e(189,189,189,255),grey74:new e(189,189,189,255),gray75:new e(191,191,191,255),grey75:new e(191,191,191,255),gray76:new e(194,194,194,255),grey76:new e(194,194,194,255),gray77:new e(196,196,196,255),grey77:new e(196,196,196,255),gray78:new e(199,199,199,255),grey78:new e(199,199,199,255),gray79:new e(201,201,201,255),grey79:new e(201,201,201,255),gray80:new e(204,204,204,255),grey80:new e(204,204,204,255),gray81:new e(207,207,207,255),grey81:new e(207,207,207,255),gray82:new e(209,209,209,255),grey82:new e(209,209,209,255),gray83:new e(212,212,212,255),grey83:new e(212,212,212,255),gray84:new e(214,214,214,255),grey84:new e(214,214,214,255),gray85:new e(217,217,217,255),grey85:new e(217,217,217,255),gray86:new e(219,219,219,255),grey86:new e(219,219,219,255),gray87:new e(222,222,222,255),grey87:new e(222,222,222,255),gray88:new e(224,224,224,255),grey88:new e(224,224,224,255),gray89:new e(227,227,227,255),grey89:new e(227,227,227,255),gray90:new e(229,229,229,255),grey90:new e(229,229,229,255),gray91:new e(232,232,232,255),grey91:new e(232,232,232,255),gray92:new e(235,235,235,255),grey92:new e(235,235,235,255),gray93:new e(237,237,237,255),grey93:new e(237,237,237,255),gray94:new e(240,240,240,255),grey94:new e(240,240,240,255),gray95:new e(242,242,242,255),grey95:new e(242,242,242,255),gray96:new e(245,245,245,255),grey96:new e(245,245,245,255),gray97:new e(247,247,247,255),grey97:new e(247,247,247,255),gray98:new e(250,250,250,255),grey98:new e(250,250,250,255),gray99:new e(252,252,252,255),grey99:new e(252,252,252,255),gray100:new e(255,255,255,255),grey100:new e(255,255,255,255),"dark grey":new e(169,169,169,255),DarkGrey:new e(169,169,169,255),"dark gray":new e(169,169,169,255),DarkGray:new e(169,169,169,255),"dark blue":new e(0,0,139,255),DarkBlue:new e(0,0,139,255),"dark cyan":new e(0,139,139,255),DarkCyan:new e(0,139,139,255),"dark magenta":new e(139,0,139,255),DarkMagenta:new e(139,0,139,255),"dark red":new e(139,0,0,255),DarkRed:new e(139,0,0,255),"light green":new e(144,238,144,255),LightGreen:new e(144,238,144,255),indigo:new e(75,0,130,255)}};return{make_color_table:e}}),define("src/color",["./color-x11"],function(e){var t=function(e){return e<0?0:e>255?255:e},n=Math.max,r=Math.min,i=function(e,t,n,r){this.red=e,this.green=t,this.blue=n,this.alpha=r};i.prototype={copy:function(){return new i(this.red,this.green,this.blue,this.alpha)},set:function(e,t,n,r){this.red=e,this.green=t,this.blue=n,this.alpha=r},set_from_color:function(e){this.set(e.red,e.green,e.blue,e.alpha)},to_string:function(){function e(e){var t=e.toString(16);while(t.length<2)t="0"+t;return t}return"#"+e(this.red)+e(this.green)+e(this.blue)+e(this.alpha)},to_hls:function(){var e=this.red/255,t=this.green/255,i=this.blue/255,s=n(n(e,t),i),o=r(r(e,t),i),u=(s+o)/2,a=0,f=0;if(s!==o){u<=.5?a=(s-o)/(s+o):a=(s-o)/(2-s-o);var l=s-o;e===s?f=(t-i)/l:t===s?f=2+(i-e)/l:i===s&&(f=4+(e-t)/l),f*=60,f<0&&(f+=360)}return[f,u,a]},to_pixel:function(){return this.alpha|this.blue<<8|this.green<<16|this.red<<24},add:function(e){return i.add(this,e)},subtract:function(e){return i.subtract(this,e)},lighten:function(){return this.shade(1.3)},darken:function(){return this.shade(.7)},shade:function(e){var t,n=this.to_hls();n[1]*=e,n[2]*=e;for(t=1;t<3;t++)n[t]=n[t]>1?1:n[t]<0?0:n[t];return i.from_hls(n[0],n[1],n[2],this.alpha)}};var s=e.make_color_table(i),o=/\(\s*([\-+]?\d*\.?\d+)\s*(%\s*)?,\s*([\-+]?\d*\.?\d+)\s*(%\s*)?,\s*([\-+]?\d*\.?\d+)\s*(%\s*)?(,\s*([\-+]?\d*\.?\d+)\s*(%\s*)?)?\)/,u=function(e,n){var r=e.trim().match(o);if(!r)return null;var s=parseFloat(r[1]);r[2]&&(s=s/100*255);var u=parseFloat(r[3]);r[4]&&(u=u/100*255);var a=parseFloat(r[5]);r[6]&&(a=a/100*255);var f=255;if(n){if(!r[7])return null;f=parseFloat(r[8]),r[9]&&(f/=100),f*=255}return new i(t(Math.round(s)),t(Math.round(u)),t(Math.round(a)),t(Math.round(f)))},a=function(e,n){var r=e.trim().match(o);if(!r)return null;var s=parseFloat(r[1]);r[2]&&(s=s/100*360),s=s<0?0:s>360?360:s;var u=parseFloat(r[3]);r[4]&&(u/=100),u=u<0?0:u>1?1:u;var a=parseFloat(r[5]);r[6]&&(a/=100),a=a<0?0:a>1?1:a;var f=255;if(n){if(!r[7])return null;f=parseFloat(r[8]),r[9]&&(f/=100),f*=255}return f=t(Math.round(f)),i.from_hls(s,u,a,f)},f=function(e){var t,n,r,s,o=parseInt(e,16);return o!==o?null:e.length===8?i.from_pixel(o):e.length===6?i.from_pixel(o<<8|255):e.length===4?(t=o>>12&15,n=o>>8&15,r=o>>4&15,s=o&15,new i(t*17,n*17,r*17,s*17)):e.length===3?(t=o>>8&15,n=o>>4&15,r=o&15,new i(t*17,n*17,r*17,255)):null};return i.from_string=function(e){return e.substr(0,3)==="rgb"?e.substr(0,4)==="rgba"?u(e.substr(4),!0):u(e.substr(3),!1):e.substr(0,3)==="hsl"?e.substr(0,4)==="hsla"?a(e.substr(4),!0):a(e.substr(3),!1):e.substr(0,1)==="#"?f(e.substr(1)):e in s?s[e]:null},i.from_pixel=function(e){return new i(e>>24&255,e>>16&255,e>>8&255,e&255)},i.from_hls=function(e,t,n,r){r===undefined&&(r=255),e/=360;if(n===0){var s=t*255;return new i(s,s,s,r)}var o;t<=.5?o=t*(1+n):o=t+n-t*n;var u=2*t-o,a=[e+1/3,e,e-1/3],f=[0,0,0],l;for(l=0;l<3;l++)a[l]<0&&(a[l]+=1),a[l]>1&&(a[l]-=1),6*a[l]<1?f[l]=u+(o-u)*a[l]*6:2*a[l]<1?f[l]=o:3*a[l]<2?f[l]=u+(o-u)*(2/3-a[l])*6:f[l]=u;return new i(Math.round(f[0]*255),Math.round(f[1]*255),Math.round(f[2]*255),r)},i.equal=function(e,t){return e===t?!0:e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha},i.add=function(e,r){return new i(t(e.red+r.red),t(e.green+r.green),t(e.blue+r.blue),n(e.alpha,r.alpha))},i.subtract=function(e,n){return new i(t(e.red-n.red),t(e.green-n.green),t(e.blue-n.blue),r(e.alpha,n.alpha))},i.interpolate=function(e,t,n){return new i(e.red+(t.red-e.red)*n,e.green+(t.green-e.green)*n,e.blue+(t.blue-e.blue)*n,e.alpha+(t.alpha-e.alpha)*n)},i.WHITE=i.from_string("#ffffffff"),i.BLACK=i.from_string("#000000ff"),i.RED=i.from_string("#ff0000ff"),i.DARK_RED=i.from_string("#800000ff"),i.GREEN=i.from_string("#00ff00ff"),i.DARK_GREEN=i.from_string("#008000ff"),i.BLUE=i.from_string("#0000ffff"),i.DARK_BLUE=i.from_string("#000080ff"),i.CYAN=i.from_string("#00ffffff"),i.DARK_CYAN=i.from_string("#008080ff"),i.MAGENTA=i.from_string("#ff00ffff"),i.DARK_MAGENTA=i.from_string("#800080ff"),i.YELLOW=i.from_string("#ffff00ff"),i.DARK_YELLOW=i.from_string("#808000ff"),i.GRAY=i.from_string("#a0a0a4ff"),i.DARK_GRAY=i.from_string("#808080ff"),i.LIGHT_GRAY=i.from_string("#c0c0c0ff"),i.BUTTER=i.from_string("#edd400ff"),i.BUTTER_LIGHT=i.from_string("#fce94fff"),i.BUTTER_DARK=i.from_string("#c4a000ff"),i.ORANGE=i.from_string("#f57900ff"),i.ORANGE_LIGHT=i.from_string("#fcaf3fff"),i.ORANGE_DARK=i.from_string("#ce5c00ff"),i.CHOCOLATE=i.from_string("#c17d11ff"),i.CHOCOLATE_LIGHT=i.from_string("#e9b96eff"),i.CHOCOLATE_DARK=i.from_string("#8f5902ff"),i.CHAMELEON=i.from_string("#73d216ff"),i.CHAMELEON_LIGHT=i.from_string("#8ae234ff"),i.CHAMELEON_DARK=i.from_string("#4e9a06ff"),i.SKY_BLUE=i.from_string("#3465a4ff"),i.SKY_BLUE_LIGHT=i.from_string("#729fcfff"),i.SKY_BLUE_DARK=i.from_string("#204a87ff"),i.PLUM=i.from_string("#75507bff"),i.PLUM_LIGHT=i.from_string("#ad7fa8ff"),i.PLUM_DARK=i.from_string("#5c3566ff"),i.SCARLET_RED=i.from_string("#cc0000ff"),i.SCARLET_RED_LIGHT=i.from_string("#ef2929ff"),i.SCARLET_RED_DARK=i.from_string("#a40000ff"),i.ALUMINIUM_1=i.from_string("#eeeeecff"),i.ALUMINIUM_2=i.from_string("#d3d7cfff"),i.ALUMINIUM_3=i.from_string("#babdb6ff"),i.ALUMINIUM_4=i.from_string("#888a85ff"),i.ALUMINIUM_5=i.from_string("#555753ff"),i.ALUMINIUM_6=i.from_string("#2e3436ff"),i.TRANSPARENT=i.from_string("#00000000"),i}),define("src/brush",["img!../brushes/brush-tile-129.png","./color"],function(e,t){var n=["hard","medium","rough fine","rough coarse","soft","dots small","dots large","rect","hlines","sticks","splotch","splotches coarse"];n.forEach(function(e,t){n[e]=t});var r={hard:.22,medium:.06,"rough fine":.09,"rough coarse":.2,soft:.11,"dots small":.67,"dots large":1,rect:.12,hlines:.1,sticks:.19,splotch:.25,"splotches coarse":.23},i={"rough fine":.5,"rough coarse":.5,sticks:.66,splotch:.6,"splotches coarse":1.2},s={rect:!0,hlines:!0},o=0;e&&(o=e.width/e.height);var u=function(e,t,n,r,i){this.set(e,t,n,r,i)};return u.prototype={},u.Types=n,u.fromJSON=function(e){var n=typeof e=="string"?JSON.parse(e):e,r=new t;r.set_from_color(n.color);var i=n.type===0?"hard":n.type===1?"soft":n.type;return new u(r,n.type,n.size,n.opacity,n.spacing)},u.prototype.equals=function(e){return this===e?!0:t.equal(this.color,e.color)&&this.type===e.type&&this.size===e.size&&this.opacity===e.opacity&&this.spacing===e.spacing},u.prototype.set=function(e,n,r,i,s){return this.color=e||t.BLACK,this.type=n||"hard",this.size=r||32,this.opacity=typeof i=="number"?i:1,this.spacing=s||.225,this},u.prototype.set_from_brush=function(e){return this.set(e.color,e.type,e.size,e.opacity,e.spacing)},u.prototype.setToDefaultSpacing=function(){return this.spacing=r[this.type]||.05,this},u.prototype.rotationIncrement=function(){return i[this.type]||0},u.prototype.followsTangent=function(){return!!s[this.type]},u.prototype.clone=function(){return new u(this.color,this.type,this.size,this.opacity,this.spacing)},u.prototype.toCanvas=function(){var t=Math.floor(e.height/2),n=Math.min(Math.max(1,Math.ceil(this.size/2)),t),r=n*2+1,i=document.createElement("canvas");i.width=i.height=r;var s=i.getContext("2d");s.fillStyle=this.color.to_string().replace(/..$/,""),s.fillRect(0,0,i.width,i.height),s.translate(n+.5,n+.5);var o=Math.max(2,this.size+1)/e.height;s.scale(o,o);var a=0;return u.Types.hasOwnProperty(this.type)?a=u.Types[this.type]:console.warn("Unknown brush type",this.type),a*=e.height,s.globalCompositeOperation="destination-in",s.drawImage(e,-t-.5-a,-t-.5),i},u}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!src/brushdialog.html",[],function(){return'<!-- this is innerHTML for a wrapper div -->\n    <div class="page_select">\n      <a class="color_select" href="#"><span></span></a><!--\n      --><a class="brush_select" href="#"><span></span></a>\n    </div>\n    <div class="panes">\n      <div class="color_options">\n        <div class="swatches">\n             <a href="#" class="white"><span></span></a><!--\n          --><a href="#" class="old"><span></span></a><!--\n          --><a          class="new" tabindex="-1"><span></span></a><!--\n          --><a href="#" class="black"><span></span></a>\n        </div>\n        <div class="wheel">\n          <div class="color" tabindex="0">\n            <div class="white"></div>\n            <div class="black"></div>\n          </div>\n          <div class="thumb"></div>\n          <input type="hidden" class="color_hue" />\n          <input type="hidden" class="color_saturation" />\n        </div>\n        <div class="lightness">\n          <input class="color_lightness" type="hidden" />\n        </div>\n      </div>\n      <div class="brush_options">\n        <div class="stroke"></div>\n        <div class="shape" tabindex="0"><div class="scrollwrapper"><div class="allbrushes"></div></div></div>\n        <div class="spacing">\n          <div class="caption" data-amount="1"></div>\n          <a class="minus" href="#" tabindex="-1"></a><input class="brush_spacing" type="hidden" /><a class="plus" href="#" tabindex="-1"></a>\n        </div>\n        <div class="size">\n          <div class="caption" data-amount="1"></div>\n          <a class="minus" href="#" tabindex="-1"></a><input class="brush_size" type="hidden" /><a class="plus" href="#" tabindex="-1"></a>\n        </div>\n      </div>\n    </div>\n    <div class="spacer"></div>\n    <div class="opacity_options">\n     <input class="color_opacity" type="hidden" />\n    </div>\n    <div class="close_pane">\n      <a class="closer" href="#"></a>\n    </div>\n    <input type="hidden" class="old_color_hue" />\n    <input type="hidden" class="old_color_saturation" />\n    <input type="hidden" class="old_color_lightness"  />\n    <input type="hidden" class="old_color_opacity"  />\n'}),define("src/coords",[],function(){var e=function(t){if(t.getBoundingClientRect){var n=t.getBoundingClientRect();return{x:n.left+document.body.scrollLeft,y:n.top+document.body.scrollTop}}var r={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var i=e(t.offsetParent);r.x+=i.x,r.y+=i.y}return r},t=function(t,n){var r,i,s;t=t||window.event;var o=t.target||t.srcElement;if(!window.opera&&typeof t.offsetX!="undefined"){s={x:t.offsetX,y:t.offsetY};var u=o;while(u)u.mouseX=s.x,u.mouseY=s.y,s.x+=u.offsetLeft,s.y+=u.offsetTop,u=u.offsetParent;u=n;var a={x:0,y:0};while(u){if(typeof u.mouseX!="undefined"){r=u.mouseX-a.x,i=u.mouseY-a.y;break}a.x+=u.offsetLeft,a.y+=u.offsetTop,u=u.offsetParent}u=o;while(u)u.mouseX=undefined,u.mouseY=undefined,u=u.offsetParent}else s=e(n),r=t.pageX-s.x,i=t.pageY-s.y;return{x:r,y:i}};return{getRelativeEventPosition:t,getAbsolutePosition:e}}),define("src/colorwheel",["./color","./coords"],function(e,t){var n=function(e,t){this.domElement=e,this.container=t||e,this.hue=this.saturation=this.lightness=null,this.setHSL(0,0,0);var n=function(e,t,n){(n||this.container).addEventListener(e,t,!0)}.bind(this),r=function(e,t,n){(n||this.container).removeEventListener(e,t,!0)}.bind(this),i,s,o,u;i=function(e){this._updateThumbFromEvent(e),this.domElement.querySelector(".color").focus(),e.type==="mousedown"?(n("mousemove",s),n("mouseup",o),n("mouseout",u)):(n("touchmove",s),n("touchend",o),n("touchcancel",o),n("touchleave",o),e.preventDefault())}.bind(this),s=function(e){this._updateThumbFromEvent(e)}.bind(this),u=function(e){var t=e.relatedTarget,n=this;(!t||t!==n&&!n.contains(t))&&o(e)},o=function(e){this._updateThumbFromEvent(e),e.type==="mouseup"||e.type==="mouseout"?(r("mousemove",s),r("mouseup",o),r("mouseout",u)):(r("touchmove",s),r("touchend",o),r("touchcancel",o),r("touchleave",o))}.bind(this),n("mousedown",i,this.domElement),n("touchstart",i,this.domElement);var a=function(e){var t=2;e=e||document.parentWindow.event;var n=e.keyCode!=null?e.keyCode:e.charCode,r=this.hue,i=this.saturation;switch(n){case 37:r-=t;break;case 39:r+=t;break;case 38:case 33:i+=t;break;case 40:case 34:i-=t;break;default:return!0}return e.stopPropagation(),e.preventDefault(),r<0&&(r=255),r>255&&(r=0),i=Math.max(0,Math.min(i,255)),this.hue=r,this.saturation=i,this._updateThumbPosition(),this._updateThumbColor(),this.hsCallback(r,i),!1};n("keypress",a,this.domElement)};return n.prototype={},n.prototype._pol2xy=function(e,t,n){n||(n=this.domElement.querySelector(".color").clientWidth);var r=2*Math.PI*e/256,i=t*(n/2)/255,s=Math.cos(r)*i,o=-Math.sin(r)*i;return{x:s,y:o}},n.prototype._updateThumbFromEvent=function(e){if(e.touches){if(e.touches.length===0)return;e={type:e.type,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY,clientX:e.touches[0].clientX,clientY:e.touches[0].clientY,target:e.touches[0].target||e.target||e.srcElement}}var n=this.domElement.querySelector(".color"),r=t.getRelativeEventPosition(e,n),i=r.x-n.offsetWidth/2,s=r.y-n.offsetHeight/2,o=i/(n.clientHeight/2),u=s/(n.clientHeight/2),a=Math.atan2(-u,o)/(2*Math.PI),f=Math.sqrt(o*o+u*u);a<0&&(a+=1),f>1&&(i=s=null),this.hue=Math.round(Math.min(a*256,255)),this.saturation=Math.round(Math.min(f*255,255)),this._updateThumbPosition(i,s),this._updateThumbColor(),this.hsCallback(this.hue,this.saturation)},n.prototype._updateThumbPosition=function(e,t){var n={x:e,y:t};typeof n.x!="number"&&(n=this._pol2xy(this.hue,this.saturation));var r=this.domElement.querySelector(".thumb"),i=Math.round(n.x)+"px,"+Math.round(n.y)+"px";r.style.WebkitTransform="translate3d("+i+",0)",r.style.MozTransform=r.style.transform="translate("+i+")"},n.prototype._updateThumbColor=function(){var t=this.domElement.querySelector(".thumb"),n=e.from_hls(this.hue*360/256,this.lightness/255,this.saturation/255,255);t.style.color=n.to_string().substring(0,7)},n.prototype.setHSL=function(e,t,n){var r=this.hue!==e||this.saturation!==t,i=this.lightness!==n;r&&(this.hue=e,this.saturation=t,this._updateThumbPosition()),i?this.setLightness(n):r&&this._updateThumbColor()},n.prototype.setLightness=function(e){if(e===this.lightness)return;this.lightness=e;var t=this.domElement.querySelector(".white"),n=this.domElement.querySelector(".black");e/=255,e<.5?(t.style.opacity=0,n.style.opacity=1-e*2):(t.style.opacity=e*2-1,n.style.opacity=0),this._updateThumbColor()},n.prototype.onResize=function(){this._updateThumbPosition()},n.prototype.hsCallback=function(e,t){},n}),define("src/compat",[],function(){Function.prototype.bind||(Function.prototype.bind=function(e){var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Object.freeze||(Object.freeze=function(e){return e});var e=function(){console.warn("Faking Web Worker creation.")};e.prototype={postMessage:function(e){},addEventListener:function(e,t){}};var t={Worker:typeof Worker=="undefined"?e:Worker,Uint8Array:typeof Uint8Array=="undefined"?Array:Uint8Array,Float64Array:typeof Float64Array=="undefined"?Array:Float64Array};return typeof window!="undefined"&&function(){var e=0,n=["ms","moz","webkit","o"],r;for(r=0;r<n.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[n[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[r]+"CancelAnimationFrame"]||window[n[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.log("Using requestAnimationFrame fallback."),window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),t.requestAnimationFrame=window.requestAnimationFrame.bind(window),t.cancelAnimationFrame=window.cancelAnimationFrame.bind(window)}(),typeof document!="undefined"&&!("classList"in document.createElement("a"))&&function(e){if(!("HTMLElement"in e||"Element"in e))return;var t="classList",n="prototype",r=(e.HTMLElement||e.Element)[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.className),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.className=this.toString()}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(e){e+="",a(this,e)===-1&&(this.push(e),this._updateClassName())},l.remove=function(e){e+="";var t=a(this,e);t!==-1&&(this.splice(t,1),this._updateClassName())},l.toggle=function(e){e+="",a(this,e)===-1?this.add(e):this.remove(e)},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(self),t}),define("src/drawcommand",["./color","./compat","./brush"],function(e,t,n){var r={DRAW:0,DRAW_END:1,COLOR_CHANGE:2,BRUSH_CHANGE:3,DRAW_START:4,NUM_COMMAND_TYPES:5};Object.freeze(r);var i=function(e){console.assert(e>=0&&e<r.NUM_COMMAND_TYPES),this.type=e};return i.prototype={},i.Type=r,i.fromJSON=function(t){var n=typeof t=="string"?JSON.parse(t):t,r=new i(n.type),s;for(s in n)if(n.hasOwnProperty(s))if(s==="color")r[s]=new e,r[s].set_from_color(n[s]);else if(s==="brush_type"){var o=n[s];r[s]=o===0?"hard":o===1?"soft":o}else r[s]=n[s];return r},i.create_draw_start=function(e){e||(e=0);var t=new i(r.DRAW_START);return t.layer=e,t},i.create_draw=function(e,t){t||(t=Date.now());var n=new i(r.DRAW);return n.pos={x:e.x,y:e.y},n.time=t,n},i.create_draw_end=function(){var e=new i(r.DRAW_END);return e},i.create_color_change=function(e){var t=new i(r.COLOR_CHANGE);return t.color=e.copy(),t},i.create_brush_change=function(e){e=e||{};var t=new i(r.BRUSH_CHANGE);return["brush_type","size","opacity","spacing"].forEach(function(n){n in e&&(t[n]=e[n])}),t},i}),define("src/hslcolor",["./color"],function(e){var t=function(e){return e<0?0:e>255?255:e},n=Math.max,r=Math.min,i=function(e,n,r,i){this.hue=t(e),this.saturation=t(n),this.lightness=t(r),this.opacity=t(i)};return i.prototype.copy=function(){return new i(this.hue,this.saturation,this.lightness,this.opacity)},i.prototype.shade=function(e){var n=t(this.saturation*e),r=t(this.lightness*e);return new i(this.hue,n,r,this.opacity)},i.prototype.lighten=function(){return this.shade(1.3)},i.prototype.darken=function(){return this.shade(.7)},i.prototype.rgbaColor=function(){return e.from_hls(this.hue*360/256,this.lightness/255,this.saturation/255,this.opacity)},i.prototype.rgbString=function(){var e=this.rgbaColor();return"rgb("+Math.round(e.red)+","+Math.round(e.green)+","+Math.round(e.blue)+")"},i.prototype.rgbaString=function(){var e=this.rgbaColor();return"rgba("+Math.round(e.red)+","+Math.round(e.green)+","+Math.round(e.blue)+","+e.alpha/255+")"},i.from_color=function(e){var t=e.to_hls();return new i(t[0]*256/360,t[2]*255,t[1]*255,e.alpha)},i.from_rgba=function(t,n,r,s){return i.from_color(new e(t,n,r,s))},i.equal=function(e,t){return e===t?!0:e.hue===t.hue&&e.saturation===t.saturation&&e.lightness===t.lightness&&e.opacity===t.opacity},i}),define("src/iscroll",[],function(){return function(e,t){function O(e){return i===""?e:(e=e.charAt(0).toUpperCase()+e.substr(1),i+e)}var n=Math,r=t.createElement("div").style,i=function(){var e="t,webkitT,MozT,msT,OT".split(","),t,n=0,i=e.length;for(;n<i;n++){t=e[n]+"ransform";if(t in r)return e[n].substr(0,e[n].length-1)}return!1}(),s=i?"-"+i.toLowerCase()+"-":"",o=O("transform"),u=O("transitionProperty"),a=O("transitionDuration"),f=O("transformOrigin"),l=O("transitionTimingFunction"),c=O("transitionDelay"),h=/android/gi.test(navigator.appVersion),p=/iphone|ipad/gi.test(navigator.appVersion),d=/hp-tablet/gi.test(navigator.appVersion),v=O("perspective")in r,m="ontouchstart"in e&&!d,g=!!i,y=O("transition")in r,b="onorientationchange"in e?"orientationchange":"resize",w=m?"touchstart":"mousedown",E=m?"touchmove":"mousemove",S=m?"touchend":"mouseup",x=m?"touchcancel":"mouseup",T=i=="Moz"?"DOMMouseScroll":"mousewheel",N=function(){if(i===!1)return!1;var e={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return e[i]}(),C=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){return setTimeout(e,1)}}(),k=function(){return e.cancelRequestAnimationFrame||e.webkitCancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}(),L=v?" translateZ(0)":"",A=function(n,r){var i=this,c;i.wrapper=typeof n=="object"?n:t.getElementById(n),i.wrapper.style.overflow="hidden",i.scroller=i.wrapper.children[0],i.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:h,hideScrollbar:p,fadeScrollbar:p&&v,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(c in r)i.options[c]=r[c];i.x=i.options.x,i.y=i.options.y,i.options.useTransform=g&&i.options.useTransform,i.options.hScrollbar=i.options.hScroll&&i.options.hScrollbar,i.options.vScrollbar=i.options.vScroll&&i.options.vScrollbar,i.options.zoom=i.options.useTransform&&i.options.zoom,i.options.useTransition=y&&i.options.useTransition,i.options.zoom&&h&&(L=""),i.scroller.style[u]=i.options.useTransform?s+"transform":"top left",i.scroller.style[a]="0",i.scroller.style[f]="0 0",i.options.useTransition&&(i.scroller.style[l]="cubic-bezier(0.33,0.66,0.66,1)"),i.options.useTransform?i.scroller.style[o]="translate("+i.x+"px,"+i.y+"px)"+L:i.scroller.style.cssText+=";position:absolute;top:"+i.y+"px;left:"+i.x+"px",i.options.useTransition&&(i.options.fixedScrollbar=!0),i.refresh(),i._bind(b,e),i._bind(w),m||i.options.wheelAction!="none"&&i._bind(T),i.options.checkDOMChanges&&(i.checkDOMTime=setInterval(function(){i._checkDOMChanges()},500))};return A.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var t=this;switch(e.type){case w:if(!m&&e.button!==0)return;t._start(e);break;case E:t._move(e);break;case S:case x:t._end(e);break;case b:t._resize();break;case T:t._wheel(e);break;case N:t._transitionEnd(e)}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(e){var r=this,i;if(!r[e+"Scrollbar"]){r[e+"ScrollbarWrapper"]&&(g&&(r[e+"ScrollbarIndicator"].style[o]=""),r[e+"ScrollbarWrapper"].parentNode.removeChild(r[e+"ScrollbarWrapper"]),r[e+"ScrollbarWrapper"]=null,r[e+"ScrollbarIndicator"]=null);return}r[e+"ScrollbarWrapper"]||(i=t.createElement("div"),r.options.scrollbarClass?i.className=r.options.scrollbarClass+e.toUpperCase():i.style.cssText="position:absolute;z-index:100;"+(e=="h"?"height:7px;bottom:1px;left:2px;right:"+(r.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(r.hScrollbar?"7":"2")+"px;top:2px;right:1px"),i.style.cssText+=";pointer-events:none;"+s+"transition-property:opacity;"+s+"transition-duration:"+(r.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(r.options.hideScrollbar?"0":"1"),r.wrapper.appendChild(i),r[e+"ScrollbarWrapper"]=i,i=t.createElement("div"),r.options.scrollbarClass||(i.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+s+"background-clip:padding-box;"+s+"box-sizing:border-box;"+(e=="h"?"height:100%":"width:100%")+";"+s+"border-radius:3px;border-radius:3px"),i.style.cssText+=";pointer-events:none;"+s+"transition-property:"+s+"transform;"+s+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+s+"transition-duration:0;"+s+"transform: translate(0,0)"+L,r.options.useTransition&&(i.style.cssText+=";"+s+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),r[e+"ScrollbarWrapper"].appendChild(i),r[e+"ScrollbarIndicator"]=i),e=="h"?(r.hScrollbarSize=r.hScrollbarWrapper.clientWidth,r.hScrollbarIndicatorSize=n.max(n.round(r.hScrollbarSize*r.hScrollbarSize/r.scrollerW),8),r.hScrollbarIndicator.style.width=r.hScrollbarIndicatorSize+"px",r.hScrollbarMaxScroll=r.hScrollbarSize-r.hScrollbarIndicatorSize,r.hScrollbarProp=r.hScrollbarMaxScroll/r.maxScrollX):(r.vScrollbarSize=r.vScrollbarWrapper.clientHeight,r.vScrollbarIndicatorSize=n.max(n.round(r.vScrollbarSize*r.vScrollbarSize/r.scrollerH),8),r.vScrollbarIndicator.style.height=r.vScrollbarIndicatorSize+"px",r.vScrollbarMaxScroll=r.vScrollbarSize-r.vScrollbarIndicatorSize,r.vScrollbarProp=r.vScrollbarMaxScroll/r.maxScrollY),r._scrollbarPos(e,!0)},_resize:function(){var e=this;setTimeout(function(){e.refresh()},h?200:0)},_pos:function(e,t){if(this.zoomed)return;e=this.hScroll?e:0,t=this.vScroll?t:0,this.options.useTransform?this.scroller.style[o]="translate("+e+"px,"+t+"px) scale("+this.scale+")"+L:(e=n.round(e),t=n.round(t),this.scroller.style.left=e+"px",this.scroller.style.top=t+"px"),this.x=e,this.y=t,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(e,t){var r=this,i=e=="h"?r.x:r.y,s;if(!r[e+"Scrollbar"])return;i=r[e+"ScrollbarProp"]*i,i<0?(r.options.fixedScrollbar||(s=r[e+"ScrollbarIndicatorSize"]+n.round(i*3),s<8&&(s=8),r[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=s+"px"),i=0):i>r[e+"ScrollbarMaxScroll"]&&(r.options.fixedScrollbar?i=r[e+"ScrollbarMaxScroll"]:(s=r[e+"ScrollbarIndicatorSize"]-n.round((i-r[e+"ScrollbarMaxScroll"])*3),s<8&&(s=8),r[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=s+"px",i=r[e+"ScrollbarMaxScroll"]+(r[e+"ScrollbarIndicatorSize"]-s))),r[e+"ScrollbarWrapper"].style[c]="0",r[e+"ScrollbarWrapper"].style.opacity=t&&r.options.hideScrollbar?"0":"1",r[e+"ScrollbarIndicator"].style[o]="translate("+(e=="h"?i+"px,0)":"0,"+i+"px)")+L},_start:function(t){var r=this,i=m?t.touches[0]:t,s,u,a,f,l;if(!r.enabled)return;r.options.onBeforeScrollStart&&r.options.onBeforeScrollStart.call(r,t),(r.options.useTransition||r.options.zoom)&&r._transitionTime(0),r.moved=!1,r.animating=!1,r.zoomed=!1,r.distX=0,r.distY=0,r.absDistX=0,r.absDistY=0,r.dirX=0,r.dirY=0,r.options.zoom&&m&&t.touches.length>1&&(f=n.abs(t.touches[0].pageX-t.touches[1].pageX),l=n.abs(t.touches[0].pageY-t.touches[1].pageY),r.touchesDistStart=n.sqrt(f*f+l*l),r.originX=n.abs(t.touches[0].pageX+t.touches[1].pageX-r.wrapperOffsetLeft*2)/2-r.x,r.originY=n.abs(t.touches[0].pageY+t.touches[1].pageY-r.wrapperOffsetTop*2)/2-r.y,r.options.onZoomStart&&r.options.onZoomStart.call(r,t));if(r.options.momentum){r.options.useTransform?(s=getComputedStyle(r.scroller,null)[o].replace(/[^0-9\-.,]/g,"").split(","),u=+s[4],a=+s[5]):(u=+getComputedStyle(r.scroller,null).left.replace(/[^0-9-]/g,""),a=+getComputedStyle(r.scroller,null).top.replace(/[^0-9-]/g,""));if(u!=r.x||a!=r.y)r.options.useTransition?r._unbind(N):k(r.aniTime),r.steps=[],r._pos(u,a),r.options.onScrollEnd&&r.options.onScrollEnd.call(r)}r.absStartX=r.x,r.absStartY=r.y,r.startX=r.x,r.startY=r.y,r.pointX=i.pageX,r.pointY=i.pageY,r.startTime=t.timeStamp||Date.now(),r.options.onScrollStart&&r.options.onScrollStart.call(r,t),r._bind(E,e),r._bind(S,e),r._bind(x,e)},_move:function(e){var t=this,r=m?e.touches[0]:e,i=r.pageX-t.pointX,s=r.pageY-t.pointY,u=t.x+i,a=t.y+s,f,l,c,h=e.timeStamp||Date.now();t.options.onBeforeScrollMove&&t.options.onBeforeScrollMove.call(t,e);if(t.options.zoom&&m&&e.touches.length>1){f=n.abs(e.touches[0].pageX-e.touches[1].pageX),l=n.abs(e.touches[0].pageY-e.touches[1].pageY),t.touchesDist=n.sqrt(f*f+l*l),t.zoomed=!0,c=1/t.touchesDistStart*t.touchesDist*this.scale,c<t.options.zoomMin?c=.5*t.options.zoomMin*Math.pow(2,c/t.options.zoomMin):c>t.options.zoomMax&&(c=2*t.options.zoomMax*Math.pow(.5,t.options.zoomMax/c)),t.lastScale=c/this.scale,u=this.originX-this.originX*t.lastScale+this.x,a=this.originY-this.originY*t.lastScale+this.y,this.scroller.style[o]="translate("+u+"px,"+a+"px) scale("+c+")"+L,t.options.onZoom&&t.options.onZoom.call(t,e);return}t.pointX=r.pageX,t.pointY=r.pageY;if(u>0||u<t.maxScrollX)u=t.options.bounce?t.x+i/2:u>=0||t.maxScrollX>=0?0:t.maxScrollX;if(a>t.minScrollY||a<t.maxScrollY)a=t.options.bounce?t.y+s/2:a>=t.minScrollY||t.maxScrollY>=0?t.minScrollY:t.maxScrollY;t.distX+=i,t.distY+=s,t.absDistX=n.abs(t.distX),t.absDistY=n.abs(t.distY);if(t.absDistX<6&&t.absDistY<6)return;t.options.lockDirection&&(t.absDistX>t.absDistY+5?(a=t.y,s=0):t.absDistY>t.absDistX+5&&(u=t.x,i=0)),t.moved=!0,t._pos(u,a),t.dirX=i>0?-1:i<0?1:0,t.dirY=s>0?-1:s<0?1:0,h-t.startTime>300&&(t.startTime=h,t.startX=t.x,t.startY=t.y),t.options.onScrollMove&&t.options.onScrollMove.call(t,e)},_end:function(r){if(m&&r.touches.length!==0)return;var i=this,s=m?r.changedTouches[0]:r,u,f,l={dist:0,time:0},c={dist:0,time:0},h=(r.timeStamp||Date.now())-i.startTime,p=i.x,d=i.y,v,g,y,b,w;i._unbind(E,e),i._unbind(S,e),i._unbind(x,e),i.options.onBeforeScrollEnd&&i.options.onBeforeScrollEnd.call(i,r);if(i.zoomed){w=i.scale*i.lastScale,w=Math.max(i.options.zoomMin,w),w=Math.min(i.options.zoomMax,w),i.lastScale=w/i.scale,i.scale=w,i.x=i.originX-i.originX*i.lastScale+i.x,i.y=i.originY-i.originY*i.lastScale+i.y,i.scroller.style[a]="200ms",i.scroller.style[o]="translate("+i.x+"px,"+i.y+"px) scale("+i.scale+")"+L,i.zoomed=!1,i.refresh(),i.options.onZoomEnd&&i.options.onZoomEnd.call(i,r);return}if(!i.moved){m&&(i.doubleTapTimer&&i.options.zoom?(clearTimeout(i.doubleTapTimer),i.doubleTapTimer=null,i.options.onZoomStart&&i.options.onZoomStart.call(i,r),i.zoom(i.pointX,i.pointY,i.scale==1?i.options.doubleTapZoom:1),i.options.onZoomEnd&&setTimeout(function(){i.options.onZoomEnd.call(i,r)},200)):this.options.handleClick&&(i.doubleTapTimer=setTimeout(function(){i.doubleTapTimer=null,u=s.target;while(u.nodeType!=1)u=u.parentNode;u.tagName!="SELECT"&&u.tagName!="INPUT"&&u.tagName!="TEXTAREA"&&(f=t.createEvent("MouseEvents"),f.initMouseEvent("click",!0,!0,r.view,1,s.screenX,s.screenY,s.clientX,s.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,0,null),f._fake=!0,u.dispatchEvent(f))},i.options.zoom?250:0))),i._resetPos(400),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(h<300&&i.options.momentum){l=p?i._momentum(p-i.startX,h,-i.x,i.scrollerW-i.wrapperW+i.x,i.options.bounce?i.wrapperW:0):l,c=d?i._momentum(d-i.startY,h,-i.y,i.maxScrollY<0?i.scrollerH-i.wrapperH+i.y-i.minScrollY:0,i.options.bounce?i.wrapperH:0):c,p=i.x+l.dist,d=i.y+c.dist;if(i.x>0&&p>0||i.x<i.maxScrollX&&p<i.maxScrollX)l={dist:0,time:0};if(i.y>i.minScrollY&&d>i.minScrollY||i.y<i.maxScrollY&&d<i.maxScrollY)c={dist:0,time:0}}if(l.dist||c.dist){y=n.max(n.max(l.time,c.time),10),i.options.snap&&(v=p-i.absStartX,g=d-i.absStartY,n.abs(v)<i.options.snapThreshold&&n.abs(g)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(b=i._snap(p,d),p=b.x,d=b.y,y=n.max(b.time,y))),i.scrollTo(n.round(p),n.round(d),y),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(i.options.snap){v=p-i.absStartX,g=d-i.absStartY,n.abs(v)<i.options.snapThreshold&&n.abs(g)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(b=i._snap(i.x,i.y),(b.x!=i.x||b.y!=i.y)&&i.scrollTo(b.x,b.y,b.time)),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}i._resetPos(200),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r)},_resetPos:function(e){var t=this,n=t.x>=0?0:t.x<t.maxScrollX?t.maxScrollX:t.x,r=t.y>=t.minScrollY||t.maxScrollY>0?t.minScrollY:t.y<t.maxScrollY?t.maxScrollY:t.y;if(n==t.x&&r==t.y){t.moved&&(t.moved=!1,t.options.onScrollEnd&&t.options.onScrollEnd.call(t)),t.hScrollbar&&t.options.hideScrollbar&&(i=="webkit"&&(t.hScrollbarWrapper.style[c]="300ms"),t.hScrollbarWrapper.style.opacity="0"),t.vScrollbar&&t.options.hideScrollbar&&(i=="webkit"&&(t.vScrollbarWrapper.style[c]="300ms"),t.vScrollbarWrapper.style.opacity="0");return}t.scrollTo(n,r,e||0)},_wheel:function(e){var t=this,n,r,i,s,o;if("wheelDeltaX"in e)n=e.wheelDeltaX/12,r=e.wheelDeltaY/12;else if("wheelDelta"in e)n=r=e.wheelDelta/12;else{if(!("detail"in e))return;n=r=-e.detail*3}if(t.options.wheelAction=="zoom"){o=t.scale*Math.pow(2,1/3*(r?r/Math.abs(r):0)),o<t.options.zoomMin&&(o=t.options.zoomMin),o>t.options.zoomMax&&(o=t.options.zoomMax),o!=t.scale&&(!t.wheelZoomCount&&t.options.onZoomStart&&t.options.onZoomStart.call(t,e),t.wheelZoomCount++,t.zoom(e.pageX,e.pageY,o,400),setTimeout(function(){t.wheelZoomCount--,!t.wheelZoomCount&&t.options.onZoomEnd&&t.options.onZoomEnd.call(t,e)},400));return}i=t.x+n,s=t.y+r,i>0?i=0:i<t.maxScrollX&&(i=t.maxScrollX),s>t.minScrollY?s=t.minScrollY:s<t.maxScrollY&&(s=t.maxScrollY),t.maxScrollY<0&&t.scrollTo(i,s,0)},_transitionEnd:function(e){var t=this;if(e.target!=t.scroller)return;t._unbind(N),t._startAni()},_startAni:function(){var e=this,t=e.x,r=e.y,i=Date.now(),s,o,u;if(e.animating)return;if(!e.steps.length){e._resetPos(400);return}s=e.steps.shift(),s.x==t&&s.y==r&&(s.time=0),e.animating=!0,e.moved=!0;if(e.options.useTransition){e._transitionTime(s.time),e._pos(s.x,s.y),e.animating=!1,s.time?e._bind(N):e._resetPos(0);return}u=function(){var a=Date.now(),f,l;if(a>=i+s.time){e._pos(s.x,s.y),e.animating=!1,e.options.onAnimationEnd&&e.options.onAnimationEnd.call(e),e._startAni();return}a=(a-i)/s.time-1,o=n.sqrt(1-a*a),f=(s.x-t)*o+t,l=(s.y-r)*o+r,e._pos(f,l),e.animating&&(e.aniTime=C(u))},u()},_transitionTime:function(e){e+="ms",this.scroller.style[a]=e,this.hScrollbar&&(this.hScrollbarIndicator.style[a]=e),this.vScrollbar&&(this.vScrollbarIndicator.style[a]=e)},_momentum:function(e,t,r,i,s){var o=6e-4,u=n.abs(e)/t,a=u*u/(2*o),f=0,l=0;return e>0&&a>r?(l=s/(6/(a/u*o)),r+=l,u=u*r/a,a=r):e<0&&a>i&&(l=s/(6/(a/u*o)),i+=l,u=u*i/a,a=i),a*=e<0?-1:1,f=u/o,{dist:a,time:n.round(f)}},_offset:function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent)t-=e.offsetLeft,n-=e.offsetTop;return e!=this.wrapper&&(t*=this.scale,n*=this.scale),{left:t,top:n}},_snap:function(e,t){var r=this,i,s,o,u,a,f;o=r.pagesX.length-1;for(i=0,s=r.pagesX.length;i<s;i++)if(e>=r.pagesX[i]){o=i;break}o==r.currPageX&&o>0&&r.dirX<0&&o--,e=r.pagesX[o],a=n.abs(e-r.pagesX[r.currPageX]),a=a?n.abs(r.x-e)/a*500:0,r.currPageX=o,o=r.pagesY.length-1;for(i=0;i<o;i++)if(t>=r.pagesY[i]){o=i;break}return o==r.currPageY&&o>0&&r.dirY<0&&o--,t=r.pagesY[o],f=n.abs(t-r.pagesY[r.currPageY]),f=f?n.abs(r.y-t)/f*500:0,r.currPageY=o,u=n.round(n.max(a,f))||200,{x:e,y:t,time:u}},_bind:function(e,t,n){(t||this.scroller).addEventListener(e,this,!!n)},_unbind:function(e,t,n){(t||this.scroller).removeEventListener(e,this,!!n)},destroy:function(){var t=this;t.scroller.style[o]="",t.hScrollbar=!1,t.vScrollbar=!1,t._scrollbar("h"),t._scrollbar("v"),t._unbind(b,e),t._unbind(w),t._unbind(E,e),t._unbind(S,e),t._unbind(x,e),t.options.hasTouch||t._unbind(T),t.options.useTransition&&t._unbind(N),t.options.checkDOMChanges&&clearInterval(t.checkDOMTime),t.options.onDestroy&&t.options.onDestroy.call(t)},refresh:function(){var e=this,t,r,i,s,o=0,u=0;e.scale<e.options.zoomMin&&(e.scale=e.options.zoomMin),e.wrapperW=e.wrapper.clientWidth||1,e.wrapperH=e.wrapper.clientHeight||1,e.minScrollY=-e.options.topOffset||0,e.scrollerW=n.round(e.scroller.offsetWidth*e.scale),e.scrollerH=n.round((e.scroller.offsetHeight+e.minScrollY)*e.scale),e.maxScrollX=e.wrapperW-e.scrollerW,e.maxScrollY=e.wrapperH-e.scrollerH+e.minScrollY,e.dirX=0,e.dirY=0,e.options.onRefresh&&e.options.onRefresh.call(e),e.hScroll=e.options.hScroll&&e.maxScrollX<0,e.vScroll=e.options.vScroll&&(!e.options.bounceLock&&!e.hScroll||e.scrollerH>e.wrapperH),e.hScrollbar=e.hScroll&&e.options.hScrollbar,e.vScrollbar=e.vScroll&&e.options.vScrollbar&&e.scrollerH>e.wrapperH,t=e._offset(e.wrapper),e.wrapperOffsetLeft=-t.left,e.wrapperOffsetTop=-t.top;if(typeof e.options.snap=="string"){e.pagesX=[],e.pagesY=[],s=e.scroller.querySelectorAll(e.options.snap);for(r=0,i=s.length;r<i;r++)o=e._offset(s[r]),o.left+=e.wrapperOffsetLeft,o.top+=e.wrapperOffsetTop,e.pagesX[r]=o.left<e.maxScrollX?e.maxScrollX:o.left*e.scale,e.pagesY[r]=o.top<e.maxScrollY?e.maxScrollY:o.top*e.scale}else if(typeof e.options.snap=="number"){e.pagesX=[];while(o>=e.maxScrollX)e.pagesX[u]=o,o-=e.options.snap,u++;e.maxScrollX%e.options.snap&&(e.pagesX[e.pagesX.length]=e.maxScrollX-e.pagesX[e.pagesX.length-1]+e.pagesX[e.pagesX.length-1]),o=0,u=0,e.pagesY=[];while(o>=e.maxScrollY)e.pagesY[u]=o,o-=e.options.snap,u++;e.maxScrollY%e.options.snap&&(e.pagesY[e.pagesY.length]=e.maxScrollY-e.pagesY[e.pagesY.length-1]+e.pagesY[e.pagesY.length-1])}else if(e.options.snap){e.pagesX=[];while(o>=e.maxScrollX)e.pagesX[u]=o,o-=e.wrapperW,u++;e.maxScrollX%e.wrapperW&&(e.pagesX[e.pagesX.length]=e.maxScrollX-e.pagesX[e.pagesX.length-1]+e.pagesX[e.pagesX.length-1]),o=0,u=0,e.pagesY=[];while(o>=e.maxScrollY)e.pagesY[u]=o,o-=e.wrapperH,u++;e.maxScrollY%e.wrapperH&&(e.pagesY[e.pagesY.length]=e.maxScrollY-e.pagesY[e.pagesY.length-1]+e.pagesY[e.pagesY.length-1])}e._scrollbar("h"),e._scrollbar("v"),e.zoomed||(e.scroller.style[a]="0",e._resetPos(400))},scrollTo:function(e,t,n,r){var i=this,s=e,o,u;i.stop(),s.length||(s=[{x:e,y:t,time:n,relative:r}]);for(o=0,u=s.length;o<u;o++)s[o].relative&&(s[o].x=i.x-s[o].x,s[o].y=i.y-s[o].y),i.steps.push({x:s[o].x,y:s[o].y,time:s[o].time||0});i._startAni()},scrollToElement:function(e,t){var r=this,i;e=e.nodeType?e:r.scroller.querySelector(e);if(!e)return;i=r._offset(e),i.left+=r.wrapperOffsetLeft,i.top+=r.wrapperOffsetTop,i.left=i.left>0?0:i.left<r.maxScrollX?r.maxScrollX:i.left,i.top=i.top>r.minScrollY?r.minScrollY:i.top<r.maxScrollY?r.maxScrollY:i.top,t=t===undefined?n.max(n.abs(i.left)*2,n.abs(i.top)*2):t,r.scrollTo(i.left,i.top,t)},scrollToPage:function(e,t,n){var r=this,i,s;n=n===undefined?400:n,r.options.onScrollStart&&r.options.onScrollStart.call(r),r.options.snap?(e=e=="next"?r.currPageX+1:e=="prev"?r.currPageX-1:e,t=t=="next"?r.currPageY+1:t=="prev"?r.currPageY-1:t,e=e<0?0:e>r.pagesX.length-1?r.pagesX.length-1:e,t=t<0?0:t>r.pagesY.length-1?r.pagesY.length-1:t,r.currPageX=e,r.currPageY=t,i=r.pagesX[e],s=r.pagesY[t]):(i=-r.wrapperW*e,s=-r.wrapperH*t,i<r.maxScrollX&&(i=r.maxScrollX),s<r.maxScrollY&&(s=r.maxScrollY)),r.scrollTo(i,s,n)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(E,e),this._unbind(S,e),this._unbind(x,e)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(N):k(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(e,t,n,r){var i=this,s=n/i.scale;if(!i.options.useTransform)return;i.zoomed=!0,r=r===undefined?200:r,e=e-i.wrapperOffsetLeft-i.x,t=t-i.wrapperOffsetTop-i.y,i.x=e-e*s+i.x,i.y=t-t*s+i.y,i.scale=n,i.refresh(),i.x=i.x>0?0:i.x<i.maxScrollX?i.maxScrollX:i.x,i.y=i.y>i.minScrollY?i.minScrollY:i.y<i.maxScrollY?i.maxScrollY:i.y,i.scroller.style[a]=r+"ms",i.scroller.style[o]="translate("+i.x+"px,"+i.y+"px) scale("+n+")"+L,i.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},r=null,A}(window,document)}),define("src/point",[],function(){var e=function(e,t,n){this.set(e,t,n)};return e.prototype={clone:function(){return new e(this.x,this.y,this.isUp)},equals:function(t){return e.equals(this,t)},dist:function(t){return e.dist(this,t)},interp:function(t,n){return e.interp(this,t,n)},set:function(e,t,n){this.x=e,this.y=t,this.isUp=n||!1},set_from_point:function(e){this.set(e.x,e.y,e.isUp)}},e.equals=function(e,t){return e===t?!0:e.x===t.x&&e.y===t.y&&e.isUp===t.isUp},e.dist2=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},e.dist=function(t,n){return Math.sqrt(e.dist2(t,n))},e.interp=function(t,n,r,i){var s=t.x+r*(n.x-t.x),o=t.y+r*(n.y-t.y),u=i||new e;return u.set(s,o,n.isUp),u},e}),define("src/layer",["./drawcommand","./brush","./point"],function(e,t,n){var r=0,i=function(){this.domElement=document.createElement("div"),this.completedCanvas=document.createElement("canvas"),this.progressCanvas=document.createElement("canvas"),this.domElement.appendChild(this.completedCanvas),this.domElement.appendChild(this.progressCanvas),this.domElement.id="layer"+r++,[this.domElement,this.completedCanvas,this.progressCanvas].forEach(function(e){e.style.position="absolute",e.style.left=e.style.top=e.style.right=e.style.bottom="0px",e.style.width="100%",e.style.height="100%"}),this.progressContext=this.progressCanvas.getContext("2d"),this.completedContext=this.completedCanvas.getContext("2d"),this.brush_stamp=null,this.isDrawingPath=!1,this.lastPoint=new n,this.firstPoint=new n,this.spentDist=0,this._draw_from=new n,this._draw_to=new n,this._draw_tmp=new n};return i.prototype={_getBrushStamp:function(e){if(this.brush_stamp===null){var t=e.clone();t.size*=this.pixel_ratio,t.size=Math.max(0,Math.min(128,Math.round(t.size))),this.brush_stamp=t.toCanvas(),this.progressCanvas.style.opacity=e.opacity}return this.brush_stamp},_drawStamp:function(e,t){this.spentDist=0;var n=this._getBrushStamp(t),r=n.width/2,i=t.rotationIncrement(),s=t.followsTangent();if(s&&this.brushPoints===0&&this.tangent===null)this.firstPoint.set_from_point(e);else if(i===0&&!s)this.progressContext.drawImage(n,e.x-r,e.y-r);else{i*=this.brushPoints;if(s){var o=.8,u=Math.atan2(e.y-this.lastPoint.y,e.x-this.lastPoint.x);if(this.brushPoints===0)u=this.tangent;else if(this.brushPoints>1){var a=this.tangent;a>=u&&(a-=2*Math.PI),u-a>2*Math.PI+a-u&&(a+=2*Math.PI),u=o*u+(1-o)*a,u>Math.PI&&(u-=2*Math.PI),u<-Math.PI&&(u+=2*Math.PI)}this.tangent=u,i+=u,this.brushPoints===1&&(this.brushPoints--,this._drawStamp(this.firstPoint,t),this.brushPoints++)}this.progressContext.save(),this.progressContext.translate(e.x,e.y),this.progressContext.rotate(i),this.progressContext.drawImage(n,-r,-r),this.progressContext.restore()}this.lastPoint.set_from_point(e)},execDraw:function(e,t,r){var i=this._draw_from,s=this._draw_to,o=this._draw_tmp;i.set_from_point(this.lastPoint),s.set(e,t);var u=!1;if(!this.isDrawingPath)this.brushPoints=0,this.tangent=null,this.isDrawingPath=!0,this._drawStamp(s,r),u=!0;else{var a=n.dist(i,s),f,l=Math.max(1,r.size*r.spacing);for(f=l-this.spentDist;f<a;f+=l)this.brushPoints++,this._drawStamp(n.interp(i,s,f/a,o),r),u=!0;this.spentDist=a-(f-l),this.lastPoint.set_from_point(s),!u}return u},execDrawEnd:function(){return console.assert(this.isDrawingPath),this.completedContext.globalAlpha=this.progressCanvas.style.opacity,this.completedContext.drawImage(this.progressCanvas,0,0),this.progressContext.clearRect(0,0,this.width,this.height),this.isDrawingPath=!1,!1},execCommand:function(t,n){switch(t.type){case e.Type.DRAW_START:return console.assert(!this.isDrawingPath),!1;case e.Type.DRAW:return this.execDraw(t.pos.x*this.pixel_ratio,t.pos.y*this.pixel_ratio,n);case e.Type.DRAW_END:return this.execDrawEnd();case e.Type.COLOR_CHANGE:case e.Type.BRUSH_CHANGE:return console.assert(!this.isDrawingPath),this.brush_stamp=null,!1;default:console.assert(!1,t)}},cancelCurrentStroke:function(){this.progressContext.clearRect(0,0,this.width,this.height),this.isDrawingPath=!1},clear:function(){[this.progressContext,this.completedContext].forEach(function(e){e.clearRect(0,0,this.width,this.height)}.bind(this)),this.isDrawingPath=!1,this.brush_stamp=null},resize:function(e,t,n){var r=e*n,i=t*n;[this,this.completedCanvas,this.progressCanvas].forEach(function(e){e.width=r,e.height=i}),this.isDrawingPath=!1,this.brush_stamp=null,this.pixel_ratio=n},saveCheckpoint:function(){console.assert(!this.isDrawingPath);var e=document.createElement("canvas");return e.width=this.completedCanvas.width,e.height=this.completedCanvas.height,e.getContext("2d").drawImage(this.completedCanvas,0,0),new i.Checkpoint(e)},restoreCheckpoint:function(e){console.assert(typeof e!="string","need to decode checkpoint before restoring"),this.clear(),console.assert(!this.isDrawingPath),this.completedContext.globalAlpha=1,this.completedContext.drawImage(e.canvas,0,0)}},i.Checkpoint=function(e,t){this.canvas=e,this.isThumbnail=!!t},i.Checkpoint.prototype={},i.Checkpoint.prototype.toJSON=function(){var e=(this.canvas.toDataURLHD||this.canvas.toDataURL).bind(this.canvas),t=e(this.isThumbnail?"image/jpeg":"image/png"),n={canvas:t,w:this.canvas.width,h:this.canvas.height};return this.isThumbnail&&(n.isThumbnail=!0),n},i.Checkpoint.fromJSON=function(e,t){var n=typeof e=="string"?JSON.parse(e):e,r=document.createElement("img");r.onload=function(){var e=document.createElement("canvas");e.width="w"in n?n.w:r.width,e.height="h"in n?n.h:r.height,e.getContext("2d").drawImage(r,0,0,e.width,e.height),t(new i.Checkpoint(e,n.isThumbnail))},r.src=n.canvas},i}),define("src/slider",[],function(){function y(e){function J(e){if(r&&!e)return;try{s(W,"mouseover",it),s(W,"mouseout",st),s(W,"mousedown",lt),s(W,"touchstart",lt),s(V,"focus",Z),s(V,"blur",et),window.opera?s(V,"keypress",rt):(s(V,"keydown",rt),s(V,"keypress",nt)),s(V,"mousedown",ut),s(V,"touchstart",ut),s(V,"mouseup",ot),s(V,"touchend",ot),s(V,"touchcancel",ot),n&&!x&&(window.addEventListener&&!window.devicePixelRatio?window.removeEventListener("DOMMouseScroll",tt,!1):(s(document,"mousewheel",tt),s(window,"mousewheel",tt)))}catch(i){}clearTimeout(T),W.classList.add("slider-disabled"),W.setAttribute("aria-disabled",!0),t.disabled=r=!0,e||Y("disable")}function K(e){if(!r&&!e)return;i(W,"mouseover",it),i(W,"mouseout",st),i(W,"mousedown",lt),i(W,"touchstart",lt),window.opera?i(V,"keypress",rt):(i(V,"keydown",rt),i(V,"keypress",nt)),i(V,"focus",Z),i(V,"blur",et),i(V,"mousedown",ut),i(V,"touchstart",ut),i(V,"mouseup",ot),i(V,"touchend",ot),i(V,"touchcancel",ot),W.classList.remove("slider-disabled"),W.setAttribute("aria-disabled",!1),t.disabled=r=!1,e||Y("enable")}function Q(){try{J(),W.parentNode.removeChild(W)}catch(e){}X=$=V=W=T=null,Y("destroy"),E=null}function G(){pt();try{var e=W.offsetWidth,t=W.offsetHeight,n=V.offsetWidth,r=V.offsetHeight,i=$.offsetHeight,s=$.offsetWidth;H=w?t-r:e-n,q=H/d,I=H/Math.ceil(l/h),k=e,C=t,yt()}catch(o){}Y("redraw")}function Y(e){var n={elem:t,value:u=="select"?t.options[t.selectedIndex].value:t.value};if(e in E)for(var r=0,i;i=E[e][r];r++)i(n)}function Z(e){W.classList.add("focused"),n&&!x&&(i(window,"DOMMouseScroll",tt),i(document,"mousewheel",tt),window.opera||i(window,"mousewheel",tt)),Y("focus")}function et(e){W.classList.remove("focused"),W.classList.remove("fd-fc-slider-hover"),W.classList.remove("fd-slider-hover"),n&&!x&&(s(document,"mousewheel",tt),s(window,"DOMMouseScroll",tt),window.opera||s(window,"mousewheel",tt)),Y("blur")}function tt(e){if(!N)return;e=e||window.event;var t=0;e.wheelDelta?(t=e.wheelDelta/120,window.opera&&window.opera.version()<9.2&&(t=-t)):e.detail&&(t=-e.detail/3),w&&(t=-t);if(t){var n=w?V.offsetTop:V.offsetLeft;n=t<0?Math.ceil(n+I):Math.floor(n-I),gt(Math.min(Math.max(n,0),H))}return o(e)}function nt(e){return e=e||document.parentWindow.event,e.keyCode>=33&&e.keyCode<=40||!N||e.keyCode==45||e.keyCode==46?o(e):!0}function rt(e){if(!N)return!0;e=e||document.parentWindow.event;var n=e.keyCode!=null?e.keyCode:e.charCode;if(n<33||n>40&&n!=45&&n!=46)return!0;var r=u=="input"?parseFloat(t.value):t.selectedIndex;if(isNaN(r)||r<Math.min(a,f))r=Math.min(a,f);return n==37||n==40||n==46||n==34?r-=e.ctrlKey||n==34?h:c:n==39||n==38||n==45||n==33?r+=e.ctrlKey||n==33?h:c:n==35?r=f:n==36&&(r=a),yt(r),Y("update"),o(e)}function it(e){this.classList.add("fd-slider-hover")}function st(e){this.classList.remove("fd-slider-hover")}function ot(e){e=e||window.event,e.type==="mouseup"?(s(document,"mousemove",ft),s(document,"mouseup",ot)):(s(document,"touchmove",ft),s(document,"touchend",ot),s(document,"touchcancel",ot)),N=!0;if(window.opera)try{setTimeout(function(){onfocus()},0)}catch(t){}return document.body.classList.remove("slider-drag-vertical"),document.body.classList.remove("slider-drag-horizontal"),o(e)}function ut(e){e=e||window.event;if(e.touches){if(e.touches.length===0)return;e=g(e)}F=w?e.clientY:e.clientX,B=parseInt(w?V.offsetTop:V.offsetLeft)||0,N=!1,clearTimeout(T),T=null,e.type==="mousedown"?(i(document,"mousemove",ft),i(document,"mouseup",ot)):(i(document,"touchmove",ft),i(document,"touchend",ot),i(document,"touchcancel",ot));if(window.devicePixelRatio||document.all&&!window.opera)try{setTimeout(function(){V.focus()},0)}catch(t){}document.body.classList.add("slider-drag-"+(w?"vertical":"horizontal"))}function at(e){return e=e||window.event,e.type==="mouseup"?s(document,"mouseup",at):(s(document,"touchend",at),s(document,"touchcancel",at)),v||(clearTimeout(T),T=null,N=!0),o(e)}function ft(e){e=e||window.event;if(e.touches){if(e.touches.length===0)return;e=g(e)}gt(ht(B+(w?e.clientY-F:e.clientX-F)))}function lt(e){e=e||window.event;if(e.touches){e.type==="touchstart"&&e.preventDefault();if(e.touches.length===0)return;e=g(e)}var t;e.target?t=e.target:e.srcElement&&(t=e.srcElement),t.nodeType==3&&(t=t.parentNode);if(t.className.search("fd-slider-handle")!=-1)return!0;try{setTimeout(function(){V.focus()},0)}catch(n){}clearTimeout(T),pt(),T=null,N=!1;var r=0,s=0,o=0;document.documentElement&&document.documentElement.scrollTop?(o=document.documentElement.scrollTop,s=document.documentElement.scrollLeft):document.body&&(o=document.body.scrollTop,s=document.body.scrollLeft),e.pageX?r=w?e.pageY:e.pageX:e.clientX&&(r=w?e.clientY+o:e.clientX+s),r-=w?P+Math.round(V.offsetHeight/2):D+Math.round(V.offsetWidth/2),r=ht(r),v?mt(r):b?(gt(r),ut(e)):(e.type==="mousedown"?i(document,"mouseup",at):(i(document,"touchend",at),i(document,"touchcancel",at)),j=r,dt())}function ct(e){var n=u=="input"?parseFloat(t.value):t.selectedIndex;if(isNaN(n)||n<Math.min(a,f))n=Math.min(a,f);n+=c*e,yt(n)}function ht(e){var t=e%q;return t&&t>=q/2?e+=q-t:e-=t,Math.min(Math.max(parseInt(e,10),0),H)}function pt(){var e=0,t=0,n=W;if(n.getBoundingClientRect){var r=n.getBoundingClientRect();D=r.left+document.body.scrollLeft,P=r.top+document.body.scrollTop;return}try{while(n.offsetParent)e+=n.offsetLeft,t+=n.offsetTop,n=n.offsetParent}catch(i){}D=e,P=t}function dt(){var e=w?V.offsetTop:V.offsetLeft;e=Math.round(j<e?Math.max(j,Math.floor(e-I)):Math.min(j,Math.ceil(e+I))),gt(e),e!=j?T=setTimeout(dt,d>20?50:100):N=!0}function mt(e){N=!1,L=parseInt(e,10),A=parseInt(w?V.style.top:V.style.left,10),O=L-A,M=20,_=0,T||(T=setTimeout(vt,20))}function gt(e){V.style[w?"top":"left"]=e+"px";var t=a+Math.round(e/q)*c;bt(u=="select"||c==1?Math.round(t):t)}function yt(e){var n=isNaN(e)?u=="input"?parseFloat(t.value):t.selectedIndex:e;isNaN(n)||n<Math.min(a,f)?n=Math.min(a,f):n>Math.max(a,f)&&(n=Math.max(a,f)),bt(n),V.style[w?"top":"left"]=Math.round((n-a)/c*q)+"px"}function bt(e){e=isNaN(e)?a:e;if(u=="select")try{e=parseInt(e,10);if(t.selectedIndex==e)return;t.options[e].selected=!0}catch(n){}else{e=(a+Math.round((e-a)/c)*c).toFixed(p);if(t.value==e)return;t.value=e}Et(),Y("update")}function wt(){var e;if(t.parentNode&&t.parentNode.tagName.toLowerCase()=="label")e=t.parentNode;else{var n=document.getElementsByTagName("label");for(var r=0,i;i=n[r];r++)if(i.htmlFor&&i["htmlFor"]==t.id||i.getAttribute("for")==t.id){e=i;break}}return e&&!e.id&&(e.id=t.id+"_label"),e}function Et(){V.setAttribute("aria-valuenow",u=="select"?t.options[t.selectedIndex].value:t.value),V.setAttribute("aria-valuetext",u=="select"?t.options[t.selectedIndex].text:t.value)}function St(e){return yt(),Y("update"),!0}var t=e.inp,r=!1,u=t.tagName.toLowerCase(),a=+e.range[0],f=+e.range[1],l=Math.abs(f-a),c=u=="select"?1:+e.inc||1,h=e.maxInc?e.maxInc:c*2,p=e.inc.search(".")!=-1?e.inc.substr(e.inc.indexOf(".")+1,e.inc.length-1).length:0,d=Math.ceil(l/c),v=!!e.tween,m=!!e.fullARIA,y=!!e.hideInput,b=v?!1:!!e.clickJump,w=!!e.vertical,E=e.callbacks,S=e.classNames||"",x=!!e.noMouseWheel,T=null,N=!0,C=0,k=0,L=0,A=0,O=0,M=0,_=0,D=0,P=0,H=0,B=0,j=0,F=0,I=0,q=0,R=this,U={},z=null,W,X,V,$;f<a&&(c=-c,h=-h);var vt=function(){_++;var e=O,t=20,n=_,r=A,i=Math.ceil(n==t?r+e:e*(-Math.pow(2,-10*n/t)+1)+r);gt(n==t?L:i),Y("move"),n!=t?T=setTimeout(vt,20):(clearTimeout(T),T=null,N=!0)};return function(){y?t.classList.add("fd_hide_slider_input"):i(t,"change",St),W=document.createElement("div"),W.className="fd-slider"+(w?"-vertical ":" ")+S,W.id="fd-slider-"+t.id,X=document.createElement("span"),X.className="fd-slider-inner",$=document.createElement("span"),$.className="fd-slider-bar",m?(V=document.createElement("span"),V.setAttribute("tabIndex","0")):(V=document.createElement("button"),V.setAttribute("type","button")),V.className="fd-slider-handle",V.appendChild(document.createTextNode(String.fromCharCode(160))),W.appendChild(X),W.appendChild($),W.appendChild(V),t.parentNode.insertBefore(W,t),V.setAttribute("role","slider"),V.setAttribute("aria-valuemin",a),V.setAttribute("aria-valuemax",f);var e=wt();e&&(V.setAttribute("aria-labelledby",e.id),V.id="fd-slider-handle-"+t.id,e.setAttribute("for",V.id)),document.getElementById("fd_slider_describedby")&&V.setAttribute("aria-describedby","fd_slider_describedby"),t.getAttribute("disabled")==1?J(!0):K(!0),Et(),Y("create"),G()}(),{onResize:function(e){(W.offsetHeight!=C||W.offsetWidth!=k)&&G()},destroy:function(){Q()},reset:function(){yt()},increment:function(e){ct(e)},disable:function(){J()},enable:function(){K()}}}function b(){i(window,"load",c),i(window,"unload",d),i(window,"resize",v)}var e={},t=0,n=!0,r=function(){n=!1},i=function(e,t,n){e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!0)},s=function(e,t,n){if(e.detachEvent)try{e.detachEvent("on"+t,e[t+n]),e[t+n]=null}catch(r){}else e.removeEventListener(t,n,!0)},o=function(e){return e==null&&(e=document.parentWindow.event),e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),!1},u=function(){if(!arguments.length)return[];var e=[];for(var t=0;t<arguments.length;t++)for(var n=0,r;r=arguments[t][n];n++)e[e.length]=r;return e},a=function(e){if(e==null)return{};var t,n,r={},i,s;for(var o=0,u;u=e[o];o++){n=u.match(/(fd_slider_cb_(update|create|destroy|redraw|move|focus|blur|enable|disable)_)([^\s|$]+)/i)[1],u=u.replace(new RegExp("^"+n),"").replace(/-/g,"."),n=n.replace(/^fd_slider_cb_/i,"").replace(/_$/,"");try{if(u.indexOf(".")!=-1){i=u.split("."),s=window;for(var a=0,f;f=s[i[a]];a++)f instanceof Function?function(){var e=f;t=function(t){e.apply(s,[t])}}():s=f}else t=window[u];if(!(t instanceof Function))continue;n in r||(r[n]=[]),r[n][r[n].length]=t}catch(l){}}return r},f=function(e){if(e==null)return"";var t=[];for(var n=0,r;r=e[n];n++)t[t.length]=r.replace(/^fd_slider_cn_/,"");return t.join(" ")},l=function(t){return!t||!t.inp||!t.inp.id?!1:(h(t.inp.id),e[t.inp.id]=new y(t),!0)},c=function(e){var n=/fd_range_([-]{0,1}[0-9]+(d[0-9]+){0,1}){1}_([-]{0,1}[0-9]+(d[0-9]+){0,1}){1}/i,r=/fd_inc_([-]{0,1}[0-9]+(d[0-9]+){0,1}){1}/,i=/fd_maxinc_([-]{0,1}[0-9]+(d[0-9]+){0,1}){1}/,s=/((fd_slider_cb_(update|create|destroy|redraw|move|focus|blur|enable|disable)_)([^\s|$]+))/ig,o=/(fd_slider_cn_([a-zA-Z0-9_\-]+))/ig,c=e&&e.tagName&&e.tagName.search(/input|select/i)!=-1?[e]:u(document.getElementsByTagName("input"),document.getElementsByTagName("select")),h,p,d;for(var v=0,m;m=c[v];v++)if(m.tagName.toLowerCase()=="input"&&m.type=="text"&&(m.className.search(n)!=-1||m.className.search(/fd_slider/)!=-1)||m.tagName.toLowerCase()=="select"&&m.className.search(/fd_slider/)!=-1){if(!e&&m.id&&document.getElementById("fd-slider-"+m.id))continue;m.id||m.id=="sldr"+t++,d={inp:m,inc:m.className.search(r)!=-1?m.className.match(r)[0].replace("fd_inc_","").replace("d","."):"1",maxInc:m.className.search(i)!=-1?m.className.match(i)[0].replace("fd_maxinc_","").replace("d","."):!1,range:[0,100],callbacks:a(m.className.match(s)),classNames:f(m.className.match(o)),tween:m.className.search(/fd_tween/i)!=-1,vertical:m.className.search(/fd_vertical/i)!=-1,hideInput:m.className.search(/fd_hide_input/i)!=-1,clickJump:m.className.search(/fd_jump/i)!=-1,fullARIA:m.className.search(/fd_full_aria/i)!=-1,noMouseWheel:m.className.search(/fd_disable_mousewheel/i)!=-1},m.tagName.toLowerCase()=="select"?d.range=[0,m.options.length-1]:m.className.search(n)!=-1&&(h=m.className.match(n)[0].replace("fd_range_","").replace(/d/g,".").split("_"),d.range=[h[0],h[1]]),l(d)}return!0},h=function(t){return t in e?(e[t].destroy(),delete e[t],!0):!1},p=function(t){for(slider in e)e[slider].destroy()},d=function(t){p(),e=null,s(window,"unload",d),s(window,"resize",v),m()},v=function(t){for(slider in e)e[slider].onResize()},m=function(){s(window,"load",c)},g=function(e){return{type:e.type,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY,clientX:e.touches[0].clientX,clientY:e.touches[0].clientY,target:e.touches[0].target||e.target||e.srcElement}};return{create:function(e){c(e)},createSlider:function(e){l(e)},destroyAll:function(){p()},destroySlider:function(e){return h(e)},redrawAll:function(){v()},increment:function(t,n){if(!(t in e))return!1;e[t].increment(n)},addEvent:i,removeEvent:s,stopEvent:o,updateSlider:function(t){if(!(t in e))return!1;e[t].reset()},disableMouseWheel:function(){r()},addOnLoadEvent:b,removeOnLoadEvent:m,disableSlider:function(t){if(!(t in e))return!1;e[t].disable()},enableSlider:function(t){if(!(t in e))return!1;e[t].enable()}}}),define("src/brushdialog",["domReady!","text!./brushdialog.html","./brush","./color","./colorwheel","./coords","./compat","./drawcommand","./hslcolor","./iscroll","./layer","./slider"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=function(e){return function(t){t.preventDefault(),e(t)}},p=function(e){this.domElement=e,this.width=this.domElement.clientWidth,this.height=this.domElement.clientHeight,this.layer=new l,this.layer.resize(this.width,this.height,window.devicePixelRatio||1),this.domElement.appendChild(this.layer.domElement),this.lastBrush=new n(r.BLACK),this.setFromBrush(this.lastBrush)};p.prototype.setFromBrush=function(e){this.type=e.type,this.size=Math.round(e.size),this.spacing=Math.round(e.spacing*100),this.opacity=e.opacity*255},p.prototype.toBrush=function(e){return new n(e,this.type,this.size,this.opacity/255,this.spacing/100)},p.prototype.update=function(){var e=new n(r.WHITE,this.type,this.size,Math.max(20,this.opacity)/255,this.spacing/100);if(e.equals(this.lastBrush))return;this.lastBrush=e,this.layer.clear();var t=30,i=e.size/2,s=this.width-i,o=e.size/2,a=this.height-o,f,l,c={x:0,y:0};this.layer.execCommand(u.create_draw_start(),e);for(f=0;f<t;f++)l=f/(t-1)*.8+.1,c.x=i+f*(s-i)/(t-1),c.y=o+(.5+Math.sin(2*Math.PI*l)/2)*(a-o),this.layer.execCommand(u.create_draw(c),e);this.layer.execCommand(u.create_draw_end(),e)};var d=0,v=function(r,s){this.id=d++,this.brushpane=r,this._initializing=!0,this.brushpane.innerHTML=t,s&&(r.querySelector(".page_select").style.display="none");var u=this.preview=new p(r.querySelector(".stroke")),l=function(e){var t=r.querySelector("input."+e);return t.name=t.id=e+"_"+this.id,t}.bind(this);["hue","saturation","lightness","opacity"].forEach(function(e){["color_","old_color_"].forEach(function(t){l(t+e)}.bind(this))}.bind(this));var v=["color","brush"];v.forEach(function(e){var t=r.querySelector("."+e+"_select");t.addEventListener("click",h(this.switchPane.bind(this,e)),!1)}.bind(this)),this.switchPane(v[0]),r.querySelector(".closer").addEventListener("click",h(function(e){this.close(!0)}.bind(this)),!1),["size","spacing"].forEach(function(e){["minus","plus"].forEach(function(t){var n=r.querySelector("."+e+" ."+t);n.addEventListener("click",h(function(n){c.increment("brush_"+e+"_"+this.id,t==="minus"?-1:1)}.bind(this)))}.bind(this))}.bind(this));var m=function(){var e={},t={},n=!1,r=function(){n=!1,Object.getOwnPropertyNames(e).forEach(function(n){t[n]&&(e[n].apply(null,t[n]),t[n]=null)})};return function(i,s){return e[i]=s,function(){t[i]=Array.prototype.slice.call(arguments);if(n)return;o.requestAnimationFrame(r),n=!0}}}(),g=this._colorFromInputs.bind(this),y=m("updateColor",this._updateColor.bind(this)),b=this._updateOldColor.bind(this);this.wheel=new i(r.querySelector(".wheel"),r),this.wheel.hsCallback=function(e,t){var n=g();r.querySelector("input.color_hue").value=e,r.querySelector("input.color_saturation").value=t,y(new a(e,t,n.lightness,n.opacity))}.bind(this);var w=m("wheel_setHSL",function(e,t,n){this.wheel.setHSL(e,t,n)}.bind(this)),E=m("preview_update",function(){u.update()}),S=function(){var e=g();y(e),w(e.hue,e.saturation,e.lightness),u.opacity!==e.opacity&&(u.opacity=e.opacity,E())},x=function(){var e=g("old_color_");b(e)},T=function(e){r.querySelector("input.color_lightness").value=Math.round(e),c.updateSlider("color_lightness_"+this.id),S()}.bind(this),N=function(e){this._setInputs(e),S()}.bind(this);["white","black","old"].forEach(function(e){var t=r.querySelector(".swatches > ."+e);t.addEventListener("click",h(function(t){e==="white"?T(255):e==="black"?T(0):N(g("old_color_")),t.target.focus()}))});var C=function(){var e=r.querySelector("input.brush_spacing");u.spacing=parseInt(e.value,10)||5,r.querySelector(".spacing .caption").setAttribute("data-amount",u.spacing);if(this._initializing)return;E()}.bind(this);c.createSlider({inp:l("brush_spacing"),range:[5,200],inc:"1",clickJump:!0,hideInput:!0,callbacks:{update:[C]}});var k=function(){var e=r.querySelector("input.brush_size");u.size=parseInt(e.value,10)||1,r.querySelector(".size .caption").setAttribute("data-amount",u.size);if(this._initializing)return;E()}.bind(this);c.createSlider({inp:l("brush_size"),range:[1,129],inc:"1",clickJump:!0,hideInput:!0,callbacks:{update:[k]}});var L=function(){if(this._initializing)return;S()}.bind(this);["lightness","opacity"].forEach(function(e){var t=r.querySelector("input.color_"+e);c.createSlider({inp:t,range:[0,255],inc:"1",clickJump:!0,hideInput:!0,callbacks:{update:[L]}})});var A=function(){var e=this,t=u.toBrush();t.type=n.Types[e.currPageX];if(t.type===u.type)return;t.setToDefaultSpacing(),u.setFromBrush(t),E()},O=r.querySelector(".shape > .scrollwrapper"),M=O.querySelector(".allbrushes").offsetHeight,_=this.brushscroll=new f(O,{vScroll:!1,snap:M,onAnimationEnd:A}),D=r.querySelector(".shape");D.addEventListener("keypress",function(t){t=t||e.parentWindow.event;var n=t.keyCode!=null?t.keyCode:t.charCode;if(n===37||n===40||n===46||n===34)_.scrollToPage("prev");else{if(n!==39&&n!==38&&n!==45&&n!==33)return!0;_.scrollToPage("next")}return t.stopPropagation(),t.preventDefault(),!1},!0),u.setFromBrush=function(e){var t=this.id;return function(i){e.call(this,i),_.scrollToPage(n.Types[this.type]),[["size",this.size],["spacing",this.spacing]].forEach(function(e){var n=r.querySelector("input.brush_"+e[0]);n.value=e[1],c.updateSlider("brush_"+e[0]+"_"+t);var i=r.querySelector("."+e[0]+" .caption");i.setAttribute("data-amount",e[1])})}}.bind(this)(u.setFromBrush)};return v.prototype={},v.prototype._colorFromInputs=function(e){var t=e||"color_",n=["hue","saturation","lightness","opacity"];return n=n.map(function(e){var n=this.brushpane.querySelector("input."+t+e);return parseInt(n.value,10)||0}.bind(this)),new a(n[0],n[1],n[2],n[3])},v.prototype._setInputs=function(e,t){var n=t||"color_";["hue","saturation","lightness","opacity"].forEach(function(t){var r=this.brushpane.querySelector("input."+n+t);r.value=e[t],c.updateSlider(n+t+"_"+this.id)}.bind(this))},v.prototype._updateOldColor=function(e){var t=e.rgbaString();[".swatches > .old > span"].forEach(function(e){var n=this.brushpane.querySelector(e);n.style.color=t}.bind(this))},v.prototype._updateColor=function(e){var t=e.rgbString(),n=e.rgbaString();[".color_select > span",".opacity_options .fd-slider-bar"].forEach(function(e){var n=this.brushpane.querySelector(e);n.style.color=t}.bind(this)),[".swatches > .new > span"].forEach(function(e){var t=this.brushpane.querySelector(e);t.style.color=n}.bind(this));var r=(new a(e.hue,255,128,255)).rgbString();[".lightness .fd-slider-inner"].forEach(function(e){var t=this.brushpane.querySelector(e);t.style.color=r}.bind(this)),this.colorCallback&&this.colorCallback(e)},v.prototype.open=function(e,t,n){this.callback=n,this._resize=this.onResize.bind(this),window.addEventListener("resize",this._resize,!1),this.updateBrush(e);var r=this.brushpane.querySelector(".panes"),i=function(){this.brushpane.classList.add("visible"),["transitionend","oTransitionEnd","webkitTransitionEnd"].forEach(function(e){r.removeEventListener(e,i,!0)})}.bind(this);this.switchPane(t)?["transitionend","oTransitionEnd","webkitTransitionEnd"].forEach(function(e){r.addEventListener(e,i,!0)}):i()},v.prototype.updateBrush=function(e,t){this._initializing=!0,this.preview.setFromBrush(e),this.preview.update();var n=a.from_color(e.color);n.opacity=this.preview.opacity,this._setInputs(n),this._updateColor(n),t?this._updateOldColor(this._colorFromInputs("old_color_")):(this._setInputs(n,"old_color_"),this._updateOldColor(n)),this.wheel.setHSL(n.hue,n.saturation,n.lightness),this.onResize(),this._initializing=!1},v.prototype.currentPane=function(){return this.brushpane.classList.contains("color")?"color":"brush"},v.prototype.switchPane=function(e){e=e==="color"?e:"brush";if(this.brushpane.classList.contains(e))return!1;var t=this.brushpane.classList;return["color","brush"].forEach(function(n){n===e?t.add(n):t.remove(n)}),!0},v.prototype.onResize=function(){var e=this.brushpane.querySelector(".allbrushes").offsetHeight;this.brushscroll.options.snap=e,this.brushscroll.refresh(),this.brushscroll.scrollToPage(n.Types[this.preview.type],this.brushscroll.currPageY,0),this.wheel.onResize()},v.prototype.isOpen=function(){return this.brushpane.classList.contains("visible")},v.prototype.close=function(e){window.removeEventListener("resize",this._resize,!1),this.brushpane.classList.remove("visible"),e&&this._invokeCallback()},v.prototype.currentBrush=function(){var e=this._colorFromInputs(),t=e.rgbaColor().add(r.BLACK);return this.preview.toBrush(t)},v.prototype._invokeCallback=function(){this.callback&&this.callback.call(null,this.currentBrush())},v}),define("src/dom",[],function(){var e=function(e){var t=[[["charset","UTF-8"]],[["name","viewport"],["content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"]],[["name","apple-mobile-web-app-capable"],["content","yes"]],[["name","apple-mobile-web-app-status-bar-style"],["content","black"]]],n=e.getElementsByTagName("meta"),r,i,s;for(r=0;r<t.length;r++){var o=t[r],u=!1;for(i=0;i<n.length&&!u;i++){var a=n[i],f=!0;for(s=0;s<o.length&&f;s++){var l=o[s][0],c=o[s][1];a.getAttribute(l)!==c&&(f=!1)}f&&(u=!0)}if(u)continue;var h=e.createElement("meta");for(s=0;s<o.length;s++)h.setAttribute(o[s][0],o[s][1]);e.head.appendChild(h)}},t=function(e,t){e.document.title=t},n=function(e){var t=e.document,n=document.createElement("canvas");n.id="ncolors",n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.right="0px",n.style.bottom="0px",document.body.appendChild(n);var r=function(t){var r=e.innerWidth,i=e.innerHeight,s=e.devicePixelRatio||1;n.width=r*s,n.height=i*s,console.log("Resizing canvas",r,i,s),n.resizeHandler&&n.resizeHandler()};return e.addEventListener("resize",r,!1),r(),n},r=function(r){return e(r.document),t(r,"Nell's Colors"),n(r)},i=function(r){var i=r.open("","_blank");return e(i),t(i,"Nell's Colors"),n(i)};return{insertMeta:e,new_canvas:function(){return i(window)},set_title:function(e,t){e.ownerDocument.title=t},get_title:function(e){return e.ownerDocument.title}}}),define("src/alea",[],function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var r=0;r<t.length;r++){e+=t.charCodeAt(r);var i=.02519603282416938*e;e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=i*4294967296}return(e>>>0)*2.3283064365386963e-10};return t.version="Mash 0.9",t}function t(){return function(t){var n=0,r=0,i=0,s=1;t.length==0&&(t=[+(new Date)]);var o=e();n=o(" "),r=o(" "),i=o(" ");for(var u=0;u<t.length;u++)n-=o(t[u]),n<0&&(n+=1),r-=o(t[u]),r<0&&(r+=1),i-=o(t[u]),i<0&&(i+=1);o=null;var a=function(){var e=2091639*n+s*2.3283064365386963e-10;return n=r,r=i,i=e-(s=e|0)};return a.uint32=function(){return a()*4294967296},a.fract53=function(){return a()+(a()*2097152|0)*1.1102230246251565e-16},a.version="Alea 0.9",a.args=t,a}(Array.prototype.slice.call(arguments))}return{Random:t}}),define("src/lawnchair/core",[],function(){var e=function(t,n){if(!(this instanceof e))return new e(t,n);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(!(arguments.length<=2&&arguments.length>0))throw"Incorrect # of ctor args!";n=typeof arguments[0]=="function"?arguments[0]:arguments[1],t=typeof arguments[0]=="function"?{}:arguments[0];if(typeof n!="function")throw"No callback was provided";this.record=t.record||"record",this.name=t.name||"records";var r;if(t.adapter){for(var i=0,s=e.adapters.length;i<s;i++)if(e.adapters[i].adapter===t.adapter){r=e.adapters[i].valid()?e.adapters[i]:undefined;break}}else for(var i=0,s=e.adapters.length;i<s;i++){r=e.adapters[i].valid()?e.adapters[i]:undefined;if(r)break}if(!r)throw"No valid adapter.";for(var o in r)this[o]=r[o];for(var i=0,s=e.plugins.length;i<s;i++)e.plugins[i].call(this);this.init(t,n)};return e.adapters=[],e.adapter=function(t,n){n.adapter=t;var r="adapter valid init keys save batch get exists all remove nuke".split(" "),i=this.prototype.indexOf;for(var s in n)if(i(r,s)===-1)throw"Invalid adapter! Nonstandard method: "+s;e.adapters.splice(0,0,n)},e.plugins=[],e.plugin=function(t){for(var n in t)n==="init"?e.plugins.push(t[n]):this.prototype[n]=t[n]},e.prototype={isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},indexOf:function(e,t,n,r){if(e.indexOf)return e.indexOf(t);for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},lambda:function(e){return this.fn(this.record,e)},fn:function(e,t){return typeof t=="string"?new Function(e,t):t},uuid:function(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},each:function(e){var t=this.lambda(e);if(this.__results)for(var n=0,r=this.__results.length;n<r;n++)t.call(this,this.__results[n],n);else this.all(function(e){for(var n=0,r=e.length;n<r;n++)t.call(this,e[n],n)});return this}},e}),define("src/lawnchair/adapters/indexed-db.js",[],function(){return function(e){e.adapter("indexed-db",function(){function e(e,t){console.error("error in indexed-db adapter!",e,t)}var t="lawnchair",n=2,r=function(){return window.indexedDB||window.webkitIndexedDB||window.oIndexedDB||window.msIndexedDB},i=function(){return window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.oIDBTransaction||window.msIDBTransaction},s=function(){return window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.oIDBKeyRange||window.msIDBKeyRange},o=function(){return window.IDBDatabaseException||window.webkitIDBDatabaseException||window.mozIDBDatabaseException||window.oIDBDatabaseException||window.msIDBDatabaseException},u=i()&&"READ_WRITE"in i()?i().READ_WRITE:"readwrite";return{valid:function(){return!!r()},init:function(i,s){this.idb=r(),this.waiting=[];var u=this.idb.open(this.name,n),a=this,f=a.fn(a.name,s),l=function(){return u.onupgradeneeded=u.onsuccess=u.error=null,f.call(a,a)},c=function(e,n){try{a.db.deleteObjectStore("teststore")}catch(r){}try{a.db.deleteObjectStore(t)}catch(i){}a.db.createObjectStore(t),a.store=!0};u.onupgradeneeded=function(e){a.db=u.result,a.transaction=u.transaction,c(e.oldVersion,e.newVersion)},u.onsuccess=function(t){a.db=u.result;if(a.db.version!=""+n){var r=a.db.version,i=a.db.setVersion(""+n);i.onsuccess=function(e){var t=i.result;i.onsuccess=i.onerror=null,c(r,n),t.oncomplete=function(){for(var e=0;e<a.waiting.length;e++)a.waiting[e].call(a);a.waiting=[],l()}},i.onerror=function(t){i.onsuccess=i.onerror=null,console.log("Failed to create objectstore "+t),e(t)}}else{a.store=!0;for(var s=0;s<a.waiting.length;s++)a.waiting[s].call(a);a.waiting=[],l()}},u.onblocked=function(e){console.log("onblocked!")},u.onerror=function(e){if(u.errorCode===o().VERSION_ERR)return a.idb.deleteDatabase(a.name),a.init(i,s);console.error("Failed to open database")}},save:function(n,r){if(!this.store){this.waiting.push(function(){this.save(n,r)});return}var i=this,s,o=function(e){s.onsuccess=s.onerror=null,r&&(n.key=e.target.result,i.lambda(r).call(i,n))},a=this.db.transaction(t,u),f=a.objectStore(t);return s=n.key?f.put(n,n.key):f.put(n),s.onsuccess=o,s.onerror=e,this},batch:function(e,t){var n=[],r=!1,i=this,s=function(t){n.push(t),r=n.length===e.length},o=setInterval(function(){r&&(t&&i.lambda(t).call(i,n),clearInterval(o))},200);for(var u=0,a=e.length;u<a;u++)this.save(e[u],s);return this},get:function(n,r){if(!this.store){this.waiting.push(function(){this.get(n,r)});return}var i=this,s=function(e){r&&i.lambda(r).call(i,e.target.result)};if(!this.isArray(n)){var o=this.db.transaction(t).objectStore(t).get(n);o.onsuccess=function(e){o.onsuccess=o.onerror=null,s(e)},o.onerror=function(t){console.log("Failed to find "+n),o.onsuccess=o.onerror=null,e(t)}}else{var u=[],a=!1,f=n,l=function(e){u.push(e),a=u.length===f.length,a&&i.lambda(r).call(i,u)};for(var c=0,h=f.length;c<h;c++)this.get(f[c],l)}return this},exists:function(n,r){if(!this.store){this.waiting.push(function(){this.exists(n,r)});return}var i=this,o=this.db.transaction(t).objectStore(t).openCursor(s().only(n));return o.onsuccess=function(e){o.onsuccess=o.onerror=null;var t;i.lambda(r).call(i,e.target.result!==null&&e.target.result!==t)},o.onerror=function(t){o.onsuccess=o.onerror=null,console.log("Failed to test for "+n),e(t)},this},all:function(e){if(!this.store){this.waiting.push(function(){this.all(e)});return}var n=this.fn(this.name,e)||undefined,r=this,i=this.db.transaction(t).objectStore(t),s=[];return i.openCursor().onsuccess=function(e){var t=e.target.result;t?(s.push(t.value),t["continue"]()):n&&n.call(r,s)},this},remove:function(n,r){if(!this.store){this.waiting.push(function(){this.remove(n,r)});return}typeof n=="object"&&(n=n.key);var i=this,s,o=function(){s.onsuccess=s.onerror=null,r&&i.lambda(r).call(i)};return s=this.db.transaction(t,u).objectStore(t)["delete"](n),s.onsuccess=o,s.onerror=e,this},nuke:function(n,r){if(!this.store){this.waiting.push(function(){this.nuke(n,r)});return}var i=this,s=n?function(){i.lambda(n).call(i)}:function(){};if(r){this.waiting.length&&e(),this.idb.deleteDatabase(this.name),delete this.store,delete this.waiting,s();return}try{this.db.transaction(t,u).objectStore(t).clear().onsuccess=s}catch(o){e()}return this}}}())}}),define("src/lawnchair/adapters/dom.js",[],function(){return function(e){e.adapter("dom",function(){var e=window.localStorage,t=function(t){return{key:t+"._index_",all:function(){var t=e.getItem(this.key);return t&&(t=JSON.parse(t)),t===null&&e.setItem(this.key,JSON.stringify([])),JSON.parse(e.getItem(this.key))},add:function(t){var n=this.all();n.push(t),e.setItem(this.key,JSON.stringify(n))},del:function(t){var n=this.all(),r=[];for(var i=0,s=n.length;i<s;i++)n[i]!=t&&r.push(n[i]);e.setItem(this.key,JSON.stringify(r))},find:function(e){var t=this.all();for(var n=0,r=t.length;n<r;n++)if(e===t[n])return n;return!1}}};return{valid:function(){return!!e},init:function(e,n){this.indexer=t(this.name),n&&this.fn(this.name,n).call(this,this)},save:function(t,n){var r=t.key?this.name+"."+t.key:this.name+"."+this.uuid();return this.indexer.find(r)===!1&&this.indexer.add(r),delete t.key,e.setItem(r,JSON.stringify(t)),t.key=r.slice(this.name.length+1),n&&this.lambda(n).call(this,t),this},batch:function(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)this.save(e[r],function(e){n.push(e)});return t&&this.lambda(t).call(this,n),this},keys:function(e){if(e){var t=this.name,n=this.indexer.all().map(function(e){return e.replace(t+".","")});this.fn("keys",e).call(this,n)}return this},get:function(t,n){if(this.isArray(t)){var r=[];for(var i=0,s=t.length;i<s;i++){var o=this.name+"."+t[i],u=e.getItem(o);u&&(u=JSON.parse(u),u.key=t[i],r.push(u))}n&&this.lambda(n).call(this,r)}else{var o=this.name+"."+t,u=e.getItem(o);u&&(u=JSON.parse(u),u.key=t),n&&this.lambda(n).call(this,u)}return this},exists:function(e,t){var n=this.indexer.find(this.name+"."+e)===!1?!1:!0;return this.lambda(t).call(this,n),this},all:function(t){var n=this.indexer.all(),r=[],i,s;for(var o=0,u=n.length;o<u;o++)s=n[o],i=JSON.parse(e.getItem(s)),i.key=s.replace(this.name+".",""),r.push(i);return t&&this.fn(this.name,t).call(this,r),this},remove:function(t,n){var r=this.name+"."+(t.key?t.key:t);return this.indexer.del(r),e.removeItem(r),n&&this.lambda(n).call(this),this},nuke:function(e){return this.all(function(t){for(var n=0,r=t.length;n<r;n++)this.remove(t[n]);e&&this.lambda(e).call(this)}),this}}}())}}),define("src/lawnchair/adapters/window-name.js",[],function(){return function(e){e.adapter("window-name",function(e,t){typeof window=="undefined"&&(window={top:{}});var n=window.top.name?JSON.parse(window.top.name):{};return{valid:function(){return typeof window.top.name!="undefined"},init:function(r,i){n[this.name]=n[this.name]||{index:[],store:{}},e=n[this.name].index,t=n[this.name].store,this.fn(this.name,i).call(this,this)},keys:function(t){return this.fn("keys",t).call(this,e),this},save:function(r,i){var s=r.key||this.uuid();return this.exists(s,function(o){o||(r.key&&delete r.key,e.push(s)),t[s]=r,window.top.name=JSON.stringify(n),i&&(r.key=s,this.lambda(i).call(this,r))}),this},batch:function(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)this.save(e[r],function(e){n.push(e)});return t&&this.lambda(t).call(this,n),this},get:function(e,n){var r;if(this.isArray(e)){r=[];for(var i=0,s=e.length;i<s;i++)r.push(t[e[i]])}else r=t[e],r&&(r.key=e);return n&&this.lambda(n).call(this,r),this},exists:function(e,n){return this.lambda(n).call(this,!!t[e]),this},all:function(n){var r=[];for(var i=0,s=e.length;i<s;i++){var o=t[e[i]];o.key=e[i],r.push(o)}return this.fn(this.name,n).call(this,r),this},remove:function(r,i){var s=this.isArray(r)?r:[r];for(var o=0,u=s.length;o<u;o++)delete t[s[o]],e.splice(this.indexOf(e,s[o]),1);return window.top.name=JSON.stringify(n),i&&this.lambda(i).call(this),this},nuke:function(r){return t={},e=[],window.top.name=JSON.stringify(n),r&&this.lambda(r).call(this),this}}}())}}),define("src/lawnchair/lawnchair",["./core","./adapters/indexed-db.js","./adapters/dom.js","./adapters/window-name.js"],function(e){for(var t=arguments.length-1;t>0;t--)arguments[t](e);return e}),define("src/prandom",["./alea","./lawnchair/lawnchair"],function(e,t){var n=function(n){t({name:"uuid"},function(){var r=this,i=function(i){var s=e.Random(Date.now(),Math.random(),JSON.stringify(i));r.save({key:"pool",time:Date.now(),data:[s(),s(),s()]});var o=function(){if(window.btoa){var e=function(){return s.uint32()&255},t=String.fromCharCode(e(),e(),e(),e(),e(),e(),e(),e(),e());return window.btoa(t).replace("+","-").replace("/","_")}var n=function(){return((1+s())*65536|0).toString(16).substring(1)},r=function(){return arguments[Math.floor(s()*arguments.length)]+n().substring(1)};return n()+n()+"-"+n()+"-"+r("4")+"-"+r("8","9","a","b")+"-"+n()+n()+n()};t.prototype.uuid=s.uuid=o,n(s)};r.exists("pool",function(e){e?r.get("pool",i):i({})})})};return{load:function(e,t,r,i){i.isBuild?r(null):n(r)}}}),define("src/drawing",["./brush","./color","./drawcommand","./layer","./prandom!"],function(e,t,n,r,i){var s=!1,o=300,u=10*o,a=1e3,f=function(){this.domElement=document.createElement("div"),this.commands=[],this.commands.last=0,this.commands.end=0,this.layers=[],this.checkpoints=[],this.checkpointOften=!0,this.resize(100,100,1),this.layers.current=this.addLayer(),this.chunks=[],this.ctime=Date.now(),this.brush=new e(t.from_string("brown"),"rect",20,.88,.12),this.addCmd(n.create_color_change(this.brush.color)),this.addCmd(n.create_brush_change({brush_type:this.brush.type,size:this.brush.size,opacity:this.brush.opacity,spacing:this.brush.spacing})),this.commands.recog=this.commands.end};f.prototype={},f.prototype.attachToContainer=function(e){e.appendChild(this.domElement)},f.prototype.removeFromContainer=function(e){e.removeChild(this.domElement)},f.prototype.addLayer=function(){var e=new r;return e.resize(this.width,this.height,this.pixelRatio),this.layers.push(e),this.domElement.appendChild(e.domElement),this.layers.length-1},f.prototype.addCmd=function(e){this.commands[this.commands.end++]=e,this.commands.length=this.commands.end;while(this.checkpoints.length>0&&this.checkpoints[this.checkpoints.length-1].pos>=this.commands.length)this.checkpoints.pop();while(this.chunks.length>0&&this.chunks[this.chunks.length-1].end>=this.commands.length-1)this.chunks.pop()},f.START=0,f.END=-1,f.prototype.setCmdPos=function(e,t){var r=Date.now();e===f.END&&(e=this.commands.end),console.assert(e<=this.commands.end);var i=this._findNearestCheckpoint(e);i?(e<this.commands.last||e-i.pos<e-this.commands.last)&&this._restoreCheckpoint(i):e<this.commands.last&&(this._clear(),this.commands.last=0),console.assert(this.commands.last<=e);while(this.commands.last<e){this._execCommand(this.commands[this.commands.last++]);if(this.commands[this.commands.last-1].type===n.Type.DRAW_END){this.addCheckpoint();if(t&&Date.now()-r>t)break}}return this.commands.last<this.commands.end},f.prototype.setCmdTime=function(e,t){var r=this.commands.last;if(r===this.commands.end)return!1;var i=this.commands[r++];while(r<this.commands.end&&e>0){var s=this.commands[r++];i.type===n.Type.DRAW&&s.type===n.Type.DRAW&&(e-=s.time-i.time),i=s}return this.setCmdPos(r,t)},f.prototype.undo=function(e){if(this.commands.end===0)return!1;var t=this.commands.end-1;while(t>=0&&this.commands[t].type!==n.Type.DRAW_START)t--;if(t<0)return!1;this.setCmdPos(t,e),this.commands.end=t;var r=this.commands.last<this.commands.end;return r},f.prototype.redo=function(e){if(this.commands.end>=this.commands.length)return!1;var t=this.commands.end;while(t<this.commands.length&&this.commands[t].type!==n.Type.DRAW_END)t++;while(t<this.commands.length&&this.commands[t].type!==n.Type.DRAW_START)t++;this.commands.end=t;var r=this.setCmdPos(f.END,e);return r},f.prototype.resize=function(e,t,n){this.layers.forEach(function(r){r.resize(e,t,n)}),this.commands.last=0,this.width=e,this.height=t,this.pixelRatio=n,this.checkpoints=this.checkpoints.filter(function(r){return r.width>=e&&r.height>=t&&r.pixelRatio===n})},f.prototype._clear=function(){this.layers.forEach(function(e){e.clear()})},f.prototype._execCommand=function(e){switch(e.type){case n.Type.DRAW_START:return this.layers.current=e.layer,this.layers[this.layers.current].execCommand(e);case n.Type.DRAW:case n.Type.DRAW_END:return this.layers[this.layers.current].execCommand(e,this.brush);case n.Type.COLOR_CHANGE:return this.brush.color=e.color,this.layers.forEach(function(t){t.execCommand(e)}),!1;case n.Type.BRUSH_CHANGE:return["brush_type","size","opacity","spacing"].forEach(function(t){t in e&&(this.brush[t==="brush_type"?"type":t]=e[t])}.bind(this)),this.layers.forEach(function(t){t.execCommand(e)}),!1;default:console.assert(!1,"Unknown drawing command",e)}},f.prototype.makeThumbnail=function(e,t){var n=document.createElement("canvas");n.width=e,n.height=t;var r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,e,t);var i=Math.max.apply(Math,this.layers.map(function(e){return e.completedCanvas.width})),s=Math.max.apply(Math,this.layers.map(function(e){return e.completedCanvas.height})),o=Math.max(e/i,t/s);return r.translate(e/2,t/2),r.scale(o,o),r.translate(-i/2,-s/2),this.layers.forEach(function(e){r.drawImage(e.completedCanvas,0,0)}),n},f.prototype._saveCheckpoint=function(){return s&&console.log("creating checkpoint "+this.commands.last+"/"+this.commands.length),new f.Checkpoint({pos:this.commands.last,brush:this.brush.clone(),layers:this.layers.map(function(e){return e.saveCheckpoint()}),width:this.width,height:this.height,pixelRatio:this.pixelRatio})},f.prototype._restoreCheckpoint=function(e){this.commands.last=e.pos,this.brush=e.brush.clone(),e.layers.forEach(function(e,t){this.layers[t].restoreCheckpoint(e)}.bind(this))};var l=function(e,t,n){var r=0,i=e.length-1,s,o;while(r<=i){s=r+Math.floor((i-r)/2),o=n(e[s],t);if(o<0)r=s+1;else{if(!(o>0))return s;i=s-1}}return-(r+1)},c=function(e,t){return e.pos-t.pos};f.prototype._findNearestCheckpoint=function(e){var t=l(this.checkpoints,{pos:e},c);return t>=0?this.checkpoints[t]:(t=-(t+1),t===0?null:this.checkpoints[t-1])},f.prototype.addCheckpoint=function(e){var t={pos:this.commands.last},n=l(this.checkpoints,t,c);if(n>=0)return;n=-(n+1);var r=t.pos-(n===0?0:this.checkpoints[n-1].pos),i=this.checkpointOften?o:u;if(r<i&&!e)return;this.checkpoints.splice(n,0,this._saveCheckpoint()),this._thinCheckpoints()},f.prototype._thinCheckpoints=function(){var e=[],t,n=0;for(t=0;t<this.checkpoints.length-1;t++){if(this.checkpoints[t].pos>this.commands.last)break;var r=this.checkpoints[t+1].pos-n,i=this.commands.last-this.checkpoints[t+1].pos;r>i&&(e.push(this.checkpoints[t]),n=this.checkpoints[t].pos)}for(;t<this.checkpoints.length;t++)e.push(this.checkpoints[t]);this.checkpoints=e},f.Checkpoint=function(e){var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},f.Checkpoint.prototype={},f.Checkpoint.fromJSON=function(t,n){var i=typeof t=="string"?JSON.parse(t):t;i.brush=e.fromJSON(i.brush);if(i.layers.length===0)n(new f.Checkpoint(i));else{var s=0;i.layers.forEach(function(e,t){r.Checkpoint.fromJSON(e,function(e){i.layers[t]=e,s++,s===i.layers.length&&n(new f.Checkpoint(i))})})}},f.Chunk=function(e,t,n,r,s){this.drawing=e,this.uuid=i.uuid(),this.num=t,this.start=n,this.end=r,this.prev=s},f.Chunk.prototype={},f.Chunk.prototype.toJSON=function(){console.assert(this.end<=this.drawing.commands.length);var e={num:this.num,uuid:this.uuid,start:this.start,prev:this.prev};this.drawing.uuid&&(e.drawing=this.drawing.uuid);if(this.checkpoint){var t=this.drawing._findNearestCheckpoint(this.end);t&&(e.checkpoint=t)}return e.commands=this.drawing.commands.slice(this.start,this.end),e},f.prototype._makeChunks=function(){if(this.commands.length===0)return;while(this.chunks.length>0&&this.chunks[this.chunks.length-1].checkpoint&&this.chunks[this.chunks.length-1].end+a<this.commands.length)this.chunks.pop();while(this.chunks.length>0&&!this.chunks[this.chunks.length-1].checkpoint&&this.chunks[this.chunks.length-1].end+a>=this.commands.length)this.chunks.pop();for(;;){var e=this.chunks.length===0?0:this.chunks[this.chunks.length-1].end;if(e>=this.commands.length)break;var t=Math.min(e+a,this.commands.length),n=this.chunks.length===0?null:this.chunks[this.chunks.length-1],r=new f.Chunk(this,n?n.num+1:0,e,t,n?n.uuid:null);r.end<this.commands.length&&r.end+a>=this.commands.length&&(r.checkpoint=!0),this.chunks.push(r)}},f.prototype.toJSON=function(e){var t=[];this.checkpoints.length>0&&!e&&t.push(this.checkpoints[0]),this.checkpoints.length>1&&!e&&t.push(this.checkpoints[this.checkpoints.length-1]);var n={end:this.commands.end,nLayers:this.layers.length,width:this.width,height:this.height,pixelRatio:this.pixelRatio,ctime:this.ctime,checkpoints:t};return this.uuid&&(n.uuid=this.uuid),e&&this._makeChunks(),e&&this.chunks.length>0?(n.firstChunk=this.chunks[0].uuid,n.lastChunk=this.chunks[this.chunks.length-1].uuid,n.nChunks=this.chunks.length):n.commands=this.commands,n};var h=function(e,t,r){var i=typeof e=="string"?JSON.parse(e):e,s=new f;while(s.layers.length<(i.nLayers||i.nlayers))s.addLayer();s.commands.length=s.commands.end=s.commands.last=0;var o=[];t?s.chunks=t.map(function(e){var t=typeof e=="string"?JSON.parse(e):e;t.commands.forEach(function(e){s.addCmd(n.fromJSON(e))});var r=new f.Chunk(s,t.num,t.start,t.start+t.commands.length,t.prev);return r.uuid=t.uuid,t.checkpoint&&(o.push(t.checkpoint),r.checkpoint=!0),r}):(i.commands.forEach(function(e){s.addCmd(n.fromJSON(e))}),o=i.checkpoints),s.commands.end=s.commands.recog=i.end,s.resize(i.width,i.height,i.pixelRatio||1),i.active_layer&&(s.layers.current=i.active_layer||0),i.initial_playback_speed&&(s.initial_playback_speed=i.initial_playback_speed||2),i.uuid&&(s.uuid=i.uuid),i.ctime&&(s.ctime=i.ctime);if(o.length===0)r(s);else{var u=0;o.forEach(function(e,t){f.Checkpoint.fromJSON(e,function(e){s.checkpoints[t]=e,u++,u===o.length&&r(s)})})}};return f.fromJSON=function(e,t){return h(e,null,t)},f.fromChunks=function(e,t,n){return h(e,t,n)},f.Layer=r,f}),define("json",["text"],function(text){function cacheBust(e){return e=e.replace(CACHE_BUST_FLAG,""),e+=e.indexOf("?")<0?"?":"&",e+CACHE_BUST_QUERY_PARAM+"="+Math.round(2147483647*Math.random())}var CACHE_BUST_QUERY_PARAM="bust",CACHE_BUST_FLAG="!bust",jsonParse=typeof JSON!="undefined"&&typeof JSON.parse=="function"?JSON.parse:function(val){return eval("("+val+")")},buildMap={};return{load:function(e,t,n,r){!r.isBuild||r.inlineJSON!==!1&&e.indexOf(CACHE_BUST_QUERY_PARAM+"=")===-1?text.get(t.toUrl(e),function(t){r.isBuild?(buildMap[e]=t,n(t)):n(jsonParse(t))}):n(null)},normalize:function(e,t){return e.indexOf(CACHE_BUST_FLAG)===-1?e:cacheBust(e)},write:function(e,t,n){if(t in buildMap){var r=buildMap[t];n('define("'+e+"!"+t+'", function(){ return '+r+";});\n")}}}}),define("json!src/fontmetrics.json",function(){return{0:{cx:.5,cy:0,w:47,h:68,fw:59,fh:80},1:{cx:-3,cy:-0.5,w:22,h:67,fw:34,fh:79},2:{cx:1,cy:-1.5,w:40,h:67,fw:52,fh:79},3:{cx:.5,cy:.5,w:39,h:67,fw:51,fh:79},4:{cx:-0.5,cy:-0.5,w:45,h:67,fw:57,fh:79},5:{cx:1,cy:1,w:40,h:66,fw:52,fh:78},6:{cx:1,cy:.5,w:40,h:67,fw:52,fh:79},7:{cx:.5,cy:0,w:37,h:66,fw:49,fh:78},8:{cx:0,cy:0,w:40,h:68,fw:52,fh:80},9:{cx:0,cy:-0.5,w:40,h:67,fw:52,fh:79},font:"100px Delius",textAlign:"center",textBaseline:"middle",outerOutline:6,innerOutline:3,A:{cx:.5,cy:-3.5,w:51,h:71,fw:63,fh:83},B:{cx:0,cy:-2.5,w:50,h:73,fw:62,fh:85},C:{cx:1.5,cy:-2.5,w:51,h:73,fw:63,fh:85},D:{cx:0,cy:-2.5,w:54,h:73,fw:66,fh:85},E:{cx:0,cy:-3,w:44,h:70,fw:56,fh:82},F:{cx:1,cy:-2.5,w:44,h:71,fw:56,fh:83},G:{cx:1,cy:-2.5,w:56,h:73,fw:68,fh:85},H:{cx:.5,cy:-3,w:57,h:72,fw:69,fh:84},I:{cx:0,cy:-3,w:30,h:70,fw:42,fh:82},J:{cx:-0.5,cy:-2.5,w:39,h:71,fw:51,fh:83},K:{cx:4.5,cy:-3,w:45,h:72,fw:57,fh:84},L:{cx:3.5,cy:-3.5,w:35,h:71,fw:47,fh:83},M:{cx:.5,cy:-2.5,w:55,h:71,fw:67,fh:83},N:{cx:.5,cy:-3,w:43,h:72,fw:55,fh:84},O:{cx:0,cy:-2.5,w:60,h:73,fw:72,fh:85},P:{cx:1.5,cy:-3.5,w:45,h:73,fw:57,fh:85},Q:{cx:0,cy:4.5,w:58,h:87,fw:70,fh:99},R:{cx:2,cy:-3,w:50,h:72,fw:62,fh:84},S:{cx:.5,cy:-2.5,w:41,h:73,fw:53,fh:85},T:{cx:.5,cy:-2.5,w:41,h:71,fw:53,fh:83},U:{cx:0,cy:-2.5,w:44,h:73,fw:56,fh:85},V:{cx:0,cy:-3,w:52,h:72,fw:64,fh:84},W:{cx:.5,cy:-3,w:79,h:72,fw:91,fh:84},X:{cx:1,cy:-2.5,w:52,h:73,fw:64,fh:85},Y:{cx:1,cy:-3,w:46,h:72,fw:58,fh:84},Z:{cx:0,cy:-3,w:44,h:70,fw:56,fh:82},a:{cx:1.5,cy:9.5,w:43,h:47,fw:55,fh:59},b:{cx:1,cy:-3,w:38,h:72,fw:50,fh:84},c:{cx:1.5,cy:10,w:37,h:48,fw:49,fh:60},d:{cx:1.5,cy:-3,w:45,h:72,fw:57,fh:84},e:{cx:-1,cy:10,w:42,h:48,fw:54,fh:60},f:{cx:2,cy:-3,w:26,h:72,fw:38,fh:84},g:{cx:-1,cy:20.5,w:38,h:69,fw:50,fh:81},h:{cx:2,cy:-3,w:42,h:72,fw:54,fh:84},i:{cx:.5,cy:-1,w:3,h:68,fw:15,fh:80},j:{cx:-3.5,cy:8.5,w:11,h:87,fw:23,fh:99},k:{cx:2.5,cy:-3,w:35,h:72,fw:47,fh:84},l:{cx:1,cy:-3,w:2,h:72,fw:14,fh:84},m:{cx:2,cy:9.5,w:72,h:47,fw:84,fh:59},n:{cx:2,cy:9.5,w:42,h:47,fw:54,fh:59},o:{cx:.5,cy:10,w:41,h:48,fw:53,fh:60},p:{cx:.5,cy:20.5,w:41,h:69,fw:53,fh:81},q:{cx:-1,cy:20.5,w:38,h:69,fw:50,fh:81},r:{cx:3.5,cy:9.5,w:27,h:47,fw:39,fh:59},s:{cx:0,cy:9.5,w:32,h:47,fw:44,fh:59},t:{cx:.5,cy:2,w:23,h:62,fw:35,fh:74},u:{cx:1.5,cy:10,w:43,h:46,fw:55,fh:58},v:{cx:0,cy:9.5,w:38,h:47,fw:50,fh:59},w:{cx:0,cy:10,w:68,h:46,fw:80,fh:58},x:{cx:.5,cy:10,w:39,h:48,fw:51,fh:60},y:{cx:0,cy:20.5,w:38,h:69,fw:50,fh:81},z:{cx:.5,cy:9.5,w:35,h:45,fw:47,fh:57}}}),define("src/funf",[],function(){var e=!1,t="edu.mit.media.funf.RECORD",n="edu.mit.media.funf.ARCHIVE",r="mainPipeline",i=function(e){console.assert(e.indexOf("-")<0,"funf doesn't like hyphens in the appName"),this.appName=e};return i.prototype={},i.prototype.record=function(n,i){typeof i=="object"&&(i=JSON.stringify(i)),e&&console.log("FUNF "+n+" / "+i);try{var s=document.createEvent("CustomEvent"),o={name:n,value:i,millis:Date.now()},u={action:t,method:"sendBroadcast",extras:{DATABASE_NAME:r,TIMESTAMP:Math.floor(Date.now()/1e3),NAME:this.appName,VALUE:JSON.stringify(o)}};s.initCustomEvent("intent-addon",!0,!0,u),document.documentElement.dispatchEvent(s)}catch(a){console.log("Sending custom event failed: "+a)}},i.prototype.archive=function(){try{var e=document.createEvent("CustomEvent"),t={action:n,method:"sendBroadcast",extras:{DATABASE_NAME:r}};e.initCustomEvent("intent-addon",!0,!0,t),document.documentElement.dispatchEvent(e)}catch(i){console.log("Sending custom event failed: "+i)}},i}),define("src/lzw",[],function(){function r(e){return unescape(encodeURIComponent(e))}function i(e){return decodeURIComponent(escape(e))}function s(i,s){var o={},u=i+"",a=[],f,l=u.charAt(0),c=e+1,h;for(h=1;h<u.length;h++)f=u.charAt(h),o.hasOwnProperty(l+f)?l+=f:(a.push(l.length>1?o[l]:l),c<t&&(o[l+f]=String.fromCharCode(c),c++,c===55296&&(c=57344)),c===t&&n&&(a.push(String.fromCharCode(e)),o={},c=e+1),l=f);a.push(l.length>1?o[l]:l);var p=a.join("");return s&&(p=r(p)),p}function o(n,r){var s=n+"";r&&(s=i(s));var o={},u=s.charAt(0),a=u,f=[u],l=e+1,c,h;for(h=1;h<s.length;h++){var p=s.charCodeAt(h);if(p<e)c=s.charAt(h);else{if(p===e){o={},l=e+1,u=a=s.charAt(++h),f.push(u);continue}c=o[p]?o[p]:a+u}f.push(c),u=c.charAt(0),l<t&&(o[l]=a+u,l++,l===55296&&(l=57344)),a=c}return f.join("")}var e=128,t=65536,n=!0;return{encode:s,decode:o}}),define("src/sync",["./drawing","./lzw","./lawnchair/lawnchair"],function(e,t,n){var r=!1,i="top",s=160,o=120,u={},a=function(e,t,n,r){e.exists(t,function(i){i?e.get(t,r):r(n)})},f=function(t,r){n({name:"drawing_index"},function(){var n=this,i=t.makeThumbnail(s,o);n.save({key:t.uuid,thumb:JSON.stringify(new e.Layer.Checkpoint(i,!0)),ctime:t.ctime,mtime:Date.now()},function(){r.call(t)})})},l=function(e,t){n({name:"drawing_index"},function(){var n=this;n.remove(e,t)})};return u.list=function(t){n({name:"drawing_index"},function(){var n=this;n.all(function(n){n.sort(function(e,t){return e.ctime-t.ctime}),t(n.map(function(e){return e.key}),n.map(function(t){return t.thumb?function(n){var r=function(e){n(e.canvas)};e.Layer.Checkpoint.fromJSON(t.thumb,r)}:null}))})})},u["delete"]=function(e,t){l(e,function(){n({name:"drawing."+e},function(){this.nuke(t,!0)})})},u.load=function(r,s){var o=function(n){n.get(i,function(r){var i,o=0,u=[],a=function(i){n.get(""+i,function(n){u[i]=JSON.parse(t.decode(n.data)),o++,o===r.data.nChunks&&e.fromChunks(r.data,u,s)})};for(i=0;i<r.data.nChunks;i++)a(i)})};n({name:"drawing."+r},function(){o(this)})},u.exists=function(e,t){var r=function(e){e.exists(i,t)};n({name:"drawing."+e},function(){r(this)})},u.save=function(e,s,o){console.assert(e.uuid);var u=function(n){var o=e.toJSON("use chunks"),u=function(){r&&console.log("writing",e.uuid),n.save({key:i,data:o},function(){f(e,s)})},l=o.nChunks,c=function(){l--,l<0?u():a(n,""+l,null,function(i){i&&i.uuid===e.chunks[l].uuid?u():(r&&console.log("writing",l),n.save({key:""+l,uuid:e.chunks[l].uuid,data:t.encode(JSON.stringify(e.chunks[l]))},c))})};c()};n({name:"drawing."+e.uuid},function(){var e=function(){u(this)}.bind(this);o?this.nuke(e):e()})},u}),define("src/gallery",["domReady!","./compat","./sync"],function(e,t,n){var r=!0,i=function(t){this.domElement=e.createElement("div"),this.domElement.classList.add("gallery"),this.funf=t,this.first=r,r=!1,n.list(this._populate.bind(this))};return i.prototype={},i.prototype._populate=function(t,n){this.funf.record("gallery",{drawings:t.length});var r=function(t,r){var i=e.createElement("a");i.href="#",i.className=t,i.textContent=t,i.addEventListener("click",function(e){e.preventDefault(),this._callback(t)}.bind(this)),this.domElement.appendChild(i),n[r]&&n[r](function(e){i.appendChild(e);if(this.first){var n=e.toDataURL?e.toDataURL("image/jpeg"):null;this.funf.record("thumb",{uuid:t,data:n})}}.bind(this))}.bind(this);t.forEach(r),r("new",-1)},i.prototype.wait=function(e){this._callback=e},i.abort=function(){var t=e.querySelectorAll("div.gallery"),n;for(n=0;n<t.length;n++)t[n].parentElement.removeChild(t[n])},i}),define("lib/hammer",[],function(){return function(t,n,r){function x(e){return e.touches?e.touches.length:1}function T(e){e=e||window.event;if(!e.touches){var t=document,n=t.body;return[{x:e.pageX||e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&t.clientLeft||0),y:e.pageY||e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&t.clientTop||0)}]}var r=[],i;for(var s=0,o=e.touches.length;s<o;s++)i=e.touches[s],r.push({x:i.pageX,y:i.pageY});return r}function N(e,t){return Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI}function C(e,t){t.touches=T(t.originalEvent),t.type=e,D(i["on"+e])&&i["on"+e].call(i,t)}function k(e){e=e||window.event,e.preventDefault?e.preventDefault():(e.returnValue=!1,e.cancelBubble=!0)}function L(){f={},c=!1,l=0,o=0,u=0,h=null}function O(e){switch(e.type){case"mousedown":case"touchstart":f.start=T(e),d=(new Date).getTime(),l=x(e),c=!0,w=e;var r=t.getBoundingClientRect(),i=t.clientTop||document.body.clientTop||0,s=t.clientLeft||document.body.clientLeft||0,v=window.pageYOffset||t.scrollTop||document.body.scrollTop,m=window.pageXOffset||t.scrollLeft||document.body.scrollLeft;y={top:r.top+v-i,left:r.left+m-s},b=!0,A.hold(e),n.prevent_default&&k(e);break;case"mousemove":case"touchmove":if(!b)return!1;E=e,f.move=T(e),A.transform(e)||A.drag(e);break;case"mouseup":case"mouseout":case"touchcancel":case"touchend":if(!b||h!="transform"&&e.touches&&e.touches.length>0)return!1;b=!1,S=e,h=="drag"?C("dragend",{originalEvent:e,direction:a,distance:o,angle:u}):h=="transform"?C("transformend",{originalEvent:e,position:f.center,scale:e.scale,rotation:e.rotation}):A.tap(w),p=h,L()}}function M(e,t){!t&&window.event&&window.event.toElement&&(t=window.event.toElement);if(e===t)return!0;if(t){var n=t.parentNode;while(n!==null){if(n===e)return!0;n=n.parentNode}}return!1}function _(e,t){var n={};if(!t)return e;for(var r in e)r in t?n[r]=t[r]:n[r]=e[r];return n}function D(e){return Object.prototype.toString.call(e)=="[object Function]"}var i=this,s={prevent_default:!1,css_hacks:!0,drag:!0,drag_vertical:!0,drag_horizontal:!0,drag_min_distance:20,transform:!0,scale_treshold:.1,rotation_treshold:15,tap:!0,tap_double:!0,tap_max_interval:300,tap_double_distance:20,hold:!0,hold_timeout:500};n=_(s,n),function(){if(!n.css_hacks)return!1;var e=["webkit","moz","ms","o",""],r={userSelect:"none",touchCallout:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"},i="";for(var s=0;s<e.length;s++)for(var o in r)i=o,e[s]&&(i=e[s]+i.substring(0,1).toUpperCase()+i.substring(1)),t.style[i]=r[o]}();var o=0,u=0,a=0,f={},l=0,c=!1,h=null,p=null,d=null,v={x:0,y:0},m=null,g=null,y={},b=!1,w,E,S;this.getDirectionFromAngle=function(e){var t={down:e>=45&&e<135,left:e>=135||e<=-135,up:e<-45&&e>-135,right:e>=-45&&e<=45},n,r;for(r in t)if(t[r]){n=r;break}return n};var A={hold:function(e){n.hold&&(h="hold",clearTimeout(g),g=setTimeout(function(){h=="hold"&&C("hold",{originalEvent:e,position:f.start})},n.hold_timeout))},drag:function(e){var t=f.move[0].x-f.start[0].x,r=f.move[0].y-f.start[0].y;o=Math.sqrt(t*t+r*r);if(n.drag&&o>n.drag_min_distance||h=="drag"){u=N(f.start[0],f.move[0]),a=i.getDirectionFromAngle(u);var s=a=="up"||a=="down";if((s&&!n.drag_vertical||!s&&!n.drag_horizontal)&&o>n.drag_min_distance)return;h="drag";var l={x:f.move[0].x-y.left,y:f.move[0].y-y.top},p={originalEvent:e,position:l,direction:a,distance:o,distanceX:t,distanceY:r,angle:u};c&&(C("dragstart",p),c=!1),C("drag",p),k(e)}},transform:function(e){if(n.transform){var t=e.scale||1,r=e.rotation||0;if(x(e)!=2)return!1;if(h!="drag"&&(h=="transform"||Math.abs(1-t)>n.scale_treshold||Math.abs(r)>n.rotation_treshold)){h="transform",f.center={x:(f.move[0].x+f.move[1].x)/2-y.left,y:(f.move[0].y+f.move[1].y)/2-y.top};var i={originalEvent:e,position:f.center,scale:t,rotation:r};return c&&(C("transformstart",i),c=!1),C("transform",i),k(e),!0}}return!1},tap:function(e){var t=(new Date).getTime(),r=t-d;if(n.hold&&!(n.hold&&n.hold_timeout>r))return;var i=function(){if(v&&n.tap_double&&p=="tap"&&d-m<n.tap_max_interval){var e=Math.abs(v[0].x-f.start[0].x),t=Math.abs(v[0].y-f.start[0].y);return v&&f.start&&Math.max(e,t)<n.tap_double_distance}return!1}();i?(h="double_tap",m=null,C("doubletap",{originalEvent:e,position:f.start}),k(e)):(h="tap",m=t,v=f.start,n.tap&&(C("tap",{originalEvent:e,position:f.start}),k(e)))}};"ontouchstart"in window?(t.addEventListener("touchstart",O,!1),t.addEventListener("touchmove",O,!1),t.addEventListener("touchend",O,!1),t.addEventListener("touchcancel",O,!1)):t.addEventListener?(t.addEventListener("mouseout",function(e){M(t,e.relatedTarget)||O(e)},!1),t.addEventListener("mouseup",O,!1),t.addEventListener("mousedown",O,!1),t.addEventListener("mousemove",O,!1)):document.attachEvent&&(t.attachEvent("onmouseout",function(e){M(t,e.relatedTarget)||O(e)},!1),t.attachEvent("onmouseup",O),t.attachEvent("onmousedown",O),t.attachEvent("onmousemove",O))}}),define("src/postmessage",[],function(){return function(t,n,r,i){try{t.postMessage(n,r,i)}catch(s){typeof n!="string"&&(n=JSON.stringify(n)),t.postMessage(n,i,r)}}}),define("src/hand/features",["../point","../compat"],function(e,t){var n=t.Float64Array,r=3,i=.25,s=1/7,o=2,u=2,a=function(e,t){this.tl=e,this.br=t};a.prototype={unionPt:function(e){e.x<this.tl.x&&(this.tl.x=e.x),e.y<this.tl.y&&(this.tl.y=e.y),e.x>this.br.x&&(this.br.x=e.x),e.y>this.br.y&&(this.br.y=e.y)},union:function(e){this.unionPt(e.tl),this.unionPt(e.br)},size:function(){return{width:this.br.x-this.tl.x,height:this.br.y-this.tl.y}}},a.fromPts=function(e){var t=new a(e[0].clone(),e[0].clone());return e.forEach(function(e){t.unionPt(e)}),t};var f=function(t){var n=t.ppmm,r=function(t){return new e(t[0],t[1])};t.strokes=t.strokes.map(function(e){e=e.map(r);var t=[e[0]],n;for(n=1;n<e.length;n++){if(e[n].equals(e[n-1]))continue;t.push(e[n])}return t}),t.strokes=t.strokes.filter(function(e){return e.length>1});if(t.strokes.length===0)return;var i=t.strokes.map(function(e){return a.fromPts(e)}),s=i[0];i.forEach(function(e){s.union(e)});var o=s.size();o=Math.max(o.width/n.x,o.height/n.y);var u=function(t){var r=(t.x-s.tl.x)/(n.x*o),i=(t.y-s.tl.y)/(n.y*o);return new e(r,i)};t.strokes=t.strokes.map(function(e){return e.map(u)})},l=function(t){t.strokes=t.strokes.map(function(t){var n=[],s,o;for(s=0;s<t.length;s++){var u=new e(t[s].x*i,t[s].y*i),a=r;while(a>0&&(s<a||s>=t.length-a))a--;for(o=1;o<=a;o++)u.x+=t[s-o].x+t[s+o].x,u.y+=t[s-o].y+t[s+o].y;u.x/=2*a+i,u.y/=2*a+i,n.push(u)}return n})},c=function(t){var n=[];t.strokes.forEach(function(t){var r=t[0],i;n.push(new e(r.x,r.y,!0));for(i=1;i<t.length;i++)n.push(t[i])}),t.strokes=[n]},h=function(t,n){console.assert(t.strokes.length===1),n||(n=s);var r=t.strokes[0];if(r.length===0)return;var i=[],o=r[0],u=0,a=!0,f=!0;r.forEach(function(t){var r=e.dist(o,t);while(u<=r){var s=f?0:u/r,l=e.interp(o,t,s),c=t.isUp;a&&(l.isUp=!0),a=f?!1:c,i.push(l),u+=n,f=!1}u-=r,o=t}),i[i.length-1].isUp&&(console.assert(!o.isUp,arguments[2]),i.push(o)),t.strokes=[i]},p=function(e){var t,n=e.strokes[0],r=n.map(function(){return[]});for(t=0;t<n.length;t++){var i=n[t<2?0:t-2],s=n[t<1?0:t-1],o=n[t],u=n[t+1<n.length?t+1:n.length-1],f=n[t+2<n.length?t+2:n.length-1],l=u.x-s.x,c=u.y-s.y,h=Math.sqrt(l*l+c*c),p=f.x-i.x,d=f.y-i.y,v=Math.sqrt(p*p+d*d),m=a.fromPts([i,s,o,u,f]).size(),g=i.dist(s)+s.dist(o)+o.dist(u)+u.dist(f),y=function(e){return Math.abs(p*(i.y-e.y)-d*(i.x-e.x))/v},b=y(s),w=y(o),E=y(u),S=3;s.equals(i)&&S--,u.equals(f)&&S--,r[t]=[0,0,l/h,c/h,o.y,(m.height-m.width)/(m.height+m.width),g/Math.max(m.height,m.width)-2,(b*b+w*w+E*E)/S,p/v,o.isUp?1:-1]}for(t=0;t<r.length;t++){var x=r[t<1?0:t-1],T=r[t],N=r[t+1<r.length?t+1:r.length-1],C=x[2],k=x[3],L=N[2],A=N[3];T[0]=C*L+k*A,T[1]=C*A-k*L}for(t=0;t<r.length;t++)r[t][4]=2*r[t][4]-1,r[t][6]=(r[t][6]+1)/3.2*2-1,r[t][7]=r[t][7]*50-1;e.features=r},d=function(){return 0},v=function(e,t){var n=e.length-1,r,i,s,o,u,a,f,l=[];for(i=0;i<=n;i++){a=e[i].map(d),f=0;for(r=1;r<=t;r++){s=Math.min(i+r,n),o=Math.max(i-r,0);for(u=0;u<e[i].length;u++)a[u]+=r*(e[s][u]-e[o][u]);f+=r*r}f*=2,l[i]=[];for(u=0;u<e[i].length;u++)l[i][u]=a[u]/f}return l},m=function(e){e.deltas=v(e.features,o),e.accels=v(e.deltas,u)},g=function(e){e.features=e.features.map(function(t,n){return t.concat(e.deltas[n],e.accels[n])}),delete e.deltas,delete e.accels},y=function(e){console.assert(e.Type==="linear"),console.assert(e.CovKind==="euclidean");var t=function(t,r){var i=[];e.Nodes.forEach(function(e){var t=r*(e.VQ-1);e.Mean.forEach(function(e,n){i[t+n]=e})});var s=new n(i.length);return i.forEach(function(e,t){s[t]=e}),s},r=function(e,t,n){var r=n.length*t,i=0,s,o;for(o=0;o<n.length;o++)s=n[o]-e[r+o],i+=s*s;return i},i=function(e,t){var n=0,i=r(e,0,t),s;for(s=1;s*t.length<e.length;s++){var o=r(e,s,t);o<i&&(i=o,n=s)}return n},s=e.Streams.map(function(e,n){return t(n+1,e)}),o=function(e,t){return i(s[t],e)},u=function(){return Array.prototype.map.call(arguments,o)};return u},b=function(e){console.assert(e.Type==="tree"),console.assert(e.CovKind==="euclidean");var t=function(t,r){var i={},s=[],o=[];e.Nodes.forEach(function(e){e.Stream===t&&(i[e.Id]=e)});var u=function(e,t){o[t]=e.VQ;var n=t*r;e.Mean.forEach(function(e,t){s[n+t]=e}),e.LeftId&&u(i[e.LeftId],1+2*t),e.RightId&&u(i[e.RightId],2+2*t)};u(i[1],0);var a=new n(s.length);s.forEach(function(e,t){a[t]=e});var f=new Uint16Array(o.length);return o.forEach(function(e,t){f[t]=e}),[f,a]},r=function(e,t,n){var r=n.length*t,i=0,s,o;for(o=0;o<n.length;o++)s=n[o]-e[r+o],i+=s*s;return i},i=function(e,t,n){var i=0;for(;;){if(e[i]!==0)return e[i]-1;var s=r(t,1+2*i,n),o=r(t,2+2*i,n);i=1+2*i,s>o&&i++}},s=e.Streams.map(function(e,n){return t(n+1,e)}),o=function(e,t){return i(s[t][0],s[t][1],e)},u=function(){return Array.prototype.map.call(arguments,o)};return u},w=function(e){var t;return e.Type==="tree"?t=b(e):e.Type==="linear"?t=y(e):console.assert(!1,e.Type),function(e){e.vq=[];var n;for(n=0;n<e.features.length;n++)e.vq[n]=t(e.features[n],e.deltas[n],e.accels[n])}};return{SMOOTH_N:r,SMOOTH_ALPHA:i,RESAMPLE_INTERVAL:s,Box:a,Point:e,normalize:f,smooth:l,singleStroke:c,equidist:h,features:p,delta_and_accel:m,merge_delta_and_accel:g,make_vq:w}}),define("src/recog",["./compat","./drawcommand","./hand/features"],function(e,t,n,r,i){var s=function(e,r,i){var s,o,u=[],a=[],f=null,l;for(s=r;s<i;s++){o=e[s];switch(o.type){case t.Type.DRAW:a.push([o.pos.x,-o.pos.y]),f?f.unionPt(o.pos):(l=new n.Point(o.pos.x,o.pos.y),f=new n.Box(l.clone(),l.clone()));break;case t.Type.DRAW_END:a.length>0&&(u.push(a),a=[]);break;default:}}if(u.length===0)return null;var c={strokes:u,ppmm:{x:1,y:1},bbox:f};return n.normalize(c),n.smooth(c),n.singleStroke(c),n.equidist(c),c.strokes[0].length===0?null:(n.features(c),c.features.length===0?null:(n.delta_and_accel(c),c))},o=null,u=function(e){console.assert(o===null),o=e},a=new e.Worker("src/worker.js"),f=null,l=!0,c=function(){if(l||f===null)return;var e={type:"recog",data_set:f};a.postMessage(JSON.stringify(e)),f=null,l=!0};a.addEventListener("message",function(e){var t=JSON.parse(e.data);switch(t.type){case"debug":console.log.apply(console,t.args);break;case"ready":l=!1,c();break;case"recog":l=!1,c(),o&&o(t.model,t.prob,t.bbox);break;default:console.error("Unexpected message from worker",e)}}),a.postMessage(JSON.stringify({type:"start"}));var h=function(e,t,n){typeof t!="number"&&(t=0),typeof n!="number"&&(n=e.length);var r=s(e,t,n);if(!r)return;f=r,c();return};return{attemptRecognition:h,registerCallback:u}}),define("src/sound",[],function(){function r(){}function s(e,t){var n=new e({url:t.url,instances:t.instances,callback:t.callback,errback:t.errback})}function o(t){var n=t.url;if(!n)throw"you must pass a URL to Effect.";var s=new i(n,t.formats||[],t.instances||e,t.callback?function(e,t){return function(){t(e)}}(this,t.callback):r,t.errback||r);this.__defineGetter__("audio",function(){return s.getInstance()}),this.__defineGetter__("url",function(){return n}),this.play=function(){var e=this.audio;return e?(e.play(),e):null},this.loop=function(){s.loop()},this.unloop=function(){s.unloop()}}function u(e){e.instances=1,o.call(this,e)}var e=4,t={mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",webm:"audio/webm",m4a:"audio/x-m4a"},n=function(){return"Audio"in window?window.Audio:function(){return document.createElement("audio")}}(),i=function(e,r,i,s,o){var u=new n,a=!1,f=[];u.autobuffer=!0,u.preload="auto",u.addEventListener("error",function(){o(u.error)},!1),u.addEventListener("canplaythrough",function(){if(a)return;while(i--)f.push(u.cloneNode(!0));a=!0,s()},!1);var l=function(e){return e.split(".").pop()},c=function(e){var n=document.createElement("source");n.src=e,t[l(e)]&&(n.type=t[l(e)]),u.appendChild(n)};r&&r.length>0?r.forEach(function(t){c(e+"."+t)}):c(e),this.getInstance=function(){var e,t,n;for(n=0,t=f.length;n<t;n++){e=f[n];if(e.paused||e.ended)return e.ended&&(e.currentTime=0),e}return f.length===0?null:(e=f[0],e.pause(),e.currentTime=0,e)};var h=function(){u.currentTime=0,u.play()};this.loop=function(){u.loop=!0,u.addEventListener("ended",h,!1),u.play()},this.unloop=function(){if(!u.loop)return;u.pause(),u.removeAttribute("loop"),u.removeEventListener("ended",h,!1);try{u.currentTime=0}catch(e){console.log("AUDIO PROBLEM: "+e)}}};return window.cordovaDetect&&(i=function(e,t,n,r,i){var s=[],o=[];e="/android_asset/www/"+e,t&&t.length>0&&(e+="."+t[0]),this.getInstance=function(){var t,r,i;for(i=0,r=s.length;i<r;i++){t=s[i];if(o[i])return t.seekTo(0),o[i]=!1,t}return r<n?(s[r]=t=new Media(e,function(){o[r]=!0}),o[r]=!1,t):s.length===0?null:(t=s[0],t.seekTo(0),t)};var u=null;this.loop=function(){var t;u&&this.unloop();var n=function(){if(u===null||u.id!==t.id)return;t.seekTo(0),t.play()};u=t=new Media(e,n),u.play()},this.unloop=function(){var e=u;u=null,e&&(e.stop(),e.release())},r()}),o.load=function(e){s(o,e)},u.load=function(e){s(u,e)},{Effect:o,Track:u}}),define("src/version",[],function(){return"1"}),define("lib/BlobBuilder",[],function(){var e=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},i=n.prototype,s=r.prototype,o=e.FileReaderSync,u=function(e){this.code=this[this.name=e]},a="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),f=a.length,l=e.URL||e.webkitURL||e,c=l.createObjectURL,h=l.revokeObjectURL,p=l,d=e.btoa,v=e.atob,m=!1,g=function(e){m=!e},y=e.ArrayBuffer,b=e.Uint8Array;n.fake=s.fake=!0;while(f--)u.prototype[a[f]]=f+1;try{b&&g.apply(0,new b(1))}catch(w){}return l.createObjectURL||(p=e.URL={}),p.createObjectURL=function(e){var t=e.type,n;t===null&&(t="application/octet-stream");if(e instanceof r)return n="data:"+t,e.encoding==="base64"?n+";base64,"+e.data:e.encoding==="URI"?n+","+decodeURIComponent(e.data):d?n+";base64,"+d(e.data):n+","+encodeURIComponent(e.data);if(real_create_object_url)return real_create_object_url.call(l,e)},p.revokeObjectURL=function(e){e.substring(0,5)!=="data:"&&real_revoke_object_url&&real_revoke_object_url.call(l,e)},i.append=function(e){var n=this.data;if(b&&e instanceof y)if(m)n.push(String.fromCharCode.apply(String,new b(e)));else{var i="",s=new b(e),a=0,f=s.length;for(;a<f;a++)i+=String.fromCharCode(s[a])}else if(t(e)==="Blob"||t(e)==="File"){if(!o)throw new u("NOT_READABLE_ERR");var l=new o;n.push(l.readAsBinaryString(e))}else e instanceof r?e.encoding==="base64"&&v?n.push(v(e.data)):e.encoding==="URI"?n.push(decodeURIComponent(e.data)):e.encoding==="raw"&&n.push(e.data):(typeof e!="string"&&(e+=""),n.push(unescape(encodeURIComponent(e))))},i.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},i.toString=function(){return"[object BlobBuilder]"},s.slice=function(e,t,n){var i=arguments.length;return i<3&&(n=null),new r(this.data.slice(e,i>1?t:this.data.length),n,this.encoding)},s.toString=function(){return"[object Blob]"},n}(self);return e}),define("lib/canvas-toBlob",[],function(){var e=window,t=e.Uint8Array,n=e.HTMLCanvasElement,r=/\s*;\s*base64\s*(?:;|$)/i,i,s=function(e){var n=e.length,r=new t(n/4*3|0),s=0,o=0,u=[0,0],a=0,f=0,l,c,h;while(n--)c=e.charCodeAt(s++),l=i[c-43],l!==255&&l!==h&&(u[1]=u[0],u[0]=c,f=f<<6|l,a++,a===4&&(r[o++]=f>>>16,u[1]!==61&&(r[o++]=f>>>8),u[0]!==61&&(r[o++]=f),a=0));return r.buffer};t&&(i=new t([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]));var o;return n&&(o=function(n){return function(i,o){o||(o="image/png");if(this.mozGetAsFile&&!n){i(this.mozGetAsFile("canvas",o));return}var u=Array.prototype.slice.call(arguments,1),a=(n?this.toDataURLHD:this.toDataURL).apply(this,u),f=a.indexOf(","),l=a.substring(f+1),c=r.test(a.substring(0,f)),h=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder,p=new h,d;h.fake?(d=p.getBlob(o),c?d.encoding="base64":d.encoding="URI",d.data=l,d.size=l.length):t&&(c?p.append(s(l)):p.append(decodeURIComponent(l)),d=p.getBlob(o)),i(d)}}),n&&!n.prototype.toBlob&&(n.prototype.toBlob=o(!1)),n&&n.prototype.toDataURLHD&&!n.prototype.toBlobHD&&(n.prototype.toBlobHD=o(!0)),n&&n.prototype.toBlob}),define("lib/FileSaver",[],function(){var e=window,t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in i,o=function(n){var r=t.createEvent("MouseEvents");return r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},u=e.webkitRequestFileSystem,a=e.requestFileSystem||u||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",c=0,h=[],p=function(){var e=h.length;while(e--){var t=h[e];typeof t=="string"?r.revokeObjectURL(t):t.remove()}h.length=0},d=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i=="function")try{i.call(e,n||e)}catch(s){f(s)}}},v=function(t,r){var f=this,p=t.type,v=!1,m,g,y=function(){var e=n().createObjectURL(t);return h.push(e),e},b=function(){d(f,"writestart progress write writeend".split(" "))},w=function(){if(v||!m)m=y(t);g.location.href=m,f.readyState=f.DONE,b()},E=function(e){return function(){if(f.readyState!==f.DONE)return e.apply(this,arguments)}},S={create:!0,exclusive:!1},x;f.readyState=f.INIT,r||(r="download");if(s){m=y(t),i.href=m,i.download=r;if(o(i)){f.readyState=f.DONE,b();return}}e.chrome&&p&&p!==l&&(x=t.slice||t.webkitSlice,t=x.call(t,0,t.size,l),v=!0),u&&r!=="download"&&(r+=".download"),p===l||u?g=e:(g=e.open(),g||(g=e.parent));if(!a){w();return}c+=t.size,a(e.TEMPORARY,c,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(r,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL(),h.push(e),f.readyState=f.DONE,d(f,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=f["on"+e]}),n.write(t),f.abort=function(){n.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),w)}),w)};e.getFile(r,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():w()}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};return m.abort=function(){var e=this;e.readyState=e.DONE,d(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,e.addEventListener("unload",p,!1),g}),define("propertyParser",[],function(){function n(t){var n,i={};while(n=e.exec(t))i[n[1]]=r(n[2]||n[3]);return i}function r(e){return t.test(e)?e=e.replace(t,"$1").split(","):e==="null"?e=null:e==="false"?e=!1:e==="true"?e=!0:e===""||e==="''"||e==='""'?e="":isNaN(e)||(e=+e),e}var e=/([\w-]+)\s*:\s*(?:(\[[^\]]+\])|([^,]+)),?/g,t=/^\[([^\]]+)\]$/;return{parseProperties:n,typecastVal:r}}),define("webfont",[],function(){return function(e,t,n,r){function a(e){return function(){return this[e]}}function l(e,t,n){var r=2<arguments.length?Array.prototype.slice.call(arguments,2):[];return function(){return r.push.apply(r,arguments),t.apply(e,r)}}function c(e){this.F=e,this.U=i}function h(e,n,r){e=e.F.getElementsByTagName(n)[0],e||(e=t.documentElement),e&&e.lastChild&&e.insertBefore(r,e.lastChild)}function p(e){function n(){t.body?e():setTimeout(n,0)}n()}function d(e){e.parentNode&&e.parentNode.removeChild(e)}function v(e,t){return e.createElement("link",{rel:"stylesheet",href:t})}function m(e,t){return e.createElement("script",{src:t})}function g(e,t){for(var n=e.className.split(/\s+/),r=0,i=n.length;r<i;r++)if(n[r]==t)return;n.push(t),e.className=n.join(" ").replace(/^\s+/,"")}function y(e,t){for(var n=e.className.split(/\s+/),r=[],i=0,s=n.length;i<s;i++)n[i]!=t&&r.push(n[i]);e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}function b(e,t){for(var n=e.className.split(/\s+/),r=0,i=n.length;r<i;r++)if(n[r]==t)return s;return u}function w(e,t,n){if(e.U===i){var r=e.F.createElement("p");r.innerHTML='<a style="top:1px;">w</a>',e.U=/top/.test(r.getElementsByTagName("a")[0].getAttribute("style"))}e.U?t.setAttribute("style",n):t.style.cssText=n}function E(e,t,n,r,i,s,o,u){this.za=e,this.Fa=t,this.na=n,this.ma=r,this.Ca=i,this.Ba=s,this.la=o,this.Ga=u}function S(e,t){this.a=e,this.k=t}function T(e){var t=k(e.a,/(iPod|iPad|iPhone|Android)/,1);return""!=t?t:(e=k(e.a,/(Linux|Mac_PowerPC|Macintosh|Windows)/,1),""!=e?("Mac_PowerPC"==e&&(e="Macintosh"),e):"Unknown")}function N(e){var t=k(e.a,/(OS X|Windows NT|Android) ([^;)]+)/,2);return t||(t=k(e.a,/(iPhone )?OS ([\d_]+)/,2))?t:(e=k(e.a,/Linux ([i\d]+)/,1))?e:"Unknown"}function C(e){return e=k(e,/(\d+)/,1),""!=e?parseInt(e,10):-1}function k(e,t,n){return(e=e.match(t))&&e[n]?e[n]:""}function L(e){if(e.documentMode)return e.documentMode}function A(e,t,n){this.c=e,this.g=t,this.V=n,this.j="wf",this.h=new X("-")}function O(e){g(e.g,e.h.e(e.j,"loading")),_(e,"loading")}function M(e){y(e.g,e.h.e(e.j,"loading")),b(e.g,e.h.e(e.j,"active"))||g(e.g,e.h.e(e.j,"inactive")),_(e,"inactive")}function _(e,t,n,r){e.V[t]&&e.V[t](n,r)}function D(){this.ea={}}function P(e,t){var n=[],r;for(r in t)if(t.hasOwnProperty(r)){var i=e.ea[r];i&&n.push(i(t[r]))}return n}function H(e,t,n,r,i){this.c=e,this.A=t,this.n=n,this.u=r,this.D=i,this.L=0,this.ia=this.da=u}function B(e){0==--e.L&&e.da&&(e.ia?(e=e.A,y(e.g,e.h.e(e.j,"loading")),y(e.g,e.h.e(e.j,"inactive")),g(e.g,e.h.e(e.j,"active")),_(e,"active")):M(e.A))}function j(e,t,n,r,i,s,o,u,a){this.I=e,this.Z=t,this.c=n,this.n=r,this.u=i,this.D=s,this.ya=new V,this.v=new $,this.M=o,this.B=u,this.qa=a||"BESbswy",this.P=q(this,"arial,'URW Gothic L',sans-serif"),this.Q=q(this,"Georgia,'Century Schoolbook L',serif"),this.ba=this.P,this.ca=this.Q,this.R=R(this,"arial,'URW Gothic L',sans-serif"),this.S=R(this,"Georgia,'Century Schoolbook L',serif")}function F(e){e.u(function(e,t){return function(){t.call(e)}}(e,e.K),25)}function I(e,t){d(e.R),d(e.S),t(e.M,e.B)}function q(e,t){var n=R(e,t,s),r=e.n.p(n);return d(n),r}function R(e,t,n){return t=e.c.createElement("span",{style:U(e,t,e.B,n)},e.qa),h(e.c,"body",t),t}function U(e,t,n,r){return n=e.v.expand(n),"position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;font-family:"+(r?"":e.ya.quote(e.M)+",")+t+";"+n}function z(e,t,n,r,i){this.c=e,this.W=t,this.g=n,this.u=r,this.a=i,this.N=this.O=0}function W(e,t,n){n=P(e.W,n),e.N=e.O=n.length;for(var r=new H(e.c,t,{p:function(e){return e.offsetWidth}},e.u,function(){return(new Date).getTime()}),i=0,s=n.length;i<s;i++){var o=n[i];o.z(e.a,l(e,e.wa,o,t,r))}}function X(e){this.xa=e||"-"}function V(){this.ga="'"}function $(){this.H=J,this.o=K}function Q(e,t,n){this.$=e,this.Da=t,this.o=n}function G(e,t){this.c=e,this.d=t}function Y(e,t,n,r,i,o,a,f,l){Y.Ea.call(this,e,t,n,r,i,o,a,f,l),e="Times New Roman,Lucida Sans Unicode,Courier New,Tahoma,Arial,Microsoft Sans Serif,Times,Lucida Console,Sans,Serif,Monospace".split(","),t=e.length,n={},r=R(this,e[0],s),n[this.n.p(r)]=s;for(i=1;i<t;i++)o=e[i],w(this.c,r,U(this,o,this.B,s)),n[this.n.p(r)]=s,"4"!=this.B[1]&&(w(this.c,r,U(this,o,this.B[0]+"4",s)),n[this.n.p(r)]=s);d(r),this.t=n,this.ka=u}function et(t){this.J=t?t:("https:"==e.location.protocol?"https:":"http:")+tt,this.f=[],this.T=[]}function nt(e){this.f=e,this.fa=[],this.ja={},this.G={},this.v=new $}function st(e,t,n){this.a=e,this.c=t,this.d=n}function ot(e,t){this.c=e,this.d=t}function at(e,t,n){this.m=e,this.c=t,this.d=n,this.f=[],this.s={},this.v=new $}function ft(e,t,n,r,i){this.m=e,this.a=t,this.c=n,this.k=r,this.d=i,this.f=[],this.s={}}function lt(e,t,n){this.m=e,this.c=t,this.d=n,this.f=[],this.s={}}if(!t)return;var i=void 0,s=!0,o=null,u=!1,f;c.prototype.createElement=function(e,t,n){e=this.F.createElement(e);if(t)for(var r in t)t.hasOwnProperty(r)&&("style"==r?w(this,e,t[r]):e.setAttribute(r,t[r]));return n&&e.appendChild(this.F.createTextNode(n)),e},f=E.prototype,f.getName=a("za"),f.va=a("Fa"),f.X=a("na"),f.sa=a("ma"),f.ta=a("Ca"),f.ua=a("Ba"),f.ra=a("la"),f.w=a("Ga");var x=new E("Unknown","Unknown","Unknown","Unknown","Unknown","Unknown",i,u);S.prototype.parse=function(){var e;if(-1!=this.a.indexOf("MSIE"))if(e=k(this.a,/(MSIE [\d\w\.]+)/,1),""!=e){var t=e.split(" ");e=t[0],t=t[1],e=new E(e,t,e,t,T(this),N(this),L(this.k),6<=C(t))}else e=new E("MSIE","Unknown","MSIE","Unknown",T(this),N(this),L(this.k),u);else if(-1!=this.a.indexOf("Opera"))e:{var t=e="Unknown",n=k(this.a,/(Presto\/[\d\w\.]+)/,1);""!=n?(t=n.split("/"),e=t[0],t=t[1]):(-1!=this.a.indexOf("Gecko")&&(e="Gecko"),n=k(this.a,/rv:([^\)]+)/,1),""!=n&&(t=n));if(-1!=this.a.indexOf("Version/")&&(n=k(this.a,/Version\/([\d\.]+)/,1),""!=n)){e=new E("Opera",n,e,t,T(this),N(this),L(this.k),10<=C(n));break e}n=k(this.a,/Opera[\/ ]([\d\.]+)/,1),e=""!=n?new E("Opera",n,e,t,T(this),N(this),L(this.k),10<=C(n)):new E("Opera","Unknown",e,t,T(this),N(this),L(this.k),u)}else if(-1!=this.a.indexOf("AppleWebKit")){e=T(this),t=N(this),n=k(this.a,/AppleWebKit\/([\d\.\+]+)/,1),""==n&&(n="Unknown");var r="Unknown";-1!=this.a.indexOf("Chrome")||-1!=this.a.indexOf("CrMo")?r="Chrome":-1!=this.a.indexOf("Safari")?r="Safari":-1!=this.a.indexOf("AdobeAIR")&&(r="AdobeAIR");var i="Unknown";-1!=this.a.indexOf("Version/")?i=k(this.a,/Version\/([\d\.\w]+)/,1):"Chrome"==r?i=k(this.a,/(Chrome|CrMo)\/([\d\.]+)/,2):"AdobeAIR"==r&&(i=k(this.a,/AdobeAIR\/([\d\.]+)/,1));var s=u;"AdobeAIR"==r?(s=k(i,/\d+\.(\d+)/,1),s=2<C(i)||2==C(i)&&5<=parseInt(s,10)):(s=k(n,/\d+\.(\d+)/,1),s=526<=C(n)||525<=C(n)&&13<=parseInt(s,10)),e=new E(r,i,"AppleWebKit",n,e,t,L(this.k),s)}else-1!=this.a.indexOf("Gecko")?(t=e="Unknown",r=u,-1!=this.a.indexOf("Firefox")?(e="Firefox",n=k(this.a,/Firefox\/([\d\w\.]+)/,1),""!=n&&(r=k(n,/\d+\.(\d+)/,1),t=n,r=""!=n&&3<=C(n)&&5<=parseInt(r,10))):-1!=this.a.indexOf("Mozilla")&&(e="Mozilla"),n=k(this.a,/rv:([^\)]+)/,1),""==n?n="Unknown":r||(r=C(n),i=parseInt(k(n,/\d+\.(\d+)/,1),10),s=parseInt(k(n,/\d+\.\d+\.(\d+)/,1),10),r=1<r||1==r&&9<i||1==r&&9==i&&2<=s||n.match(/1\.9\.1b[123]/)!=o||n.match(/1\.9\.1\.[\d\.]+/)!=o),e=new E(e,t,"Gecko",n,T(this),N(this),L(this.k),r)):e=x;return e},H.prototype.watch=function(e,t,n,r,i){for(var s=e.length,o=0;o<s;o++){var u=e[o];t[u]||(t[u]=["n4"]),this.L+=t[u].length}i&&(this.da=i);for(o=0;o<s;o++)for(var u=e[o],i=t[u],a=n[u],f=0,c=i.length;f<c;f++){var h=i[f],p=this.A,d=u,v=h;g(p.g,p.h.e(p.j,d,v,"loading")),_(p,"fontloading",d,v),p=l(this,this.oa),d=l(this,this.pa),(new r(p,d,this.c,this.n,this.u,this.D,u,h,a)).start()}},H.prototype.oa=function(e,t){var n=this.A;y(n.g,n.h.e(n.j,e,t,"loading")),y(n.g,n.h.e(n.j,e,t,"inactive")),g(n.g,n.h.e(n.j,e,t,"active")),_(n,"fontactive",e,t),this.ia=s,B(this)},H.prototype.pa=function(e,t){var n=this.A;y(n.g,n.h.e(n.j,e,t,"loading")),b(n.g,n.h.e(n.j,e,t,"active"))||g(n.g,n.h.e(n.j,e,t,"inactive")),_(n,"fontinactive",e,t),B(this)},j.prototype.start=function(){this.ha=this.D(),this.K()},j.prototype.K=function(){var e=this.n.p(this.R),t=this.n.p(this.S);this.P==e&&this.Q==t||this.ba!=e||this.ca!=t?5e3<=this.D()-this.ha?I(this,this.Z):(this.ba=e,this.ca=t,F(this)):I(this,this.I)},z.prototype.q=function(e,t){this.W.ea[e]=t},z.prototype.load=function(e){var t=new A(this.c,this.g,e);this.a.w()?W(this,t,e):M(t)},z.prototype.wa=function(e,t,n,r){var i=e.Y?e.Y():j;r?e.load(l(this,this.Aa,t,n,i)):(e=0==--this.O,this.N--,e&&(0==this.N?M(t):O(t)),n.watch([],{},{},i,e))},z.prototype.Aa=function(e,t,n,r,i,s){var o=0==--this.O;o&&O(e),this.u(l(this,function(e,t,n,r,i,s){e.watch(t,n||{},r||{},i,s)},t,r,i,s,n,o))},X.prototype.e=function(e){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.xa)},V.prototype.quote=function(e){for(var t=[],e=e.split(/,\s*/),n=0;n<e.length;n++){var r=e[n].replace(/['"]/g,"");-1==r.indexOf(" ")?t.push(r):t.push(this.ga+r+this.ga)}return t.join(",")};var J=["font-style","font-weight"],K={"font-style":[["n","normal"],["i","italic"],["o","oblique"]],"font-weight":[["1","100"],["2","200"],["3","300"],["4","400"],["5","500"],["6","600"],["7","700"],["8","800"],["9","900"],["4","normal"],["7","bold"]]};Q.prototype.compact=function(e,t){for(var n=0;n<this.o.length;n++)if(t==this.o[n][1]){e[this.$]=this.o[n][0];break}},Q.prototype.expand=function(e,t){for(var n=0;n<this.o.length;n++)if(t==this.o[n][0]){e[this.$]=this.Da+":"+this.o[n][1];break}},$.prototype.compact=function(e){for(var t=["n","4"],e=e.split(";"),n=0,r=e.length;n<r;n++){var i=e[n].replace(/\s+/g,"").split(":");if(2==i.length){var s=i[1];e:{for(var i=i[0],u=0;u<this.H.length;u++)if(i==this.H[u]){i=new Q(u,i,this.o[i]);break e}i=o}i&&i.compact(t,s)}}return t.join("")},$.prototype.expand=function(e){if(2!=e.length)return o;for(var t=[o,o],n=0,r=this.H.length;n<r;n++){var i=this.H[n];(new Q(n,i,this.o[i])).expand(t,e.substr(n,1))}return t[0]&&t[1]?t.join(";")+";":o},e.WebFont=function(){var e=(new S(n.userAgent,t)).parse();return new z(new c(t),new D,t.documentElement,function(e,t){setTimeout(e,t)},e)}(),e.WebFont.load=e.WebFont.load,e.WebFont.addModule=e.WebFont.q,E.prototype.getName=E.prototype.getName,E.prototype.getVersion=E.prototype.va,E.prototype.getEngine=E.prototype.X,E.prototype.getEngineVersion=E.prototype.sa,E.prototype.getPlatform=E.prototype.ta,E.prototype.getPlatformVersion=E.prototype.ua,E.prototype.getDocumentMode=E.prototype.ra,E.prototype.isSupportingWebFont=E.prototype.w,G.prototype.load=function(e){for(var t=this.d.urls||[],n=this.d.families||[],r=0,i=t.length;r<i;r++)h(this.c,"head",v(this.c,t[r]));e(n)},G.prototype.z=function(e,t){return t(e.w())},e.WebFont.q("custom",function(e){return new G(new c(t),e)}),function(e,t){function n(){}n.prototype=e.prototype,t.prototype=new n,t.Ea=e,t.Ha=e.prototype}(j,Y);var Z={Arimo:s,Cousine:s,Tinos:s};Y.prototype.K=function(){var e=this.n.p(this.R),t=this.n.p(this.S);!this.ka&&e==t&&this.t[e]&&(this.t={},this.ka=this.t[e]=s),(this.P!=e||this.Q!=t)&&!this.t[e]&&!this.t[t]?I(this,this.I):5e3<=this.D()-this.ha?this.t[e]&&this.t[t]&&Z[this.M]?I(this,this.I):I(this,this.Z):F(this)};var tt="//fonts.googleapis.com/css";et.prototype.e=function(){if(0==this.f.length)throw Error("No fonts to load !");if(-1!=this.J.indexOf("kit="))return this.J;for(var e=this.f.length,t=[],n=0;n<e;n++)t.push(this.f[n].replace(/ /g,"+"));return e=this.J+"?family="+t.join("%7C"),0<this.T.length&&(e+="&subset="+this.T.join(",")),e};var rt={ultralight:"n2",light:"n3",regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",ul:"n2",l:"n3",r:"n4",b:"n7",i:"i4",bi:"i7"},it={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"};nt.prototype.parse=function(){for(var e=this.f.length,t=0;t<e;t++){var n=this.f[t].split(":"),r=n[0].replace(/\+/g," "),i=["n4"];if(2<=n.length){var s,u=n[1];s=[];if(u)for(var u=u.split(","),a=u.length,f=0;f<a;f++){var l;l=u[f];if(l.match(/^[\w ]+$/)){var c=rt[l];c?l=c:(c=l.match(/^(\d*)(\w*)$/),l=c[1],c=c[2],l=(l=this.v.expand([c?c:"n",l?l.substr(0,1):"4"].join("")))?this.v.compact(l):o)}else l="";l&&s.push(l)}0<s.length&&(i=s),3==n.length&&(n=n[2],s=[],n=n?n.split(","):s,0<n.length&&(n=it[n[0]])&&(this.G[r]=n))}this.G[r]||(n=it[r])&&(this.G[r]=n),this.fa.push(r),this.ja[r]=i}},st.prototype.z=function(e,t){t(e.w())},st.prototype.Y=function(){return"AppleWebKit"==this.a.X()?Y:j},st.prototype.load=function(e){"MSIE"==this.a.getName()&&this.d.blocking!=s?p(l(this,this.aa,e)):this.aa(e)},st.prototype.aa=function(e){for(var t=this.c,n=new et(this.d.api),r=this.d.families,i=r.length,s=0;s<i;s++){var o=r[s].split(":");3==o.length&&n.T.push(o.pop()),n.f.push(o.join(":"))}r=new nt(r),r.parse(),h(t,"head",v(t,n.e())),e(r.fa,r.ja,r.G)},e.WebFont.q("google",function(e){var r=(new S(n.userAgent,t)).parse();return new st(r,new c(t),e)});var ut={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"};return ot.prototype.z=function(e,t){return t(e.w())},ot.prototype.load=function(e){var n,r;h(this.c,"head",v(this.c,("https:"==t.location.protocol?"https:":"http:")+"//webfonts.fontslive.com/css/"+this.d.key+".css"));var s=this.d.families,o,u;o=[],u={};for(var a=0,f=s.length;a<f;a++){r=r=n=i,r=s[a].split(":"),n=r[0];if(r[1]){r=r[1].split(",");for(var l=[],c=0,p=r.length;c<p;c++){var d=r[c];if(d){var m=ut[d];l.push(m?m:d)}}r=l}else r=["n4"];o.push(n),u[n]=r}e(o,u)},e.WebFont.q("ascender",function(e){return new ot(new c(t),e)}),at.prototype.C=function(e){return("https:"==this.m.location.protocol?"https:":"http:")+(this.d.api||"//f.fontdeck.com/s/css/js/")+this.m.document.location.hostname+"/"+e+".js"},at.prototype.z=function(e,t){var n=this.d.id,r=this;n?(this.m.__webfontfontdeckmodule__||(this.m.__webfontfontdeckmodule__={}),this.m.__webfontfontdeckmodule__[n]=function(e,n){for(var i=0,s=n.fonts.length;i<s;++i){var o=n.fonts[i];r.f.push(o.name),r.s[o.name]=[r.v.compact("font-weight:"+o.weight+";font-style:"+o.style)]}t(e)},h(this.c,"head",m(this.c,this.C(n)))):t(s)},at.prototype.load=function(e){e(this.f,this.s)},e.WebFont.q("fontdeck",function(n){return new at(e,new c(t),n)}),ft.prototype.z=function(e,t){var n=this,r=n.d.projectId;if(r){var i=m(n.c,n.C(r));i.id="__MonotypeAPIScript__"+r,i.onreadystatechange=function(e){if("loaded"===i.readyState||"complete"===i.readyState)i.onreadystatechange=o,i.onload(e)},i.onload=function(){if(n.m["__mti_fntLst"+r]){var i=n.m["__mti_fntLst"+r]();if(i&&i.length){var s;for(s=0;s<i.length;s++)n.f.push(i[s].fontfamily)}}t(e.w())},h(this.c,"head",i)}else t(s)},ft.prototype.C=function(e){var t=this.protocol(),n=(this.d.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return t+"//"+n+"/"+e+".js"},ft.prototype.load=function(e){e(this.f,this.s)},ft.prototype.protocol=function(){var e=["http:","https:"],t=e[0];if(this.k&&this.k.location&&this.k.location.protocol)for(var n=0,n=0;n<e.length;n++)if(this.k.location.protocol===e[n])return this.k.location.protocol;return t},e.WebFont.q("monotype",function(r){var i=(new S(n.userAgent,t)).parse();return new ft(e,i,new c(t),t,r)}),lt.prototype.C=function(t){var n="https:"==e.location.protocol?"https:":"http:";return(this.d.api||n+"//use.typekit.com")+"/"+t+".js"},lt.prototype.z=function(e,t){var n=this.d.id,r=this.d,i=this;n?(this.m.__webfonttypekitmodule__||(this.m.__webfonttypekitmodule__={}),this.m.__webfonttypekitmodule__[n]=function(n){n(e,r,function(e,n,r){i.f=n,i.s=r,t(e)})},h(this.c,"head",m(this.c,this.C(n)))):t(s)},lt.prototype.load=function(e){e(this.f,this.s)},e.WebFont.q("typekit",function(n){return new lt(e,new c(t),n)}),e.WebFontConfig&&e.WebFont.load(e.WebFontConfig),e.WebFont}(typeof window=="undefined"?null:window,typeof document=="undefined"?null:document,typeof navigator=="undefined"?{}:navigator)}),define("font",["propertyParser","webfont"],function(e,t){function r(t){var r={},i=t.split("|"),s=i.length,o;while(s--)o=n.exec(i[s]),r[o[1]]=e.parseProperties(o[2]);return r}var n=/^([^,]+),([^\|]+)\|?/;return{load:function(e,n,i,s){if(s.isBuild)i(null);else{var o=r(e);o.active=function(){i(!0)},o.inactive=function(){i(!1)},t.load(o)}}}}),define("ncolors",["require","domReady!","./src/brush","./src/brushdialog","./src/color","./src/compat","./src/dom","./src/drawcommand","./src/drawing","json!./src/fontmetrics.json","./src/funf","./src/gallery","./lib/hammer","./src/layer","./src/lzw","./src/postmessage","./src/prandom!","./src/recog","./src/sound","./src/sync","./src/version","./lib/BlobBuilder","./lib/canvas-toBlob","./lib/FileSaver","font!custom,families:[Delius,DejaVu LGC Sans Book],urls:[fonts/style.css]"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){var T=typeof MessageChannel!="undefined",N=null,C=750,k=1e3/30,L=!0,A=25;/(iPhone|iPad).*Safari/.test(navigator.userAgent)&&(A=0);var O=new l("NellColors"+w);O.record("startVersion",w),window.parent.document.body.classList.contains("dev")?t.body.classList.add("dev"):L=!1,o.insertMeta(t);var M=t.getElementById("drawing"),_=new a;_.placeholder=!0,_.attachToContainer(M);var D=new h(M,{prevent_default:!0,drag_min_distance:2}),P=new r(t.getElementById("brushdialog"),!0),H,B,j,F,I,q=null,R=function(){q&&(clearTimeout(q),q=null)},U=function(){_.commands.recog=_.commands.end,R()},z=function(){q=null,U()},W=function(){q&&clearTimeout(q),q=setTimeout(z,C)},X=function(){};L&&(X=function(){var e=t.getElementById("framerate"),n=e.children[0],r=[Date.now()];return e.style.display="block",function(){r.push(Date.now());while(r.length>20)r.shift();var e=(r[r.length-1]-r[0])/(r.length-1),t=1e3/e;n.textContent=Math.round(t)}}());var V=!1,$=0,J={isPlaying:!1,lastFrameTime:0,speed:$},K=function(){if(!J.isPlaying)return;J.speed=$,N.postMessage(JSON.stringify({type:"stopping"})),U()},Q=function(){J.isPlaying||(J.lastFrameTime=Date.now(),J.speed=4),_.setCmdPos(a.START),B(),H()},G=function(){console.assert(_.commands.last!==_.commands.end),console.assert(V);var e=Date.now(),t;X();if(J.speed===$)t=_.setCmdPos(a.END,k);else{var n=e-J.lastFrameTime;n=Math.min(100,n),t=_.setCmdTime(n*J.speed,k)}J.lastFrameTime=e,t?(J.isPlaying||(J.isPlaying=!0,J.speed===$?N.postMessage(JSON.stringify({type:"stopping"})):N.postMessage(JSON.stringify({type:"playing"})),_.checkpointOften=!1),s.requestAnimationFrame(G)):(J.isPlaying&&(J.isPlaying=!1,J.speed=$,N.postMessage(JSON.stringify({type:"stopped"})),_.checkpointOften=!0,_.addCheckpoint(!0)),V=!1,j())};H=function(){V||(console.assert(_.commands.last!==_.commands.end),V=!0,s.requestAnimationFrame(G))};var Y=!1,Z={x:null,y:null,time:0};D.ondrag=function(e){K(),Y||(B(),_.addCmd(u.create_draw_start(_.layers.current)),Z.x=Z.y=null,Z.time=0),Y=!0;if(e.position.x===Z.x&&e.position.y===Z.y)return;var t=Date.now();if(t-Z.time<A)return;Z.x=e.position.x,Z.y=e.position.y,Z.time=t,_.addCmd(u.create_draw(e.position)),H(),R()},D.ondragend=function(e){Y=!1,_.addCmd(u.create_draw_end()),H(),e&&(O.record("stroke",{}),g.attemptRecognition(_.commands,_.commands.recog,_.commands.end)),W(),I()};var et={};["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"].forEach(function(e,t){var n=null;/(iPhone|iPad).*Safari/.test(navigator.userAgent)||(n=new y.Effect({url:"audio/"+e,instances:1,formats:["webm"]})),et[e]=n}),B=function(){var e=M.querySelector("canvas.recogCanvas");e&&(e.style.display="none")};var tt=function(e,n,r){if(n<400){B();return}var i=e.charAt(0);O.record("recog",{model:e,prob:n,bbox:r});var s=r.br.x-r.tl.x,o=r.br.y-r.tl.y,u=f[i],a=M.querySelector("canvas.recogCanvas");a||(a=t.createElement("canvas"),a.className="recogCanvas",a.style.position="absolute",a.style.opacity=.75,t.body.classList.contains("dev")&&(a.style.border="1px dashed #ccc"),M.appendChild(a)),a.style.display="block";var l=Math.min(s/u.w,o/u.h);a.width=Math.ceil(l*u.fw),a.height=Math.ceil(l*u.fh),a.style.width=a.width+"px",a.style.height=a.height+"px";var c=a.getContext("2d");c.clearRect(0,0,a.width,a.height),c.font=f.font,c.textAlign=f.textAlign,c.textBaseline=f.textBaseline,c.translate(a.width/2,a.height/2),c.scale(l,l),c.translate(-u.cx,-u.cy),c.strokeStyle="white",c.lineWidth=f.outerOutline,c.strokeText(i,0,0),c.strokeStyle="black",c.lineWidth=f.innerOutline,c.strokeText(i,0,0),c.fillStyle=_.brush.color.to_string().replace(/..$/,""),c.fillText(i,0,0);var h=(r.tl.x+r.br.x)/2,p=(r.tl.y+r.br.y)/2;a.style.left=Math.round(h-a.width/2)+"px",a.style.top=Math.round(p-a.height/2)+"px";var d=et[i.toUpperCase()];if(d)try{d.play()}catch(v){/(iPhone|iPad).*Safari/.test(navigator.userAgent)||console.log("Unexpected problem playing audio.",v)}};g.registerCallback(tt);var nt=function(e,t){var n={type:"color",red:e.red,green:e.green,blue:e.blue,opacity:t};N.postMessage(JSON.stringify(n))};j=function(){var e=new n,t=!0;return function(){if(e.equals(_.brush)&&!t)return;e.set_from_brush(_.brush),t=!1,nt(_.brush.color,_.brush.opacity);var n={type:"brush",brush_type:_.brush.type,size:_.brush.size,opacity:_.brush.opacity,spacing:_.brush.spacing};N.postMessage(JSON.stringify(n)),P.isOpen()&&P.updateBrush(_.brush,!0)}}(),P.colorCallback=function(e){nt(e.rgbaColor(),e.opacity/255)};var rt=null;t.querySelector("#mask").addEventListener("click",function(e){e.preventDefault(),rt&&rt()});var it=function(e){var n=_.commands.last===_.commands.end;t.body.classList.remove("mask"),rt=null,N.postMessage(JSON.stringify({type:"toolbar-mode-switch",mode:"drawing"}));if(n&&e.equals(_.brush))return;var r={},s=!1;["type","size","opacity","spacing"].forEach(function(t){if(e[t]===_.brush[t])return;r[t==="type"?"brush_type":t]=e[t],s=!0}),s&&_.addCmd(u.create_brush_change(r)),i.equal(_.brush.color,e.color)||_.addCmd(u.create_color_change(e.color)),n&&(_.setCmdPos(a.END),j())},st=function(e){P.isOpen()?P.currentPane()!==e?P.switchPane(e):P.close(!0):(P.open(_.brush,e,it),t.body.classList.add("mask"),rt=function(){P.close(!0)},N.postMessage(JSON.stringify({type:"toolbar-mode-switch",mode:"brushdialog"})))},ot=function(){console.assert(!Y);var e=_.undo(k);e?H():j(),U(),I()},ut=function(){console.assert(!Y);var e=_.redo(k);e?H():j(),U(),I()},at=function(e){var n=JSON.stringify(_,null,1),r,i,s,o;if(e){r="text/plain;charset=ascii",i="drawing.json";try{s=new window.Blob([n],{type:r})}catch(u){var a=new E;a.append(n),s=a.getBlob(r)}x(s,"drawing.json")}else{r="image/png",i="drawing-json.png";var f=d.encode(n,!0);f=String.fromCharCode((f.length+1)%3)+f;var l=Math.ceil(Math.sqrt(f.length/3)),c=t.createElement("canvas"),h=c.getContext("2d"),p=h.createImageDataHD||h.createImageData,v=p.call(h,100,1),m=v.width/100;c.width=Math.ceil(l/m),c.height=Math.ceil(f.length/(3*m*l)),v=p.call(h,c.width,c.height),console.assert(v.width*v.height*3>=f.length);var g;for(g=0;g<f.length/3;g++)v.data[g*4+0]=f.charCodeAt(g*3+0)||0,v.data[g*4+1]=f.charCodeAt(g*3+1)||0,v.data[g*4+2]=f.charCodeAt(g*3+2)||0,v.data[g*4+3]=255;var y=h.putImageDataHD||h.putImageData;y.call(h,v,0,0);var b=c.toBlob||c.toBlobHD;s=b.call(c,function(e){x(e,i)},r)}},ft=function(){console.log("saving",_.uuid),b.save(_,function(){console.log("saved!",_.uuid),b.load(_.uuid,function(e){console.log("loaded",e.uuid),F(e)})})};I=function(){var e=!1,t=!1;return function(){if(e){t=!0;return}e=!0,t=!0;var n=_,r=function(){t?(t=!1,b.save(n,r)):e=!1};r()}}();var lt=function(e){var t=window.innerWidth,n=window.innerHeight,r=window.devicePixelRatio||1,i=_.commands.last;_.resize(t,n,r);var s=_.setCmdPos(i,k);s&&H()};window.addEventListener("resize",lt,!1);var ct=function(e){Y&&D.ondragend();var t=JSON.parse(e.data);O.record("toolbar",t),t.type!=="playButton"&&K();var n=_.commands.last===_.commands.end;switch(t.type){case"undoButton":B(),ot();break;case"redoButton":B(),ut();break;case"swatchButton":var r=i.from_string(t.color);if(n&&!P.isOpen()&&i.equal(_.brush.color,r)&&_.brush.opacity===1)break;_.addCmd(u.create_color_change(r));var s={};if(P.isOpen()){var o=P.currentBrush();["type","size","opacity","spacing"].forEach(function(e){s[e==="type"?"brush_type":e]=o[e]})}s.opacity=1,_.addCmd(u.create_brush_change(s)),n&&(_.setCmdPos(a.END),j());break;case"colorButton":st("color");break;case"brushButton":st("brush");break;case"playButton":J.isPlaying&&J.speed!==$?K():Q();break;case"saveButton":at();break;default:console.warn("Unexpected child toolbar message",e)}},ht=function(e){var t=e.data;typeof t=="string"&&(t=JSON.parse(t));switch(t.type){case"toolbar":return N.dispatchEvent({data:t.msg});default:console.warn("Unexpected child message",e)}};window.addEventListener("message",ht,!1);var pt={type:"childReady"};if(T){var dt=new MessageChannel;N=dt.port1,N.addEventListener("message",ct,!1),N.start(),v(window.parent,JSON.stringify(pt),"*",[dt.port2])}else N={dispatchEvent:function(e){ct(e)},postMessage:function(e){var t={type:"toolbar",msg:e};v(window.parent,JSON.stringify(t),"*")}},v(window.parent,JSON.stringify(pt),"*");var vt=function(e,t,n){var r={type:"hashchange",hash:e};t&&(r.replace=!0,r.title=n),v(window.parent,JSON.stringify(r),"*")};F=function(e,n){console.assert(e.uuid),_.removeFromContainer(M),B(),R(),_=e,_.attachToContainer(M),t.location.hash!=="#"+_.uuid&&(t.location.hash="#"+_.uuid,vt(t.location.hash)),_.initial_playback_speed&&(J.speed=_.initial_playback_speed),j(),lt(),t.getElementById("loading").style.display="none",N.postMessage(JSON.stringify({type:"toolbar-mode-switch",mode:"drawing"})),O.record("mode",{name:"drawing",uuid:_.uuid,length:_.commands.length}),n&&I()};var mt=function(n,r){var i,s;t.getElementById("loading").style.display="block",N.postMessage(JSON.stringify({type:"toolbar-mode-switch",mode:"loading"}));switch(n){case"castle":case"intro":case"lounge":case"r":case"roger":e(["drw!samples/"+n+".json"],function(e){e.uuid=m.uuid(),window.history.replaceState&&(window.history.replaceState(null,n,"#"+e.uuid),vt("#"+e.uuid,!0,n)),r(e,!0)});break;case"":case"gallery":s=new c(O),s.wait(function(e){t.body.removeChild(s.domElement),mt(e,r)}),t.body.appendChild(s.domElement),N.postMessage(JSON.stringify({type:"toolbar-mode-switch",mode:"gallery"})),O.record("mode",{name:"gallery"}),_.removeFromContainer(M),B(),R(),_=new a,_.placeholder=!0,_.attachToContainer(M);break;case"new":i=new a,i.uuid=m.uuid(),r(i);break;default:b.exists(n,function(e){e?b.load(n,r):(i=new a,i.uuid=n,r(i))})}},gt=function(){var e=t.location.hash.replace(/^#/,"");if(e===_.uuid)return;vt(t.location.hash,!0,e),c.abort(),mt(e,F)};window.addEventListener("hashchange",gt,!1),mt(t.location.hash.replace(/^#/,""),F)}),define("drw",["src/drawing"],function(e){return{load:function(t,n,r,i){n(["json!"+t],function(t){i.isBuild?r(null):e.fromJSON(t,function(e){r(e)})})}}}),define("json!samples/r.json",function(){return{initial_playback_speed:2,commands:[{type:2,color:{red:0,green:0,blue:0,alpha:255}},{type:3,brush_type:0,size:20,opacity:.2,spacing:.2},{type:4,layer:0},{type:0,pos:{x:59,y:37},time:1335453187813},{type:0,pos:{x:59,y:38},time:1335453187842},{type:0,pos:{x:59,y:40},time:1335453187874},{type:0,pos:{x:59,y:41},time:1335453187922},{type:0,pos:{x:59,y:43},time:1335453187962},{type:0,pos:{x:59,y:45},time:1335453188020},{type:0,pos:{x:59,y:46},time:1335453188070},{type:0,pos:{x:58,y:47},time:1335453188119},{type:0,pos:{x:58,y:49},time:1335453188149},{type:0,pos:{x:58,y:50},time:1335453188198},{type:0,pos:{x:58,y:51},time:1335453188248},{type:0,pos:{x:58,y:52},time:1335453188297},{type:0,pos:{x:58,y:53},time:1335453188367},{type:1},{type:4,layer:0},{type:0,pos:{x:59,y:75},time:1335453189441},{type:0,pos:{x:59,y:77},time:1335453189471},{type:0,pos:{x:59,y:79},time:1335453189500},{type:0,pos:{x:59,y:81},time:1335453189559},{type:0,pos:{x:59,y:82},time:1335453189619},{type:0,pos:{x:59,y:83},time:1335453189648},{type:0,pos:{x:58,y:86},time:1335453189698},{type:0,pos:{x:58,y:89},time:1335453189750},{type:0,pos:{x:58,y:90},time:1335453189787},{type:0,pos:{x:58,y:92},time:1335453189846},{type:0,pos:{x:58,y:95},time:1335453189888},{type:1},{type:4,layer:0},{type:0,pos:{x:58,y:121},time:1335453190717},{type:0,pos:{x:58,y:125},time:1335453190770},{type:0,pos:{x:58,y:127},time:1335453190837},{type:0,pos:{x:58,y:128},time:1335453190886},{type:0,pos:{x:58,y:129},time:1335453190936},{type:0,pos:{x:58,y:130},time:1335453190985},{type:0,pos:{x:58,y:131},time:1335453191035},{type:0,pos:{x:58,y:133},time:1335453191064},{type:0,pos:{x:58,y:134},time:1335453191104},{type:0,pos:{x:58,y:135},time:1335453191144},{type:0,pos:{x:58,y:139},time:1335453191177},{type:0,pos:{x:58,y:142},time:1335453191252},{type:0,pos:{x:58,y:144},time:1335453191302},{type:0,pos:{x:58,y:145},time:1335453191342},{type:1},{type:4,layer:0},{type:0,pos:{x:58,y:170},time:1335453192113},{type:0,pos:{x:59,y:174},time:1335453192161},{type:0,pos:{x:59,y:176},time:1335453192191},{type:0,pos:{x:59,y:180},time:1335453192225},{type:0,pos:{x:59,y:183},time:1335453192254},{type:0,pos:{x:59,y:185},time:1335453192300},{type:0,pos:{x:59,y:186},time:1335453192359},{type:0,pos:{x:60,y:186},time:1335453192389},{type:0,pos:{x:60,y:188},time:1335453192468},{type:0,pos:{x:60,y:189},time:1335453192537},{type:1},{type:4,layer:0},{type:0,pos:{x:60,y:213},time:1335453193790},{type:0,pos:{x:60,y:214},time:1335453193817},{type:0,pos:{x:60,y:216},time:1335453193857},{type:0,pos:{x:61,y:219},time:1335453193888},{type:0,pos:{x:61,y:220},time:1335453193942},{type:0,pos:{x:61,y:221},time:1335453194001},{type:0,pos:{x:61,y:222},time:1335453194051},{type:0,pos:{x:61,y:223},time:1335453194100},{type:0,pos:{x:61,y:226},time:1335453194140},{type:0,pos:{x:61,y:227},time:1335453194199},{type:0,pos:{x:61,y:229},time:1335453194258},{type:0,pos:{x:61,y:240},time:1335453194367},{type:1},{type:4,layer:0},{type:0,pos:{x:41,y:35},time:1335453196405},{type:0,pos:{x:43,y:35},time:1335453196436},{type:0,pos:{x:45,y:35},time:1335453196465},{type:0,pos:{x:46,y:35},time:1335453196504},{type:0,pos:{x:48,y:35},time:1335453196537},{type:0,pos:{x:49,y:35},time:1335453196594},{type:0,pos:{x:50,y:35},time:1335453196634},{type:0,pos:{x:51,y:35},time:1335453196667},{type:0,pos:{x:53,y:35},time:1335453196703},{type:0,pos:{x:56,y:35},time:1335453196752},{type:0,pos:{x:57,y:35},time:1335453196802},{type:0,pos:{x:60,y:35},time:1335453196851},{type:0,pos:{x:62,y:35},time:1335453196881},{type:0,pos:{x:63,y:35},time:1335453196911},{type:0,pos:{x:64,y:35},time:1335453196960},{type:0,pos:{x:65,y:35},time:1335453197e3},{type:0,pos:{x:66,y:35},time:1335453197059},{type:0,pos:{x:67,y:35},time:1335453197119},{type:0,pos:{x:68,y:35},time:1335453197168},{type:0,pos:{x:69,y:35},time:1335453197218},{type:1},{type:4,layer:0},{type:0,pos:{x:95,y:35},time:1335453197841},{type:0,pos:{x:97,y:35},time:1335453197900},{type:0,pos:{x:98,y:35},time:1335453197949},{type:0,pos:{x:99,y:35},time:1335453197999},{type:0,pos:{x:101,y:35},time:1335453198029},{type:0,pos:{x:102,y:35},time:1335453198062},{type:0,pos:{x:103,y:35},time:1335453198109},{type:0,pos:{x:104,y:35},time:1335453198159},{type:0,pos:{x:108,y:35},time:1335453198198},{type:0,pos:{x:110,y:35},time:1335453198272},{type:0,pos:{x:111,y:35},time:1335453198307},{type:0,pos:{x:112,y:35},time:1335453198356},{type:0,pos:{x:113,y:35},time:1335453198396},{type:0,pos:{x:114,y:35},time:1335453198456},{type:0,pos:{x:114,y:36},time:1335453198485},{type:0,pos:{x:116,y:36},time:1335453198516},{type:1},{type:4,layer:0},{type:0,pos:{x:138,y:45},time:1335453199232},{type:0,pos:{x:139,y:46},time:1335453199281},{type:0,pos:{x:141,y:47},time:1335453199331},{type:0,pos:{x:143,y:47},time:1335453199390},{type:0,pos:{x:144,y:48},time:1335453199440},{type:0,pos:{x:145,y:48},time:1335453199475},{type:0,pos:{x:146,y:49},time:1335453199521},{type:0,pos:{x:147,y:49},time:1335453199558},{type:0,pos:{x:148,y:50},time:1335453199620},{type:0,pos:{x:149,y:51},time:1335453199677},{type:0,pos:{x:150,y:52},time:1335453199726},{type:0,pos:{x:152,y:52},time:1335453199806},{type:1},{type:4,layer:0},{type:0,pos:{x:164,y:67},time:1335453200488},{type:0,pos:{x:164,y:68},time:1335453200513},{type:0,pos:{x:165,y:68},time:1335453200538},{type:0,pos:{x:165,y:69},time:1335453200567},{type:0,pos:{x:166,y:71},time:1335453200635},{type:0,pos:{x:167,y:72},time:1335453200675},{type:0,pos:{x:168,y:73},time:1335453200710},{type:0,pos:{x:168,y:74},time:1335453200769},{type:0,pos:{x:169,y:75},time:1335453200819},{type:0,pos:{x:169,y:76},time:1335453200878},{type:0,pos:{x:170,y:77},time:1335453200927},{type:0,pos:{x:170,y:78},time:1335453200977},{type:0,pos:{x:171,y:79},time:1335453201036},{type:0,pos:{x:171,y:80},time:1335453201096},{type:1},{type:4,layer:0},{type:0,pos:{x:170,y:96},time:1335453201705},{type:0,pos:{x:170,y:97},time:1335453201752},{type:0,pos:{x:170,y:98},time:1335453201801},{type:0,pos:{x:170,y:100},time:1335453201831},{type:0,pos:{x:170,y:102},time:1335453201862},{type:0,pos:{x:170,y:103},time:1335453201910},{type:0,pos:{x:170,y:104},time:1335453201959},{type:0,pos:{x:169,y:107},time:1335453201999},{type:0,pos:{x:169,y:109},time:1335453202024},{type:0,pos:{x:168,y:111},time:1335453202064},{type:0,pos:{x:168,y:112},time:1335453202108},{type:0,pos:{x:167,y:114},time:1335453202179},{type:0,pos:{x:167,y:115},time:1335453202236},{type:0,pos:{x:166,y:115},time:1335453202286},{type:1},{type:4,layer:0},{type:0,pos:{x:155,y:130},time:1335453202880},{type:0,pos:{x:154,y:132},time:1335453202911},{type:0,pos:{x:153,y:132},time:1335453202948},{type:0,pos:{x:152,y:134},time:1335453202979},{type:0,pos:{x:151,y:134},time:1335453203028},{type:0,pos:{x:150,y:136},time:1335453203070},{type:0,pos:{x:149,y:137},time:1335453203128},{type:0,pos:{x:147,y:138},time:1335453203208},{type:0,pos:{x:146,y:139},time:1335453203265},{type:0,pos:{x:144,y:140},time:1335453203295},{type:0,pos:{x:143,y:141},time:1335453203335},{type:0,pos:{x:142,y:141},time:1335453203394},{type:0,pos:{x:139,y:144},time:1335453203426},{type:0,pos:{x:138,y:144},time:1335453203477},{type:1},{type:4,layer:0},{type:0,pos:{x:113,y:150},time:1335453204341},{type:0,pos:{x:112,y:150},time:1335453204388},{type:0,pos:{x:110,y:151},time:1335453204458},{type:0,pos:{x:109,y:151},time:1335453204498},{type:0,pos:{x:107,y:152},time:1335453204557},{type:0,pos:{x:105,y:152},time:1335453204606},{type:0,pos:{x:104,y:153},time:1335453204660},{type:0,pos:{x:101,y:153},time:1335453204725},{type:0,pos:{x:98,y:154},time:1335453204796},{type:0,pos:{x:97,y:154},time:1335453204845},{type:0,pos:{x:96,y:154},time:1335453204895},{type:0,pos:{x:95,y:154},time:1335453204954},{type:0,pos:{x:94,y:154},time:1335453205003},{type:0,pos:{x:93,y:155},time:1335453205053},{type:1},{type:4,layer:0},{type:0,pos:{x:70,y:159},time:1335453205679},{type:0,pos:{x:69,y:159},time:1335453205716},{type:0,pos:{x:67,y:160},time:1335453205765},{type:0,pos:{x:65,y:160},time:1335453205808},{type:0,pos:{x:63,y:160},time:1335453205864},{type:0,pos:{x:62,y:160},time:1335453205913},{type:0,pos:{x:60,y:161},time:1335453205963},{type:0,pos:{x:59,y:161},time:1335453205993},{type:0,pos:{x:56,y:161},time:1335453206061},{type:0,pos:{x:55,y:161},time:1335453206111},{type:0,pos:{x:54,y:161},time:1335453206161},{type:0,pos:{x:53,y:161},time:1335453206210},{type:0,pos:{x:52,y:161},time:1335453206259},{type:1},{type:4,layer:0},{type:0,pos:{x:128,y:160},time:1335453207655},{type:0,pos:{x:128,y:161},time:1335453207705},{type:0,pos:{x:129,y:162},time:1335453207734},{type:0,pos:{x:130,y:162},time:1335453207784},{type:0,pos:{x:130,y:163},time:1335453207811},{type:0,pos:{x:131,y:164},time:1335453207850},{type:0,pos:{x:131,y:165},time:1335453207882},{type:0,pos:{x:132,y:166},time:1335453207908},{type:0,pos:{x:133,y:167},time:1335453207936},{type:0,pos:{x:134,y:168},time:1335453207969},{type:0,pos:{x:134,y:169},time:1335453207995},{type:0,pos:{x:135,y:170},time:1335453208029},{type:0,pos:{x:135,y:171},time:1335453208066},{type:0,pos:{x:136,y:172},time:1335453208114},{type:0,pos:{x:137,y:172},time:1335453208164},{type:0,pos:{x:137,y:174},time:1335453208253},{type:1},{type:4,layer:0},{type:0,pos:{x:154,y:192},time:1335453208970},{type:0,pos:{x:155,y:194},time:1335453208998},{type:0,pos:{x:155,y:195},time:1335453209047},{type:0,pos:{x:156,y:197},time:1335453209097},{type:0,pos:{x:157,y:198},time:1335453209136},{type:0,pos:{x:158,y:199},time:1335453209174},{type:0,pos:{x:158,y:200},time:1335453209206},{type:0,pos:{x:159,y:200},time:1335453209255},{type:0,pos:{x:159,y:202},time:1335453209325},{type:0,pos:{x:160,y:202},time:1335453209357},{type:0,pos:{x:160,y:203},time:1335453209383},{type:0,pos:{x:161,y:204},time:1335453209413},{type:0,pos:{x:161,y:205},time:1335453209446},{type:0,pos:{x:162,y:205},time:1335453209493},{type:0,pos:{x:162,y:206},time:1335453209523},{type:0,pos:{x:163,y:206},time:1335453209572},{type:1},{type:4,layer:0},{type:0,pos:{x:175,y:222},time:1335453210316},{type:0,pos:{x:176,y:223},time:1335453210360},{type:0,pos:{x:177,y:225},time:1335453210389},{type:0,pos:{x:177,y:226},time:1335453210428},{type:0,pos:{x:178,y:228},time:1335453210478},{type:0,pos:{x:179,y:228},time:1335453210524},{type:0,pos:{x:180,y:230},time:1335453210563},{type:0,pos:{x:180,y:232},time:1335453210638},{type:0,pos:{x:181,y:233},time:1335453210690},{type:0,pos:{x:182,y:233},time:1335453210740},{type:0,pos:{x:182,y:235},time:1335453210833},{type:1},{type:2,color:{red:0,green:0,blue:255,alpha:255}},{type:3,brush_type:0,size:20,opacity:.8,spacing:.2}],end:256,nlayers:1,width:1114,height:411,pixelRatio:1,checkpoints:[]}})